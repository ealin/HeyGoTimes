
   <title>Page Title</title>
   <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;"/>

   <link rel="icon" type="image/png" href="/images/HeyGoTimes_logo.png">
   <link rel="apple-touch-icon" href="/images/HeyGoTimes_logo.png" />

   <meta name="apple-touch-fullscreen" content="YES" />
   <meta name="apple-mobile-web-app-capable" content="yes" />

   <link type='text/css' href='/stylesheets/mobile/iui.css' rel='stylesheet'  />
   <link type='text/css' href='/stylesheets/mobile/default-theme.css' rel='stylesheet'  />
   <link type='text/css' href='/stylesheets/mobile/iui-panel-list.css' rel='stylesheet'  />
   <link type='text/css' href='/stylesheets/mobile/iui_ext.css' rel='stylesheet'  />

   <script type="application/x-javascript" src="/javascripts/mobile/iui_ext.js"></script>
   <script type="application/x-javascript" src="/javascripts/mobile/iui.js"></script>

   <script type="text/javascript">

    var news_id;

    function like(user, news, like){
      // ask session data from server
      $.getJSON("/news/like.json", {user: user, news: news, like: like}, function(json)
      {
        $('#like_count'+news).html(json.like_count);
        $('#unlike_count'+news).html(json.unlike_count);

      });
    }

    function comment(resp)
    {
      var pos = resp.href.indexOf('/news/');
      var id = resp.href.substring(pos+6);
      pos=id.indexOf('-');
      id=id.substring(0, pos);

      $.ajax({
        type: "POST",
        url: "/news/comment",
        data: "news_id="+id
      });
    }

    function share(id, url, title)
    {
      var url = 'http://www.facebook.com/sharer.php?u='+url+'&t='+title;
      $.ajax({
        type: "POST",
        url: "/news/share",
        data: "news_id="+id,
        complete: function(){
          location.href=url;
        }
      });
    }

    function expand_comment(news_id,comment_url)
    {
      var comment_str = "<fb:comments href='"+comment_url+"'"+"num_posts='2' width='320'></fb:comments>";

      $('#m_comment_title_'+news_id).attr('onclick', '').unbind('click');
      $('#expand_comment'+news_id).html("");
      $('#fb_comment'+news_id).append(comment_str);
      FB.XFBML.parse(document.getElementById('comments'));
    }

    function loadMore(type, pageNo) {
      var t = $("#m_paperContent");
      var url = '/mobile/_show_paper_content?type='+type+'&page='+pageNo;
      var preview = $("#loading_more_news").html("<img src='/images/fb_loading_large.gif' width='20' height='20' />");

      $.get(url, function(response) {
        if (jQuery.trim(response) == '')
          $("#more_news").html('<%= t(:m_no_more) %>');
        else
          $("#m_paperContent").append(response);
      });
      t.timeout = setTimeout(function () {
        preview.html('');
      }, 3000);
    }

    function changePaperType(type) {
      var url = '/mobile/_show_paper_content?type='+type+'&page=1';
      loading_animate(true);
      $("#m_paperContent").load(url, function(response, status, xhr) {
        loading_animate(false);
        $("#more_news").html("<%= t(:m_more) %><span id='loading_more_news'></span>");
      });
    }

    function showNews(id){
      var url = '/mobile/show_news?id='+id;
      news_id = id;
      $("#m_news_main").load(url);
    }

    function loading_animate(on){
      if (on)
        $('#loading_animate').html("<img src='/images/fb_loading_large.gif'/>");
      else
        $('#loading_animate').html('');
    }

    $(document).ready(function() {
      var currPage = 1;
      var currType = 'latest';

       $('#more_news').unbind('click').click(function() {
        loadMore(currType, ++currPage);
      });

      $('#menu-item-rank').unbind('click').click(function(){
        $('#menu-item-latest').removeClass("current-menu-item")
        $(this).addClass("current-menu-item")
        currPage = 1;
        currType = 'rank';
        changePaperType(currType);
      });

      $('#menu-item-latest').unbind('click').click(function(){
        $('#menu-item-rank').removeClass("current-menu-item")
        $(this).addClass("current-menu-item")
        currPage = 1;
        currType = 'latest';
        changePaperType(currType);
      });

      $('#backButton').unbind('click').click(function(){
        iui.goBack(function(){document.getElementById('m_news'+news_id).scrollIntoView()});
      });

      loading_animate(false);

      FB.Event.subscribe('comment.create',function(resp){
        comment(resp);
      });
    });


    function onLoginBtn()
    {
      /* On Facebook Login */
      var my_client_id  = "<%= Facebooker2.app_id %>";
      var my_redirect_uri   = "<%= root_url+'mobile/index/' %>";
      my_type           = "user_agent";
      my_display        = "touch" ;

      var authorize_url  = "https://graph.facebook.com/oauth/authorize?";
      authorize_url += "client_id="+my_client_id;
      authorize_url += "&redirect_uri="+my_redirect_uri;
      authorize_url += "&display="+my_display;
      authorize_url += "&scope=publish_stream"


      window.location.replace(authorize_url);
    }

    function set_default_locale(new_locale)
    {
        // ask server to set session[:default_locale] then reload the main-page
        data = "locale=" + new_locale

        window.location = "/paper/set_default_locale?" + data ;


    }



  </script>

</head>



<div id="fb-root"></div>
<script src="http://connect.facebook.net/zh_TW/all.js"></script>

<script>
  FB.init({
      appId  : "<%= Facebooker2.app_id %>",
      status : true, // check login status
      cookie : true, // enable cookies to allow the server to access the session
      xfbml  : true  // parse XFBML
  });


  FB.getLoginStatus(function(response)
  {
    // must reload the page when login-status is different between facebook and "facebooker2"
    //
    logging_status_in_server = "<%= session[:logged_in] %>"


    if (response.session)
    {
      // logged in and connected user, someone you know
        if(logging_status_in_server == "false")
           window.location.replace("<%= root_url+'mobile/index/' %>") ;
    }
    //else {
      // no user session available, someone you dont know
    //}
  });


</script>



<div class="toolbar">
  <h1 id="pageTitle"></h1>
  <a id="backButton" class="button" ></a>
  <div align="right" style="padding:2px 0px;    ">
  <img src="/images/mobile/dog_48x40.png" width="32" height="32"/>
  </div>

</div>



<!-- !!!!!!!!! Page - NewsPaper  -->
<div id="paper" title="<%= t(:HeyGoTimes) %>"  selected= "true" >
  <div id="m_cmd_bar">
    <div class="menu-header">
      <ul id="menu-area" class="menu">
        <li id="menu-item-rank" class="menu-item type-btn <%= 'current-menu-item' if (session[:news_type] == 'rank') %>"><a title="Rank" href="#_paper"><%=t(:popular_news)%></a></li>
        <li id="menu-item-latest" class="menu-item <%= 'current-menu-item' if (session[:news_type] == 'latest') %>"><a title="Latest" href="#_paper"><%=t(:latest_news)%></a></li>
        <li id="menu-item-filter" class="menu-item fun-btn"><a title="<%= t(:m_filter_setting) %>" href="#filter"><%=t(:m_filter)%></a></li>
        <% if session[:logged_in] == true %>
          <li id="menu-item-fb" class="menu-item fun-btn"><%= fb_logout_link(t(:m_logout), root_url+"mobile/index") %></li>
        <% else %>
          <li id="menu-item-fb" class="menu-item fun-btn"><a onclick="onLoginBtn()"><img src="/images/mobile/login_with_facebook.jpeg" title="facebook login" /><%= t(:login) %></a></li>
        <% end %>
      </ul>
    </div>
  </div><!-- #m_cmd_bar -->

  <hr style="clear:both;">
  <div id="loading_animate" style="position:fixed;top:80px;left:50%;margin-left:-16px;"><img src="/images/fb_loading_large.gif" alt=""/></div>

  <div id="m_paperContent">
    <%= render :partial => 'mobile/show_paper_content', :locals => {:news => @news} %>
  </div>
  <div class="m_ad">
    <%= render :partial => "m_show_ad" %>
  </div>
  <div align="center">
    <button id="more_news" style="height: 30px; width:100%;font-size:1.0em;"><%= t(:m_more) %><span id="loading_more_news"></span></button>
  </div>

  <div class="menu-item" align="center">
    <a href="#" onclick="set_default_locale('zh_tw')">繁體中文</a> &nbsp;
    <a href="#" onclick="set_default_locale('zh')">简体中文</a>  &nbsp;
    <a href="#" onclick="set_default_locale('en')">English</a>


<input
type="button"
   name="groovybtn1"
   class="groovybutton"
   value="<%= t(:to_top) %>"
   title=""
   style="float: right"
    onclick="window.scrollTo(0,0) ;">



  </div>
</div>

<div id="m_news_page">
  <div id="m_news_main">
  </div> <!-- m_news_main -->
  <div class="m_ad">
    <%= render :partial => "m_show_ad" %>
  </div>
</div>

<!-- !!!!!!!!! Page - Filter  -->
<div id="filter" title="<%= t(:m_filter_setting) %>" class="panel">
  <%= render :partial => 'mobile/m_set_filter'%>

  <div align ="center" >
     <hr>
     <%= render :partial => "m_show_ad" %>
   </div>
</div>


<!-- area filter selection PAGE-->
<div id="select_area" title="<%= t(:m_filter_by_area) %>" class="panel">

  <fieldset>
    <% @areas.each do |area| %>
      <% if session[:filter_area].include?(area.name) %>
           <% if area.parent_area != nil %>
                <div class="row">
                 &nbsp;<input type="checkbox" id="<%= area.name %>" name="each_area"  checked="true"> &nbsp;&nbsp;<%= t(area.name.to_sym)%>  </input>
               </div>
           <% else %>
                <div class="row" style="color:blue;">
                 &nbsp;<input type="checkbox" id="<%= area.name %>" name="each_area"  checked="true"> <%= t(area.name.to_sym)%>  </input>
               </div>
           <% end %>
      <% else %>
           <% if area.parent_area != nil %>
                 <div class="row">
                 &nbsp;<input type="checkbox" id="<%= area.name %>" name="each_area" > &nbsp;&nbsp;<%= t(area.name.to_sym)%>  </input>
               </div>
           <% else %>
                <div class="row" style="color:blue;">
                  &nbsp;<input type="checkbox" id="<%= area.name %>" name="each_area" > <%= t(area.name.to_sym)%>  </input>
                </div>
            <% end %>
      <% end %>
    <% end %>
  </fieldset>
</div>



<!-- tag filter selection PAGE-->
<div id="select_tag" title="<%= t(:m_filter_by_tag) %>" class="panel">

  <fieldset>
    <% @tags.each do |tag| %>
      <% if tag.id == 2 || tag.id == 3 || tag.name == 'FAQ' || tag.name == "Closed_spam" || tag.name == "Closed_spam_report" %>
           <% next %>
      <% end %>

      <% if detect_apple_browser() && tag.name == 'Motion' %>
           <% next %>  <%# don't support motion-news in iphone %>
      <% end %>

      <% if session[:filter_tags].include?(tag.name) %>
             <div class="row">
              &nbsp;<input type="checkbox" id="<%= tag.name %>" name="each_tag" checked="true" >
                <%= t(tag.name.to_sym)%>  </input>
            </div>
      <% else %>
            <div class="row">
              &nbsp;<input type="checkbox" id="<%= tag.name %>" name="each_tag" > <%= t(tag.name.to_sym)%>  </input>
            </div>
       <% end %>
    <% end %>

  </fieldset>


</div>


<!-- friend filter selection PAGE-->
<div id="select_friend" title="<%= t(:filter_by_friend) %>" class="panel">

  <% if session[:logged_in] == false %>
    <h1> <%= t(:login_for_set_friend_filter) %> </h1>
  <% else %>
    <h1> <%= t(:filter_by_friend) %></h1>
  <% end %>
  <br>

  <fieldset>

  <% if session[:logged_in] != false %>

      <% if session[:filter_friend].include?("mine")  %>
        <div class="row">
          &nbsp;<input type="checkbox" id="my_news_only" name="friend_filter"  checked="true"> <%= t(:my_news_only)%>  </input>
        </div>


      <% else %>
          <div class="row">
            &nbsp;<input type="checkbox" id="my_news_only" name="friend_filter"> <%= t(:my_news_only)%>  </input>
          </div>
      <% end %>

      <% if session[:filter_friend].include?("friend")  %>
            <div class="row">
              &nbsp;<input type="checkbox" id="my_friends_news_only" name="friend_filter" checked="true"> <%= t(:my_friends_news_only)%>  </input>
            </div>
      <% else %>
            <div class="row">
              &nbsp;<input type="checkbox" id="my_friends_news_only" name="friend_filter"> <%= t(:my_friends_news_only)%>  </input>
            </div>
      <% end %>


  <% end %>


  </fieldset>

</div>


<!-- date filter selection PAGE-->
<div id="select_date" title="<%= t(:filter_by_date) %>" class="panel">
  <h1><%= t(:filter_by_date) %></h1>
  <br>

  <fieldset>

  <% if session[:filter_date_option].include?("no_limited") %>
      <div class="row">
         &nbsp;<input type="radio" name = "date" id="no_filter" value = "no_filter" checked="true"> <%= t(:no_date_filter)   %>
      </div>
  <% else %>
       <div class="row">
          &nbsp;<input type="radio" name = "date" id="no_filter" value = "no_filter"> <%= t(:no_date_filter)   %>
       </div>
  <% end %>

  <% if session[:filter_date_option].include?("yesterday") %>
      <div class="row">
         &nbsp;<input type="radio" name = "date" id="yesterday" value = "yesterday" checked="true"> <%= t(:yesterday)   %>
      </div>
  <% else %>
      <div class="row">
         &nbsp;<input type="radio" name = "date" id="yesterday" value = "yesterday"> <%= t(:yesterday)   %>
      </div>
  <% end %>

  <% if session[:filter_date_option].include?("today") %>
      <div class="row">
         &nbsp;<input type="radio" name = "date" id="today" value = "today" checked="true"> <%= t(:today)%>
      </div>
  <% else %>
       <div class="row">
         &nbsp;<input type="radio" name = "date" id="today" value = "today"> <%= t(:today)%>
       </div>
  <% end %>

  </fieldset>

</div>



   <!-- MOBILE VER.先不提供 REPORT的功能-->
   <!-- !!!!!!!!! Page - Report  -->
   <!--
   <ul id="report" title="report_page"  class="panel">
     <%#= render :partial => 'mobile/m_report'%>
   </ul>
   -->

