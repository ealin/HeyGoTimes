<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 12">
<meta name=Originator content="Microsoft Word 12">
<link rel=File-List href="/b2/CH08_03.files/filelist.xml">
<link rel=Edit-Time-Data href="/b2/CH08_03.files/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]-->
<title>8.3. Heap-動態記憶體配置</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>cebm</o:Author>
  <o:LastAuthor>Win7User</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>11471</o:TotalTime>
  <o:LastPrinted>2007-04-09T10:31:00Z</o:LastPrinted>
  <o:Created>2011-09-28T15:31:00Z</o:Created>
  <o:LastSaved>2011-09-28T15:31:00Z</o:LastSaved>
  <o:Pages>13</o:Pages>
  <o:Words>2950</o:Words>
  <o:Characters>16820</o:Characters>
  <o:Company>xxx</o:Company>
  <o:Lines>140</o:Lines>
  <o:Paragraphs>39</o:Paragraphs>
  <o:CharactersWithSpaces>19731</o:CharactersWithSpaces>
  <o:Version>12.00</o:Version>
 </o:DocumentProperties>
 <o:OfficeDocumentSettings>
  <o:TargetScreenSize>544x376</o:TargetScreenSize>
 </o:OfficeDocumentSettings>
</xml><![endif]-->
<link rel=themeData href="/b2/CH08_03.files/themedata.thmx">
<link rel=colorSchemeMapping href="/b2/CH08_03.files/colorschememapping.xml">
<!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:TrackMoves>false</w:TrackMoves>
  <w:TrackFormatting/>
  <w:PunctuationKerning/>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>2</w:DisplayVerticalDrawingGridEvery>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotPromoteQF/>
  <w:LidThemeOther>EN-US</w:LidThemeOther>
  <w:LidThemeAsian>ZH-TW</w:LidThemeAsian>
  <w:LidThemeComplexScript>X-NONE</w:LidThemeComplexScript>
  <w:Compatibility>
   <w:SpaceForUL/>
   <w:BalanceSingleByteDoubleByteWidth/>
   <w:DoNotLeaveBackslashAlone/>
   <w:ULTrailSpace/>
   <w:DoNotExpandShiftReturn/>
   <w:AdjustLineHeightInTable/>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
   <w:DontUseIndentAsNumberingTabStop/>
   <w:FELineBreak11/>
   <w:WW11IndentRules/>
   <w:DontAutofitConstrainedTables/>
   <w:AutofitLikeWW11/>
   <w:HangulWidthLikeWW11/>
   <w:UseNormalStyleForList/>
   <w:UseFELayout/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
  <m:mathPr>
   <m:mathFont m:val="Cambria Math"/>
   <m:brkBin m:val="before"/>
   <m:brkBinSub m:val="&#45;-"/>
   <m:smallFrac m:val="off"/>
   <m:dispDef/>
   <m:lMargin m:val="0"/>
   <m:rMargin m:val="0"/>
   <m:defJc m:val="centerGroup"/>
   <m:wrapIndent m:val="1440"/>
   <m:intLim m:val="subSup"/>
   <m:naryLim m:val="undOvr"/>
  </m:mathPr></w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" DefUnhideWhenUsed="false"
  DefSemiHidden="false" DefQFormat="false" LatentStyleCount="267">
  <w:LsdException Locked="false" QFormat="true" Name="Normal"/>
  <w:LsdException Locked="false" QFormat="true" Name="heading 1"/>
  <w:LsdException Locked="false" QFormat="true" Name="heading 2"/>
  <w:LsdException Locked="false" QFormat="true" Name="heading 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 5"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 6"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 7"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 8"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 9"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 2"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="caption"/>
  <w:LsdException Locked="false" QFormat="true" Name="Title"/>
  <w:LsdException Locked="false" QFormat="true" Name="Subtitle"/>
  <w:LsdException Locked="false" Priority="99" Name="Hyperlink"/>
  <w:LsdException Locked="false" QFormat="true" Name="Strong"/>
  <w:LsdException Locked="false" QFormat="true" Name="Emphasis"/>
  <w:LsdException Locked="false" Priority="99" SemiHidden="true"
   Name="Placeholder Text"/>
  <w:LsdException Locked="false" Priority="1" QFormat="true" Name="No Spacing"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 1"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="99" SemiHidden="true" Name="Revision"/>
  <w:LsdException Locked="false" Priority="34" QFormat="true"
   Name="List Paragraph"/>
  <w:LsdException Locked="false" Priority="29" QFormat="true" Name="Quote"/>
  <w:LsdException Locked="false" Priority="30" QFormat="true"
   Name="Intense Quote"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 1"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 1"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 2"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 2"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 2"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 3"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 3"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 3"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 4"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 4"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 4"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 5"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 5"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 5"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 6"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 6"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 6"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="19" QFormat="true"
   Name="Subtle Emphasis"/>
  <w:LsdException Locked="false" Priority="21" QFormat="true"
   Name="Intense Emphasis"/>
  <w:LsdException Locked="false" Priority="31" QFormat="true"
   Name="Subtle Reference"/>
  <w:LsdException Locked="false" Priority="32" QFormat="true"
   Name="Intense Reference"/>
  <w:LsdException Locked="false" Priority="33" QFormat="true" Name="Book Title"/>
  <w:LsdException Locked="false" Priority="37" SemiHidden="true"
   UnhideWhenUsed="true" Name="Bibliography"/>
  <w:LsdException Locked="false" Priority="39" SemiHidden="true"
   UnhideWhenUsed="true" QFormat="true" Name="TOC Heading"/>
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;
	mso-font-charset:2;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:0 268435456 0 0 -2147483648 0;}
@font-face
	{font-family:新細明體;
	panose-1:2 2 5 0 0 0 0 0 0 0;
	mso-font-alt:PMingLiU;
	mso-font-charset:136;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:-1610611969 684719354 22 0 1048577 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:-1610611985 1107304683 0 0 159 0;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-520092929 1073786111 9 0 415 0;}
@font-face
	{font-family:微軟正黑體;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:136;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:135 680476672 22 0 1048585 0;}
@font-face
	{font-family:"\@微軟正黑體";
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:136;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:135 680476672 22 0 1048585 0;}
@font-face
	{font-family:"\@新細明體";
	panose-1:2 2 5 0 0 0 0 0 0 0;
	mso-font-charset:136;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:-1610611969 684719354 22 0 1048577 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:none;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";
	mso-fareast-font-family:新細明體;
	mso-font-kerning:1.0pt;}
h1
	{mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-next:正文;
	margin-top:9.0pt;
	margin-right:0cm;
	margin-bottom:9.0pt;
	margin-left:0cm;
	line-height:300%;
	mso-pagination:none;
	page-break-after:avoid;
	mso-outline-level:1;
	font-size:26.0pt;
	font-family:"Arial","sans-serif";
	mso-bidi-font-family:"Times New Roman";
	mso-font-kerning:26.0pt;}
h2
	{mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-next:正文;
	margin:0cm;
	margin-bottom:.0001pt;
	line-height:300%;
	mso-pagination:none;
	page-break-after:avoid;
	mso-outline-level:2;
	font-size:24.0pt;
	font-family:"Arial","sans-serif";
	mso-bidi-font-family:"Times New Roman";
	mso-font-kerning:1.0pt;}
h3
	{mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-next:正文;
	margin:0cm;
	margin-bottom:.0001pt;
	line-height:300%;
	mso-pagination:none;
	page-break-after:avoid;
	mso-outline-level:3;
	font-size:18.0pt;
	font-family:"Arial","sans-serif";
	mso-bidi-font-family:"Times New Roman";
	mso-font-kerning:1.0pt;}
p.MsoToc1, li.MsoToc1, div.MsoToc1
	{mso-style-update:auto;
	mso-style-noshow:yes;
	mso-style-unhide:no;
	mso-style-next:正文;
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:none;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";
	mso-fareast-font-family:新細明體;
	mso-font-kerning:1.0pt;}
p.MsoToc2, li.MsoToc2, div.MsoToc2
	{mso-style-update:auto;
	mso-style-priority:39;
	mso-style-unhide:no;
	mso-style-next:正文;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:24.0pt;
	margin-bottom:.0001pt;
	mso-para-margin-top:0cm;
	mso-para-margin-right:0cm;
	mso-para-margin-bottom:0cm;
	mso-para-margin-left:2.0gd;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:none;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";
	mso-fareast-font-family:新細明體;
	mso-font-kerning:1.0pt;}
p.MsoToc3, li.MsoToc3, div.MsoToc3
	{mso-style-update:auto;
	mso-style-priority:39;
	mso-style-unhide:no;
	mso-style-next:正文;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:48.0pt;
	margin-bottom:.0001pt;
	mso-para-margin-top:0cm;
	mso-para-margin-right:0cm;
	mso-para-margin-bottom:0cm;
	mso-para-margin-left:4.0gd;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:none;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";
	mso-fareast-font-family:新細明體;
	mso-font-kerning:1.0pt;}
p.MsoFootnoteText, li.MsoFootnoteText, div.MsoFootnoteText
	{mso-style-noshow:yes;
	mso-style-unhide:no;
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:none;
	layout-grid-mode:char;
	font-size:10.0pt;
	font-family:"Times New Roman","serif";
	mso-fareast-font-family:新細明體;
	mso-font-kerning:1.0pt;}
p.MsoTof, li.MsoTof, div.MsoTof
	{mso-style-noshow:yes;
	mso-style-unhide:no;
	mso-style-next:正文;
	margin:0cm;
	margin-bottom:.0001pt;
	mso-para-margin-top:0cm;
	mso-para-margin-right:0cm;
	mso-para-margin-bottom:0cm;
	mso-para-margin-left:4.0gd;
	mso-para-margin-bottom:.0001pt;
	text-indent:-10.0pt;
	mso-char-indent-count:-2.0;
	mso-pagination:none;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";
	mso-fareast-font-family:新細明體;
	mso-font-kerning:1.0pt;}
span.MsoFootnoteReference
	{mso-style-noshow:yes;
	mso-style-unhide:no;
	vertical-align:super;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	mso-style-unhide:no;
	color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-unhide:no;
	color:purple;
	mso-themecolor:followedhyperlink;
	text-decoration:underline;
	text-underline:single;}
p.a, li.a, div.a
	{mso-style-name:圖表;
	mso-style-unhide:no;
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:27.0pt;
	mso-char-indent-count:2.25;
	mso-pagination:none;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";
	mso-fareast-font-family:新細明體;
	mso-font-kerning:1.0pt;}
.MsoChpDefault
	{mso-style-type:export-only;
	mso-default-props:yes;
	mso-fareast-font-family:新細明體;}
 /* Page Definitions */
 @page
	{mso-page-border-surround-header:no;
	mso-page-border-surround-footer:no;
	mso-footnote-separator:url("/b2/CH08_03.files/header.htm") fs;
	mso-footnote-continuation-separator:url("/b2/CH08_03.files/header.htm") fcs;
	mso-endnote-separator:url("/b2/CH08_03.files/header.htm") es;
	mso-endnote-continuation-separator:url("/b2/CH08_03.files/header.htm") ecs;}
@page Section1
	{size:595.3pt 841.9pt;
	margin:42.55pt 42.55pt 42.55pt 42.55pt;
	mso-header-margin:42.55pt;
	mso-footer-margin:49.6pt;
	mso-paper-source:0;
	layout-grid:18.0pt;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:1706164;
	mso-list-type:hybrid;
	mso-list-template-ids:745701876 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l0:level1
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:51.0pt;
	mso-level-number-position:left;
	margin-left:51.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l1
	{mso-list-id:147862709;
	mso-list-type:hybrid;
	mso-list-template-ids:1384296018 720113812 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l1:level1
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:66.0pt;
	mso-level-number-position:left;
	margin-left:66.0pt;
	text-indent:-39.0pt;}
@list l2
	{mso-list-id:149448313;
	mso-list-type:hybrid;
	mso-list-template-ids:938407152 -1038478198 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l2:level1
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:45.0pt;
	mso-level-number-position:left;
	margin-left:45.0pt;
	text-indent:-18.0pt;}
@list l3
	{mso-list-id:367026408;
	mso-list-type:hybrid;
	mso-list-template-ids:544269784 1863105064 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l3:level1
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:68.25pt;
	mso-level-number-position:left;
	margin-left:68.25pt;
	text-indent:-41.25pt;}
@list l4
	{mso-list-id:907811291;
	mso-list-type:hybrid;
	mso-list-template-ids:824477944 445817682 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l4:level1
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:68.25pt;
	mso-level-number-position:left;
	margin-left:68.25pt;
	text-indent:-41.25pt;}
@list l5
	{mso-list-id:934284905;
	mso-list-type:hybrid;
	mso-list-template-ids:-1183578008 946522436 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l5:level1
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:68.25pt;
	mso-level-number-position:left;
	margin-left:68.25pt;
	text-indent:-41.25pt;}
@list l6
	{mso-list-id:1128426702;
	mso-list-template-ids:-1306763306;}
@list l6:level1
	{mso-level-start-at:8;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:40.5pt;
	text-indent:-40.5pt;}
@list l6:level2
	{mso-level-start-at:3;
	mso-level-text:"%1\.%2\.";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:54.0pt;
	text-indent:-54.0pt;}
@list l6:level3
	{mso-level-text:"%1\.%2\.%3\.";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:72.0pt;
	text-indent:-72.0pt;}
@list l6:level4
	{mso-level-text:"%1\.%2\.%3\.%4\.";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:90.0pt;
	text-indent:-90.0pt;}
@list l6:level5
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:108.0pt;
	text-indent:-108.0pt;}
@list l6:level6
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:144.0pt;
	text-indent:-144.0pt;}
@list l6:level7
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:162.0pt;
	text-indent:-162.0pt;}
@list l6:level8
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:180.0pt;
	text-indent:-180.0pt;}
@list l6:level9
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.%9\.";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:198.0pt;
	text-indent:-198.0pt;}
@list l7
	{mso-list-id:1180049767;
	mso-list-type:hybrid;
	mso-list-template-ids:1493612878 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l7:level1
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:51.0pt;
	mso-level-number-position:left;
	margin-left:51.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l8
	{mso-list-id:1185024865;
	mso-list-type:hybrid;
	mso-list-template-ids:1914445642 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l8:level1
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:51.0pt;
	mso-level-number-position:left;
	margin-left:51.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l9
	{mso-list-id:1214661042;
	mso-list-type:hybrid;
	mso-list-template-ids:-1129695522 -507730794 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l9:level1
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:68.25pt;
	mso-level-number-position:left;
	margin-left:68.25pt;
	text-indent:-41.25pt;}
@list l10
	{mso-list-id:1281456551;
	mso-list-template-ids:-409692766;}
@list l10:level1
	{mso-level-start-at:8;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;}
@list l10:level2
	{mso-level-text:"%1\.%2\.";
	mso-level-tab-stop:1.0cm;
	mso-level-number-position:left;
	margin-left:1.0cm;
	text-indent:-1.0cm;}
@list l10:level3
	{mso-level-text:"%1\.%2\.%3\.";
	mso-level-tab-stop:35.45pt;
	mso-level-number-position:left;
	margin-left:35.45pt;
	text-indent:-35.45pt;}
@list l10:level4
	{mso-level-text:"%1\.%2\.%3\.%4\.";
	mso-level-tab-stop:42.55pt;
	mso-level-number-position:left;
	margin-left:42.55pt;
	text-indent:-42.55pt;}
@list l10:level5
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.";
	mso-level-tab-stop:49.6pt;
	mso-level-number-position:left;
	margin-left:49.6pt;
	text-indent:-49.6pt;}
@list l10:level6
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.";
	mso-level-tab-stop:2.0cm;
	mso-level-number-position:left;
	margin-left:2.0cm;
	text-indent:-2.0cm;}
@list l10:level7
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.";
	mso-level-tab-stop:63.8pt;
	mso-level-number-position:left;
	margin-left:63.8pt;
	text-indent:-63.8pt;}
@list l10:level8
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.";
	mso-level-tab-stop:70.9pt;
	mso-level-number-position:left;
	margin-left:70.9pt;
	text-indent:-70.9pt;}
@list l10:level9
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.%9\.";
	mso-level-tab-stop:77.95pt;
	mso-level-number-position:left;
	margin-left:77.95pt;
	text-indent:-77.95pt;}
@list l11
	{mso-list-id:1319309695;
	mso-list-type:hybrid;
	mso-list-template-ids:-1018763866 -872127796 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l11:level1
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:45.0pt;
	mso-level-number-position:left;
	margin-left:45.0pt;
	text-indent:-18.0pt;}
@list l12
	{mso-list-id:1327174895;
	mso-list-type:hybrid;
	mso-list-template-ids:-166309070 -737388942 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l12:level1
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:51.0pt;
	mso-level-number-position:left;
	margin-left:51.0pt;
	text-indent:-24.0pt;}
@list l13
	{mso-list-id:1628274306;
	mso-list-type:hybrid;
	mso-list-template-ids:1323177410 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l13:level1
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:51.0pt;
	mso-level-number-position:left;
	margin-left:51.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l14
	{mso-list-id:1731532510;
	mso-list-template-ids:-1914145694;}
@list l14:level1
	{mso-level-tab-stop:51.0pt;
	mso-level-number-position:left;
	margin-left:51.0pt;
	text-indent:-24.0pt;}
@list l14:level2
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:75.0pt;
	mso-level-number-position:left;
	margin-left:75.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l14:level3
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:99.0pt;
	mso-level-number-position:left;
	margin-left:99.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l14:level4
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:123.0pt;
	mso-level-number-position:left;
	margin-left:123.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l14:level5
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:147.0pt;
	mso-level-number-position:left;
	margin-left:147.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l14:level6
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:171.0pt;
	mso-level-number-position:left;
	margin-left:171.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l14:level7
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:195.0pt;
	mso-level-number-position:left;
	margin-left:195.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l14:level8
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:219.0pt;
	mso-level-number-position:left;
	margin-left:219.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l14:level9
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:243.0pt;
	mso-level-number-position:left;
	margin-left:243.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l15
	{mso-list-id:1844784970;
	mso-list-template-ids:67698719;}
@list l15:level1
	{mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;}
@list l15:level2
	{mso-level-text:"%1\.%2\.";
	mso-level-tab-stop:1.0cm;
	mso-level-number-position:left;
	margin-left:1.0cm;
	text-indent:-1.0cm;}
@list l15:level3
	{mso-level-text:"%1\.%2\.%3\.";
	mso-level-tab-stop:35.45pt;
	mso-level-number-position:left;
	margin-left:35.45pt;
	text-indent:-35.45pt;}
@list l15:level4
	{mso-level-text:"%1\.%2\.%3\.%4\.";
	mso-level-tab-stop:42.55pt;
	mso-level-number-position:left;
	margin-left:42.55pt;
	text-indent:-42.55pt;}
@list l15:level5
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.";
	mso-level-tab-stop:49.6pt;
	mso-level-number-position:left;
	margin-left:49.6pt;
	text-indent:-49.6pt;}
@list l15:level6
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.";
	mso-level-tab-stop:2.0cm;
	mso-level-number-position:left;
	margin-left:2.0cm;
	text-indent:-2.0cm;}
@list l15:level7
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.";
	mso-level-tab-stop:63.8pt;
	mso-level-number-position:left;
	margin-left:63.8pt;
	text-indent:-63.8pt;}
@list l15:level8
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.";
	mso-level-tab-stop:70.9pt;
	mso-level-number-position:left;
	margin-left:70.9pt;
	text-indent:-70.9pt;}
@list l15:level9
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.%9\.";
	mso-level-tab-stop:77.95pt;
	mso-level-number-position:left;
	margin-left:77.95pt;
	text-indent:-77.95pt;}
ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:普通表格;
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-unhide:no;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman","serif";}
table.MsoTableGrid
	{mso-style-name:网格型;
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-unhide:no;
	border:solid windowtext 1.0pt;
	mso-border-alt:solid windowtext .5pt;
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-border-insideh:.5pt solid windowtext;
	mso-border-insidev:.5pt solid windowtext;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:none;
	font-size:10.0pt;
	font-family:"Times New Roman","serif";}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="2050"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=ZH-TW link=blue vlink=purple style='tab-interval:24.0pt;text-justify-trim:
punctuation'>

<div class=Section1 style='layout-grid:18.0pt'>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><a
name="_Toc149018084"><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></a></p>

<p class=MsoToc2 style='line-height:18.0pt;mso-line-height-rule:exactly;
tab-stops:60.0pt right dotted 509.7pt'><span style='mso-bookmark:_Toc149018084'></span><!--[if supportFields]><span
style='mso-bookmark:_Toc149018084'></span><span style='mso-element:field-begin'></span><span
style='mso-bookmark:_Toc149018084'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><span
style='mso-spacerun:yes'> </span>TOC \o &quot;1-3&quot; \h \z \u <span
style='mso-element:field-separator'></span></span></span><![endif]--><span
style='mso-bookmark:_Toc149018084'></span><a href="#_Toc304922548"><span
style='mso-bookmark:_Toc149018084'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";
mso-no-proof:yes'>8.3.</span></span><span style='mso-bookmark:_Toc149018084'><span
lang=EN-US style='mso-bidi-font-size:11.0pt;font-family:"Calibri","sans-serif";
mso-bidi-font-family:"Times New Roman";color:windowtext;mso-no-proof:yes;
text-decoration:none;text-underline:none'><span style='mso-tab-count:1'>      </span></span></span><span
style='mso-bookmark:_Toc149018084'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";
mso-no-proof:yes'>Heap-</span></span><span style='mso-bookmark:_Toc149018084'><span
style='font-family:"微軟正黑體","sans-serif";mso-no-proof:yes'>動態記憶體配置</span></span><span
style='mso-bookmark:_Toc149018084'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'><span style='mso-tab-count:1 dotted'>... </span></span></span><!--[if supportFields]><span
style='mso-bookmark:_Toc149018084'></span><span style='mso-element:field-begin'></span><span
style='mso-bookmark:_Toc149018084'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'> PAGEREF _Toc304922548 \h <span style='mso-element:field-separator'></span></span></span><![endif]--><span
style='mso-bookmark:_Toc149018084'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'>1<!--[if gte mso 9]><xml>
 <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300300034003900320032003500340038000000</w:data>
</xml><![endif]--></span></span><!--[if supportFields]><span style='mso-bookmark:
_Toc149018084'></span><span style='mso-element:field-end'></span><![endif]--><span
style='mso-bookmark:_Toc149018084'></span></a><span style='mso-bookmark:_Toc149018084'><span
lang=EN-US style='mso-bidi-font-size:11.0pt;font-family:"Calibri","sans-serif";
mso-bidi-font-family:"Times New Roman";mso-no-proof:yes'><o:p></o:p></span></span></p>

<p class=MsoToc3 style='line-height:18.0pt;mso-line-height-rule:exactly;
tab-stops:right dotted 509.7pt'><span style='mso-bookmark:_Toc149018084'></span><a
href="#_Toc304922549"><span style='mso-bookmark:_Toc149018084'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";mso-no-proof:yes'>Allocate
&amp; Free</span></span><span style='mso-bookmark:_Toc149018084'><span
lang=EN-US style='color:windowtext;display:none;mso-hide:screen;mso-no-proof:
yes;text-decoration:none;text-underline:none'><span style='mso-tab-count:1 dotted'>. </span></span></span><!--[if supportFields]><span
style='mso-bookmark:_Toc149018084'></span><span style='mso-element:field-begin'></span><span
style='mso-bookmark:_Toc149018084'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'> PAGEREF _Toc304922549 \h <span style='mso-element:field-separator'></span></span></span><![endif]--><span
style='mso-bookmark:_Toc149018084'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'>2<!--[if gte mso 9]><xml>
 <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300300034003900320032003500340039000000</w:data>
</xml><![endif]--></span></span><!--[if supportFields]><span style='mso-bookmark:
_Toc149018084'></span><span style='mso-element:field-end'></span><![endif]--><span
style='mso-bookmark:_Toc149018084'></span></a><span style='mso-bookmark:_Toc149018084'><span
lang=EN-US style='mso-bidi-font-size:11.0pt;font-family:"Calibri","sans-serif";
mso-bidi-font-family:"Times New Roman";mso-no-proof:yes'><o:p></o:p></span></span></p>

<p class=MsoToc3 style='line-height:18.0pt;mso-line-height-rule:exactly;
tab-stops:right dotted 509.7pt'><span style='mso-bookmark:_Toc149018084'></span><a
href="#_Toc304922550"><span style='mso-bookmark:_Toc149018084'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";mso-no-proof:yes'>API</span></span><span
style='mso-bookmark:_Toc149018084'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'><span style='mso-tab-count:1 dotted'> </span></span></span><!--[if supportFields]><span
style='mso-bookmark:_Toc149018084'></span><span style='mso-element:field-begin'></span><span
style='mso-bookmark:_Toc149018084'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'> PAGEREF _Toc304922550 \h <span style='mso-element:field-separator'></span></span></span><![endif]--><span
style='mso-bookmark:_Toc149018084'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'>3<!--[if gte mso 9]><xml>
 <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300300034003900320032003500350030000000</w:data>
</xml><![endif]--></span></span><!--[if supportFields]><span style='mso-bookmark:
_Toc149018084'></span><span style='mso-element:field-end'></span><![endif]--><span
style='mso-bookmark:_Toc149018084'></span></a><span style='mso-bookmark:_Toc149018084'><span
lang=EN-US style='mso-bidi-font-size:11.0pt;font-family:"Calibri","sans-serif";
mso-bidi-font-family:"Times New Roman";mso-no-proof:yes'><o:p></o:p></span></span></p>

<p class=MsoToc3 style='line-height:18.0pt;mso-line-height-rule:exactly;
tab-stops:right dotted 509.7pt'><span style='mso-bookmark:_Toc149018084'></span><a
href="#_Toc304922551"><span style='mso-bookmark:_Toc149018084'><span
style='font-family:"微軟正黑體","sans-serif";mso-no-proof:yes'>碎塊處理？</span></span><span
style='mso-bookmark:_Toc149018084'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'><span style='mso-tab-count:1 dotted'>... </span></span></span><!--[if supportFields]><span
style='mso-bookmark:_Toc149018084'></span><span style='mso-element:field-begin'></span><span
style='mso-bookmark:_Toc149018084'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'> PAGEREF _Toc304922551 \h <span style='mso-element:field-separator'></span></span></span><![endif]--><span
style='mso-bookmark:_Toc149018084'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'>9<!--[if gte mso 9]><xml>
 <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300300034003900320032003500350031000000</w:data>
</xml><![endif]--></span></span><!--[if supportFields]><span style='mso-bookmark:
_Toc149018084'></span><span style='mso-element:field-end'></span><![endif]--><span
style='mso-bookmark:_Toc149018084'></span></a><span style='mso-bookmark:_Toc149018084'><span
lang=EN-US style='mso-bidi-font-size:11.0pt;font-family:"Calibri","sans-serif";
mso-bidi-font-family:"Times New Roman";mso-no-proof:yes'><o:p></o:p></span></span></p>

<p class=MsoToc3 style='line-height:18.0pt;mso-line-height-rule:exactly;
tab-stops:right dotted 509.7pt'><span style='mso-bookmark:_Toc149018084'></span><a
href="#_Toc304922552"><span style='mso-bookmark:_Toc149018084'><span
style='font-family:"微軟正黑體","sans-serif";mso-no-proof:yes'>保護<span lang=EN-US>Heap</span>？</span></span><span
style='mso-bookmark:_Toc149018084'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'><span style='mso-tab-count:1 dotted'>... </span></span></span><!--[if supportFields]><span
style='mso-bookmark:_Toc149018084'></span><span style='mso-element:field-begin'></span><span
style='mso-bookmark:_Toc149018084'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'> PAGEREF _Toc304922552 \h <span style='mso-element:field-separator'></span></span></span><![endif]--><span
style='mso-bookmark:_Toc149018084'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'>13<!--[if gte mso 9]><xml>
 <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300300034003900320032003500350032000000</w:data>
</xml><![endif]--></span></span><!--[if supportFields]><span style='mso-bookmark:
_Toc149018084'></span><span style='mso-element:field-end'></span><![endif]--><span
style='mso-bookmark:_Toc149018084'></span></a><span style='mso-bookmark:_Toc149018084'><span
lang=EN-US style='mso-bidi-font-size:11.0pt;font-family:"Calibri","sans-serif";
mso-bidi-font-family:"Times New Roman";mso-no-proof:yes'><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
style='mso-bookmark:_Toc149018084'></span><!--[if supportFields]><span
style='mso-bookmark:_Toc149018084'></span><span style='mso-element:field-end'></span><![endif]--><span
style='mso-bookmark:_Toc149018084'></span><span lang=EN-US style='font-family:
"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<h2 style='margin-left:54.0pt;text-indent:-54.0pt;line-height:18.0pt;
mso-line-height-rule:exactly;mso-list:l6 level2 lfo16'><a name="_Toc304922548"></a><a
name="_Toc149018087"><span style='mso-bookmark:_Toc304922548'><![if !supportLists]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";mso-bidi-font-family:微軟正黑體'><span
style='mso-list:Ignore'>8.3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>Heap-</span></span></a><span
style='mso-bookmark:_Toc149018087'><span style='mso-bookmark:_Toc304922548'><span
style='font-family:"微軟正黑體","sans-serif"'>動態記憶體配置</span></span></span><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></h2>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>系統老鳥：『除了<span
lang=EN-US>Stack</span>外，系統裡還需要保留一或多塊供程式設計師動態使用的記憶體，一般書籍都稱其為<span lang=EN-US>Heap</span>，我個人則比較喜歡“動態配置記憶體”這樣的稱呼。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『我們常在程式語言的教科書中看到<span
lang=EN-US>stack</span>和<span lang=EN-US>heap</span>的關係圖，我以前就很擔心，如果<span
lang=EN-US>stack</span>或<span lang=EN-US>heap</span>無限制的長下去的話，不是就會壓到對方嗎？在嵌入式系統裡也是這種架構嗎？<span
style='display:none;mso-hide:all'>式語言的教科書中看到ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:18.0pt;
mso-line-height-rule:exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";
color:red'><!--[if gte vml 1]><v:shapetype id="_x0000_t75" coordsize="21600,21600"
 o:spt="75" o:preferrelative="t" path="m@4@5l@4@11@9@11@9@5xe" filled="f"
 stroked="f">
 <v:stroke joinstyle="miter"/>
 <v:formulas>
  <v:f eqn="if lineDrawn pixelLineWidth 0"/>
  <v:f eqn="sum @0 1 0"/>
  <v:f eqn="sum 0 0 @1"/>
  <v:f eqn="prod @2 1 2"/>
  <v:f eqn="prod @3 21600 pixelWidth"/>
  <v:f eqn="prod @3 21600 pixelHeight"/>
  <v:f eqn="sum @0 0 1"/>
  <v:f eqn="prod @6 1 2"/>
  <v:f eqn="prod @7 21600 pixelWidth"/>
  <v:f eqn="sum @8 21600 0"/>
  <v:f eqn="prod @7 21600 pixelHeight"/>
  <v:f eqn="sum @10 21600 0"/>
 </v:formulas>
 <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
 <o:lock v:ext="edit" aspectratio="t"/>
</v:shapetype><v:shape id="_x0000_i1025" type="#_x0000_t75" style='width:318.75pt;
 height:261pt'>
 <v:imagedata src="/b2/CH08_03.files/image001.jpg" o:title="08-04-傳統Stack與Heap的關係圖"/>
</v:shape><![endif]--><![if !vml]><img width=425 height=348
src="/b2/CH08_03.files/image002.jpg" v:shapes="_x0000_i1025"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc164247021"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>8-4</span>：傳統<span
lang=EN-US>Stack</span>與<span lang=EN-US>Heap</span>的關係圖</span></a><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>系統老鳥：『在<span
lang=EN-US>PC</span>上，因為每一個程式有自己獨立的位址空間，編譯器與作業系統可以分配很大的區域來做程式的<span lang=EN-US>stack</span>與<span
lang=EN-US>heap(</span>用到時才需要分配實體記憶體<span lang=EN-US>)</span>，所以基本上你的擔心完全是多餘的，如果真的有<span
lang=EN-US>PC</span>程式讓<span lang=EN-US>heap</span>與<span lang=EN-US>stack</span>的頂端交會了，那麼這個程式要不是複雜的不得了，不然就是錯的很離譜。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>在嵌入式系統通常就沒麼好運了，除非使用了有<span
lang=EN-US>MMU(Memory Management Unit)</span>的<span lang=EN-US>CPU</span>，否則就得由系統工程師計算所有程式可能的最大的動態記憶體用量，並依據系統記憶體的狀態，配置一塊足夠大的區域當作<span
lang=EN-US>heap</span>。在嵌入式系統中，我們可以依需求與應用自行配置記憶體的用途，例如某個主要的應用在計算時就一定要用掉<span
lang=EN-US>100K Byte</span>的記憶體，此時系統工程師就可以分配一塊適合大小的記憶體讓這個功能專用；這樣的記憶體區塊不是我們即將討論的<span
lang=EN-US>heap</span>，所謂的<span lang=EN-US>heap(</span>或說動態記憶體<span lang=EN-US>)</span>是工程師可以透過諸如<span
lang=EN-US>malloc()</span>與<span lang=EN-US>free()</span>這樣的函數，或是<span
lang=EN-US>C++</span>的<span lang=EN-US>new/delete operator</span>來操作的記憶體區塊。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>通常這個<span lang=EN-US>heap</span>我們也可以稱之為<span
lang=EN-US>memory pool</span>，這個名字是不是比較傳神一些？相信你以前在學校修資料結構的時候應該學過記憶體管理吧，像是<span
lang=EN-US>first-fit</span>、<span lang=EN-US>worst-fit</span>與<span lang=EN-US>best
fit method</span>這些東西，還記得嗎？<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『早就全忘光了，我以為這些演算法就像線性代數或工程數學一樣，應該一輩子都用不到。我只大概記得動態記憶體管理就是把一大塊記憶體，應該就是你說的<span
lang=EN-US>memory pool</span>，依據程式<span lang=EN-US>allocate</span>時的<span
lang=EN-US>size</span>切割成一塊塊串起來的記憶體區塊，每塊記憶體的開頭是一個資料結構，稱為<span lang=EN-US>Memory
Control Block(MCB)</span>，紀錄有該記憶體區塊的<span lang=EN-US>size</span>、下一個<span
lang=EN-US>/</span>上一個記憶體區塊的位址以及其他資訊等等；用說的說不清楚，請看以下圖示。<span style='display:
none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:18.0pt;
mso-line-height-rule:exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";
color:red'><!--[if gte vml 1]><v:shape id="_x0000_i1026" type="#_x0000_t75"
 style='width:207.75pt;height:311.25pt'>
 <v:imagedata src="/b2/CH08_03.files/image003.jpg" o:title="08-05-動態記憶體管理架構圖"/>
</v:shape><![endif]--><![if !vml]><img width=277 height=415
src="/b2/CH08_03.files/image004.jpg" v:shapes="_x0000_i1026"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc164247022"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>8-5(a)</span>：動態記憶體管理架構圖</span></a><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<h3 style='line-height:18.0pt;mso-line-height-rule:exactly'><a
name="_Toc304922549"><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>Allocate
&amp; Free</span></a><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></h3>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>系統老鳥：『當然還有許多動態記憶體管理的演算法，像是<span
lang=EN-US> boundary tag method</span>及<span lang=EN-US>buddy system</span>，但在嵌入式系統中我們通常用的就是這種。你畫的這張圖就是<span
lang=EN-US>heap</span>管理的基本架構，而所謂的<span lang=EN-US>first-fit</span>、<span
lang=EN-US>worst-fit</span>與<span lang=EN-US>best fit method</span>等演算法，就是當其他程式呼叫<span
lang=EN-US>malloc()</span>時，如何在這些串起來的記憶體區塊中，找到合適的區塊；今天就姑且幫你複習一下吧：<span
style='display:none;mso-hide:all'>ˊˊ用台　</span><span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>假設所需求的記憶體<span
lang=EN-US>size</span>為<span lang=EN-US>N</span>：<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l7 level1 lfo10;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>First Fit</span><span
style='font-family:"微軟正黑體","sans-serif"'>：自<span lang=EN-US>memory pool</span>中記憶體串列的開頭往下找尋，直到尋得第一塊空間大於或等於<span
lang=EN-US>N</span>的可用記憶體區塊。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l7 level1 lfo10;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>Best Fit</span><span
style='font-family:"微軟正黑體","sans-serif"'>：尋遍整個記憶體串列，選擇一塊空間最接近<span lang=EN-US>N</span>的可用記憶體區塊。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l7 level1 lfo10;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>Worst Fit</span><span
style='font-family:"微軟正黑體","sans-serif"'>：選擇一塊空間最大的可用記憶體區塊；有時採用此法的原因是<span
lang=EN-US>size</span>最大片的記憶體區段使用了一部分後，仍可供其他程式使用，減少小片段記憶體區塊的產生。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>因為<span lang=EN-US>worst-fit</span>與<span
lang=EN-US>bets-fit method</span>都要尋遍整個記憶體串列才能選出合適的區塊，當串列成員很多時，效能自然會變慢，所以通常我們都採用最簡單的<span
lang=EN-US>first-fit method</span>。』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『我記起來了，在學校修演算法時有學過這些東西；我還記得這三個方法都各有缺點，<span
lang=EN-US>first-fit</span>固然簡單，但容易製造許多<span lang=EN-US>size</span>小到為無法供程式使用的記憶體區塊<span
lang=EN-US>(</span>碎塊<span lang=EN-US>)</span>，而且每次都從頭開始尋找，如果程式複雜一點，勢必會在記憶體串列的開頭集合了很多碎塊，則搜尋可用區塊的速度會越來越慢。<span
style='display:none;mso-hide:all'>多時間來測試管理ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>系統老鳥：『這的確是<span
lang=EN-US>first fit</span>的缺點，我們很難完全避免碎塊的產生，但是可以透過以下三個方法減少碎塊的產生或減緩碎塊的影響：<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:68.25pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-41.25pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l3 level1 lfo12;tab-stops:list 68.25pt'><![if !supportLists]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";mso-bidi-font-family:微軟正黑體'><span
style='mso-list:Ignore'>a.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:"微軟正黑體","sans-serif"'>取一適當常數<span
lang=EN-US>n</span>，若配置後剩下的記憶體<span lang=EN-US>size</span>小於等於<span lang=EN-US>n</span>的時候，則整塊記憶體都分配給要求配置記憶體的程式，這樣可以減少小塊記憶體區塊的產生。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:68.25pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-41.25pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l3 level1 lfo12;tab-stops:list 68.25pt'><![if !supportLists]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";mso-bidi-font-family:微軟正黑體'><span
style='mso-list:Ignore'>b.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:"微軟正黑體","sans-serif"'>將記憶體串列建構成環狀串列，每次搜尋可用記憶體區塊都自串列的不同點開始搜尋，使得小塊記憶體可以盡量均勻分布在整個串列中。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:68.25pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-41.25pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l3 level1 lfo12;tab-stops:list 68.25pt'><![if !supportLists]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";mso-bidi-font-family:微軟正黑體'><span
style='mso-list:Ignore'>c.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:"微軟正黑體","sans-serif"'>程式歸還記憶體區塊時，系統必須檢查該記憶體區塊的鄰邊是否也是空閒區塊，如果是的話必須將其合併為較大的一塊記憶體區塊。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:27.0pt;text-align:justify;text-justify:
inter-ideograph;line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>這些方法都不會太複雜，基本上我們系統用的動態記憶體管理演算法就是<span
lang=EN-US>first fit method</span>加上這三個策略。』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<h3 style='line-height:18.0pt;mso-line-height-rule:exactly'><a
name="_Toc304922550"><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>API</span></a><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></h3>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『這個動態記憶體管理原理雖然很簡單，但實際運作起來應該狀況很多，誰知道其他程式會怎麼用它？我想應該要花很多時間來測試相關的程式吧？<span
style='display:none;mso-hide:all'>多時間來測試管理ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>系統老鳥：『大量測試是需要的，但我們不會重新寫動態記憶體管理的函式；你只需要知道動態記憶體管理的與原理與觀念即可，因為我們太容易可以取得現成且已應用在嵌入式系統的<span
lang=EN-US>API</span>及其<span lang=EN-US>source code</span>，這種<span lang=EN-US>API</span>很簡單，只有三個函數：<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>int ansi_InitMalloc
(void * start_address, int size) ;<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>void *sys_malloc(int
size) ;<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>int sys_free(void*
ptr) ;<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>基本上系統工程師只要把<span
lang=EN-US>Heap</span>記憶體區段的起始位址與<span lang=EN-US>size</span>傳入，其他程式就可以使用<span
lang=EN-US>malloc</span>與<span lang=EN-US>free</span>這兩個函數<span lang=EN-US>(</span>當然函數名字可能不一樣<span
lang=EN-US>)</span>向系統要求配置動態記憶體。我們系統中的動態記憶體管理程式也是從<span lang=EN-US>GNU ANSI-C</span>函式庫中“抄來的”，有空試著把程式看懂，不會很難的<a
style='mso-footnote-id:ftn1' href="#_ftn1" name="_ftnref1" title=""><span
class=MsoFootnoteReference><span lang=EN-US><span style='mso-special-character:
footnote'><![if !supportFootnotes]><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:12.0pt;font-family:"微軟正黑體","sans-serif";mso-bidi-font-family:
"Times New Roman";mso-font-kerning:1.0pt;mso-ansi-language:EN-US;mso-fareast-language:
ZH-TW;mso-bidi-language:AR-SA'>[1]</span></span><![endif]></span></span></span></a>。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'>===========================================================================<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>以下程式取自<span lang=EN-US>GNU
ANSI C </span>函式庫中的動態記憶體管理模組，它使用另外一種演算法，記憶體區塊的資訊不是分散記錄在<span lang=EN-US>MCB</span>中，而是統一記錄在一個表格裡，但基本原理是一樣的；這是一個效率還不錯的演算法，實務上也已經通過產品化的驗證。系統工程師只要先配置出一個記憶體區域，將起始位址以及<span
lang=EN-US>size</span>傳入<span lang=EN-US>ansi_InitMalloc()</span>函數，此後應用程式就可以用<span
lang=EN-US>malloc()</span>與<span lang=EN-US>free()</span>來使用動態記憶體配置的功能。雖然程式基本上不是太複雜，讀者實在也無需完全看懂，只要能將其移植到自己的系統中運作即可。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-indent:27.0pt;mso-char-indent-count:2.25;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=center style='text-align:center;text-indent:27.0pt;
mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><!--[if gte vml 1]><v:shape
 id="_x0000_i1027" type="#_x0000_t75" style='width:378pt;height:248.25pt'>
 <v:imagedata src="/b2/CH08_03.files/image005.jpg" o:title="13-01-GNU動態記憶體管理演算法"/>
</v:shape><![endif]--><![if !vml]><img width=504 height=331
src="/b2/CH08_03.files/image006.jpg" v:shapes="_x0000_i1027"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc164247023"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>8-5(b)</span>：動態記憶體管理架構圖<span
lang=EN-US> - 2</span></span></a><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none;mso-border-alt:solid windowtext .5pt;
 mso-yfti-tbllook:480;mso-padding-alt:0cm 5.4pt 0cm 5.4pt;mso-border-insideh:
 .5pt solid windowtext;mso-border-insidev:.5pt solid windowtext'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
  <td width=684 valign=top style='width:513.0pt;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>#define TBL_WIDTH<span
  style='mso-spacerun:yes'>  </span>8<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>unsigned char
  *ansi_ucStartAlloc;<span style='mso-spacerun:yes'>   </span><span
  style='mso-spacerun:yes'>  </span>/* allocate area, start address */<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>unsigned char
  *ansi_ucEndAlloc;<span style='mso-spacerun:yes'>     </span>/* allocate area,
  end address<span style='mso-spacerun:yes'>   </span>*/<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>unsigned char
  *ansi_ucNxtAlcP;<span style='mso-spacerun:yes'>      </span>/* next allocate
  address<span style='mso-spacerun:yes'>        </span>*/<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>unsigned char
  *ansi_ucTblPtr;<span style='mso-spacerun:yes'>       </span><span
  style='mso-spacerun:yes'> </span>/* next address for table<span
  style='mso-spacerun:yes'>       </span>*/<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>unsigned long
  ansi_ulRow;<span style='mso-spacerun:yes'>           </span>/* table
  count<span style='mso-spacerun:yes'>   </span>*/<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>/*<b style='mso-bidi-font-weight:
  normal'> Control Table */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>typedef struct {<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'> </span><span style='mso-spacerun:yes'>      </span>unsigned
  long ulAddrTbl;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>       </span>unsigned long ulSizeTbl;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>} sTable ;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>/*<b style='mso-bidi-font-weight:
  normal'> calculate pointer and size consider boundary size */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>#define _BOUND(siz) ((siz
  + _BOUNDARY - 1) &amp; (~(_BOUNDARY - 1)))<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>// </span><b
  style='mso-bidi-font-weight:normal'><span style='font-family:"微軟正黑體","sans-serif";
  color:blue'>搬移表格內的元素<span lang=EN-US> - </span>往高位址<span lang=EN-US>shift</span>一個單位<span
  lang=EN-US><o:p></o:p></span></span></b></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>//<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>extern void
  ANSI_SFTR1ROW(unsigned long address, unsigned long count) ;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>/************************************************************************<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span style='mso-tab-count:
  1'>        </span><b style='mso-bidi-font-weight:normal'>Function :
  ansi_InitMalloc<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>************************************************************************/<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>int
  ansi_InitMalloc(unsigned long ulStartAlloc, unsigned long ulEndAlloc)<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>{<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span><b style='mso-bidi-font-weight:normal'>/*
  allocate start address, 4byte boundary */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>ansi_ucStartAlloc = (unsigned char
  *)((ulStartAlloc + 3) &amp; 0xfffffffc);<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span><b style='mso-bidi-font-weight:normal'>//
  allocate end address, 4byte boundary<span
  style='mso-spacerun:yes'>                             </span><o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>ansi_ucEndAlloc = (unsigned char
  *)((ulEndAlloc +3) &amp; 0xfffffffc);<span style='mso-spacerun:yes'>  </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>if ( ansi_ucStartAlloc + TBL_WIDTH + 8
  &gt; ansi_ucEndAlloc )<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>        </span>return(1);<span
  style='mso-spacerun:yes'>                                             </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>ansi_ucNxtAlcP<span
  style='mso-spacerun:yes'>  </span>= ansi_ucStartAlloc;<span
  style='mso-spacerun:yes'>            </span><span
  style='mso-spacerun:yes'> </span><b style='mso-bidi-font-weight:normal'><span
  style='mso-spacerun:yes'> </span>//next allocate address </b><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>ansi_ucTblPtr<span
  style='mso-spacerun:yes'>   </span>= ansi_ucEndAlloc - TBL_WIDTH; <b
  style='mso-bidi-font-weight:normal'><span style='mso-spacerun:yes'> </span>//
  table start address<span style='mso-spacerun:yes'>  </span></b><span
  style='mso-spacerun:yes'> </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>ansi_ulRow<span
  style='mso-spacerun:yes'>      </span>= 0;<span
  style='mso-spacerun:yes'>                           </span><b
  style='mso-bidi-font-weight:normal'>// table row count<span
  style='mso-spacerun:yes'>  </span></b><span style='mso-spacerun:yes'> </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>return(0);<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>}<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1'>
  <td width=684 valign=top style='width:513.0pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>/************************************************************************<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span style='mso-tab-count:
  1'>        </span><b style='mso-bidi-font-weight:normal'>Function : malloc<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>************************************************************************/<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>void * malloc(size_t
  tdSiz)<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>{<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>sTable *stTblPtr;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>unsigned long ulSizeWk;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>unsigned long ulAddrWk;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>unsigned long ulTemp;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>unsigned long ulAddrTmp;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>int iErrors=0;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>int iCount;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>int iRow;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>if (tdSiz == 0)<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>        </span>return<span
  style='mso-spacerun:yes'>  </span>(void *)NULL;<span style='mso-tab-count:
  2'>                </span><b style='mso-bidi-font-weight:normal'>/* illegal
  argument */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><b style='mso-bidi-font-weight:
  normal'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>/* table start address */<o:p></o:p></span></b></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>stTblPtr = (sTable *)(ansi_ucEndAlloc -
  TBL_WIDTH); <o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>if ((( ansi_ucTblPtr) - ansi_ucNxtAlcP )
  &lt; TBL_WIDTH )<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>{<span style='mso-spacerun:yes'>  </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>        </span>errno = ENOMEM;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>        </span>return(void *)NULL;<span
  style='mso-tab-count:2'>            </span><b style='mso-bidi-font-weight:
  normal'>/* can not allocate memory */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>}<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><b style='mso-bidi-font-weight:
  normal'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>/* table check, top to botom
  --------------------------*/<o:p></o:p></span></b></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>for ( iCount=0; iCount &lt; ansi_ulRow;
  iCount++, stTblPtr-- )<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>{<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>        </span>ulTemp = stTblPtr-&gt;ulSizeTbl &amp;
  0x00000001;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>        </span>if ( ulTemp == 0)<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>        </span>{ <o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>            </span><b style='mso-bidi-font-weight:
  normal'>// this block is free area<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>            </span>if (stTblPtr-&gt;ulSizeTbl &gt;=
  _BOUND(tdSiz))<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>            </span>{ <o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>               </span><b style='mso-bidi-font-weight:
  normal'><span style='mso-spacerun:yes'> </span>/* check memory space */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span>ulSizeWk =
  stTblPtr-&gt;ulSizeTbl - _BOUND(tdSiz);<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>               </span><b style='mso-bidi-font-weight:
  normal'><span style='mso-spacerun:yes'> </span>/* rest memory size<span
  style='mso-spacerun:yes'>   </span>*/<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span>stTblPtr-&gt;ulSizeTbl =
  _BOUND(tdSiz) | 0x1;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span>ulAddrWk =
  stTblPtr-&gt;ulAddrTbl;<span style='mso-spacerun:yes'>            </span><b
  style='mso-bidi-font-weight:normal'><span style='mso-spacerun:yes'> </span>/*
  allocated address<span style='mso-spacerun:yes'>  </span>*/</b><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span><b style='mso-bidi-font-weight:
  normal'>/* rest data size is not zero, and not last table data -----------*/<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span>if ( ulSizeWk &gt; 0 )<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span style='mso-tab-count:
  2'>                </span><span style='mso-spacerun:yes'>        </span>{<span
  style='mso-spacerun:yes'>                                       </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>ulAddrTmp = (unsigned
  long)(ansi_ucTblPtr);<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>iRow = ansi_ulRow -
  iCount -1;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span><b style='mso-bidi-font-weight:
  normal'>/* shift table data*/</b><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>ANSI_SFTR1ROW( ulAddrTmp,
  iRow );<span style='mso-spacerun:yes'>      </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>stTblPtr--;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>stTblPtr-&gt;ulSizeTbl =
  ulSizeWk;<span style='mso-spacerun:yes'>         </span><b style='mso-bidi-font-weight:
  normal'>/* entry, rest size<span style='mso-spacerun:yes'>   </span>*/</b><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>stTblPtr-&gt;ulAddrTbl =
  ulAddrWk + _BOUND(tdSiz);<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>ansi_ucTblPtr -= TBL_WIDTH;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>ansi_ulRow++;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span>}<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span>return (void *)ulAddrWk;<span
  style='mso-spacerun:yes'>                        </span><b style='mso-bidi-font-weight:
  normal'>/* normal end */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>            </span>}<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>           </span><b style='mso-bidi-font-weight:
  normal'><span style='mso-spacerun:yes'> </span>/* memory space are
  insufficient, continue next row line */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>        </span>} <o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>       </span><b style='mso-bidi-font-weight:normal'><span
  style='mso-spacerun:yes'> </span>/* not memory space, continue next row line
  */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>}<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>if (( ansi_ucTblPtr - ansi_ucNxtAlcP )
  &lt; (_BOUND(tdSiz)+TBL_WIDTH ))<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>{<span
  style='mso-spacerun:yes'>           </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>        </span>errno = ENOMEM;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>        </span>return(void *)NULL;<span
  style='mso-tab-count:1'>    </span><b style='mso-bidi-font-weight:normal'>/*
  can not allocate memory */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>} <o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>else <o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>{<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>       </span><b style='mso-bidi-font-weight:normal'><span
  style='mso-spacerun:yes'> </span>/* entry, new row line */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>        </span>ulAddrWk = (unsigned
  long)ansi_ucNxtAlcP;<span style='mso-spacerun:yes'>          </span><b
  style='mso-bidi-font-weight:normal'><span style='mso-spacerun:yes'> </span>/*
  allocated top address */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>        </span>stTblPtr-&gt;ulAddrTbl =
  ulAddrWk;<span style='mso-spacerun:yes'>                    </span><b
  style='mso-bidi-font-weight:normal'><span style='mso-spacerun:yes'> </span>/*
  allocated top address */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>        </span>stTblPtr-&gt;ulSizeTbl =
  _BOUND(tdSiz) | 0x1;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>        </span>ansi_ucNxtAlcP =
  ansi_ucNxtAlcP+_BOUND(tdSiz);<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>        </span>ansi_ulRow++;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>        </span>ansi_ucTblPtr -= TBL_WIDTH;<span
  style='mso-spacerun:yes'>                        </span><b style='mso-bidi-font-weight:
  normal'><span style='mso-spacerun:yes'> </span>/* next pointer */</b><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>        </span>return (void *)ulAddrWk;<span
  style='mso-spacerun:yes'>                           </span><b
  style='mso-bidi-font-weight:normal'><span style='mso-spacerun:yes'> </span>/*
  normal end */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>}<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>}<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><b style='mso-bidi-font-weight:
  normal'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>//
  </span></b><b style='mso-bidi-font-weight:normal'><span style='font-family:
  "微軟正黑體","sans-serif";color:blue'>搬移表格內的元素<span lang=EN-US> - </span>往高位址<span
  lang=EN-US>shift</span>一個單位<span lang=EN-US><o:p></o:p></span></span></b></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><b style='mso-bidi-font-weight:
  normal'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>//
  (</span></b><b style='mso-bidi-font-weight:normal'><span style='font-family:
  "微軟正黑體","sans-serif";color:blue'>一個單位<span lang=EN-US>8</span>個<span
  lang=EN-US>bytes)<o:p></o:p></span></span></b></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>//<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>void
  ANSI_SFTR1ROW(unsigned long address, unsigned long count)<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>{<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'> </span>int i ;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'> </span>unsigned long * entry = (unsigned long
  *)address ;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'> </span>unsigned long * next_entry = (unsigned long
  *)(address+8) ;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'> </span>for(i=0;i&lt;count;i++)<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'> </span>{<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span style='mso-tab-count:
  1'>        </span>entry[i*2] = next_entry[i*2] ;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span style='mso-tab-count:
  1'>        </span>entry[i*2+1] = next_entry[i*2+1] ;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'> </span>}<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>}</span><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;mso-yfti-lastrow:yes'>
  <td width=684 valign=top style='width:513.0pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>/************************************************************************<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span style='mso-tab-count:
  1'>        </span><b style='mso-bidi-font-weight:normal'>Function : free<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>************************************************************************/<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>void free(void *
  vpFrePtrP)<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>{<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>sTable<span style='mso-spacerun:yes'> 
  </span>*sTblPtrFre; <o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>unsigned long ulAddrWk;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>unsigned long ulSizeWk;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>unsigned long ulSizeWk2;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>int iLoop, iRowCnt;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>if (vpFrePtrP == NULL) <span
  style='mso-spacerun:yes'>     </span><b style='mso-bidi-font-weight:normal'><span
  style='mso-spacerun:yes'> </span>/* check argument */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>        </span>return;<span
  style='mso-spacerun:yes'>                </span><b style='mso-bidi-font-weight:
  normal'><span style='mso-spacerun:yes'> </span>/* error */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>sTblPtrFre = (sTable *)(ansi_ucEndAlloc -
  TBL_WIDTH);<span style='mso-spacerun:yes'>   </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                                </span>/*<b
  style='mso-bidi-font-weight:normal'> get table_start_address */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span><b style='mso-bidi-font-weight:normal'>/*
  do search */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>for ( iLoop=0; iLoop &lt; ansi_ulRow;
  iLoop++, sTblPtrFre--)<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>{<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>       </span><b style='mso-bidi-font-weight:normal'><span
  style='mso-spacerun:yes'> </span>/* if found data then */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>        </span>if (vpFrePtrP == (void
  *)(sTblPtrFre-&gt;ulAddrTbl))<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>        </span>{<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>           </span><b style='mso-bidi-font-weight:
  normal'><span style='mso-spacerun:yes'> </span>/* crear flag */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>            </span>ulSizeWk =
  sTblPtrFre-&gt;ulSizeTbl &amp; 0xfffffffe;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>            </span>sTblPtrFre-&gt;ulSizeTbl =
  ulSizeWk;<span style='mso-spacerun:yes'>   </span><b style='mso-bidi-font-weight:
  normal'>/* flag clear &amp; store size */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>           </span><b style='mso-bidi-font-weight:
  normal'><span style='mso-spacerun:yes'> </span>/* if last data */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>            </span>if (iLoop==ansi_ulRow-1)<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>            </span>{<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span>ansi_ulRow--;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span>ansi_ucTblPtr += TBL_WIDTH;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span>ansi_ucNxtAlcP -= ulSizeWk;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span>sTblPtrFre += 1;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span>if ((ansi_ulRow != 0)
  &amp;&amp; (sTblPtrFre-&gt;ulSizeTbl &amp; 0x1)==0 )<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span>{<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>ulSizeWk2 =
  sTblPtrFre-&gt;ulSizeTbl;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>sTblPtrFre-&gt;ulSizeTbl
  = ulSizeWk + ulSizeWk2;<span style='mso-spacerun:yes'>  </span><b
  style='mso-bidi-font-weight:normal'><span style='mso-spacerun:yes'> </span>/*
  store size */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>ansi_ulRow--;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>ansi_ucTblPtr +=
  TBL_WIDTH;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>ansi_ucNxtAlcP -=
  ulSizeWk2;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span>}<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>            </span>}<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>           </span>else <o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>            </span>{<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span>/<b style='mso-bidi-font-weight:
  normal'>* marge &amp; shift */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><b style='mso-bidi-font-weight:
  normal'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span>/* check previouse table */<o:p></o:p></span></b></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span>if (( iLoop != 0) &amp;&amp;
  ((sTblPtrFre+1)-&gt;ulSizeTbl &amp; 0x1)==0 )<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span>{<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>ulAddrWk = (unsigned
  long)sTblPtrFre;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>sTblPtrFre++;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>ulSizeWk = ulSizeWk +
  (sTblPtrFre-&gt;ulSizeTbl);<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>sTblPtrFre-&gt;ulSizeTbl
  = ulSizeWk;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>iRowCnt = ansi_ulRow -
  iLoop -1;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                   
  </span>ANSI_SFTF1ROW(ulAddrWk,iRowCnt);<span style='mso-spacerun:yes'>    
  </span><b style='mso-bidi-font-weight:normal'><span
  style='mso-spacerun:yes'> </span>/* shift, table data */</b><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>ansi_ulRow--;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>ansi_ucTblPtr +=
  TBL_WIDTH;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>             </span><span
  style='mso-spacerun:yes'>       </span>iLoop--;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span>}<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span>if (( iLoop &lt; ansi_ulRow )
  &amp;&amp; ((sTblPtrFre-1)-&gt;ulSizeTbl &amp; 0x1)== 0)<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span>{<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>sTblPtrFre-&gt;ulSizeTbl
  = ulSizeWk + ((sTblPtrFre-1)-&gt;ulSizeTbl);<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>             </span><span
  style='mso-spacerun:yes'>       </span>iLoop++;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>sTblPtrFre --;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>iRowCnt = ansi_ulRow -
  iLoop -1;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>ulAddrWk = (unsigned
  long)sTblPtrFre;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                   
  </span>ANSI_SFTF1ROW(ulAddrWk,iRowCnt);<span style='mso-spacerun:yes'>   
  </span><b style='mso-bidi-font-weight:normal'><span
  style='mso-spacerun:yes'>  </span>/* shift, table data */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>            </span><span
  style='mso-spacerun:yes'>        </span>ansi_ulRow--;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                    </span>ansi_ucTblPtr +=
  TBL_WIDTH;<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>                </span>}<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>            </span>}<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>            </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>            </span>return;<span
  style='mso-spacerun:yes'>    </span><b style='mso-bidi-font-weight:normal'><span
  style='mso-spacerun:yes'> </span>/* normal end */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>        </span>}<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>}<o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span><o:p></o:p></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'><span
  style='mso-spacerun:yes'>    </span>return; <span
  style='mso-spacerun:yes'>    </span><b style='mso-bidi-font-weight:normal'><span
  style='mso-spacerun:yes'> </span>/* do not found */<o:p></o:p></b></span></p>
  <p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
  line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif";color:blue'>}</span><span lang=EN-US
  style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>
  </td>
 </tr>
</table>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc164247024"><span
style='font-family:"微軟正黑體","sans-serif"'>程式<span lang=EN-US>8-3</span>：動態記憶體管理演算法範例</span></a><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<h3 style='line-height:18.0pt;mso-line-height-rule:exactly'><a
name="_Toc304922551"><span style='font-family:"微軟正黑體","sans-serif"'>碎塊處理？</span></a><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></h3>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>系統老鳥：『隨著程式每次執行時的順序與狀態的不同，會呼叫<span
lang=EN-US>allocate/free</span>的次數、順序、大小也不同，當然<span lang=EN-US>memory pool</span>內記憶體區塊的狀態也會大不相同；久而久之，整個記憶體串列中會出現許多分散在串列各處，<span
lang=EN-US>size</span>比較小，明顯用不到的記憶體區塊，這就是所謂的碎塊<span lang=EN-US>(fragment)</span>。最差的狀況是明明整個串列中可以用的記憶體區塊<span
lang=EN-US>size</span>總和還很大，但程式要求配置記憶體時卻找不到一塊足夠大的記憶體區塊；如果產品出貨後才發生這個問題就麻煩了，對使用者來說會感覺某個功能本來可以用，怎麼突然不能用了？這個狀況多發生個幾次，使用者的結論就是
<span lang=EN-US>– </span>“系統不穩定”，<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>這是個很棘手的問題，整個系統一定是經過長時間的運作才可能產生過多的碎塊，至於中間到底做了什麼操作實在很難一一紀錄，也就是說不容易找到一個手法可以讓問題重現，所以工程師要追蹤問題就比較困難。而且這種問題通常是累積下來的，並不一定是哪一個程式的<span
lang=EN-US>bug</span>，要修改就比較困難。』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『既然碎塊的問題那麼麻煩，我們難到沒辦法像<span
lang=EN-US>Java</span>一樣實現<span lang=EN-US>garbage collection</span>嗎？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>系統老鳥：『你要先知道兩件事，第一，在<span
lang=EN-US>C</span>語言中，系統配置一塊記憶體給程式後，程式得到的是一個指標，此後程式就是透過這個指標來操作這塊記憶體。第二，所謂的<span
lang=EN-US>garbage collection</span>就是設法將所有不用的記憶體或者碎塊集合成一塊，如果系統提供虛擬記憶體的功能，那麼只要改變虛擬位址和實體位址的對應關係，程式就可以使用同樣的指標繼續正確運行。如果我們的系統無法提供虛擬記憶體，而我們記憶體管理架構就像上圖<span
lang=EN-US>(</span>圖<span lang=EN-US>8-5(a))</span>一樣，你覺得我們要實現<span lang=EN-US>garbage
collection</span>會碰到什麼問題？<span style='display:none;mso-hide:all'>址改變ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『要收集<span
lang=EN-US>memory pool</span>裡所有的碎塊，最簡單的方式就是將所有已配置的區塊全部往上移動；其他<span lang=EN-US>available</span>的區塊，無論大小，就可以結合成一塊，則<span
lang=EN-US>memory pool</span>內就再無碎塊可言，如下圖。可是移動已配置的區塊自然就會改變其位址，也就是說，碎塊整理後各個已配置區塊的位址已經和程式呼叫<span
lang=EN-US>malloc()</span>時取得的位址不一樣了，應用程式是用一個指標變數來記錄動態記憶體區塊的位址，記憶體管理程式怎麼有辦法去改變應用程式裡指標的值？所以在這種記憶體管理架構下是無法實現<span
lang=EN-US>garbage collection</span>的囉？<span style='display:none;mso-hide:all'>經是說移動就是統上會怎麼用它？我想應該應該要花很多時間來測試和ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:18.0pt;
mso-line-height-rule:exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><!--[if gte vml 1]><v:shape
 id="_x0000_i1028" type="#_x0000_t75" style='width:309.75pt;height:319.5pt'>
 <v:imagedata src="/b2/CH08_03.files/image007.jpg" o:title="08-06-碎塊收集"/>
</v:shape><![endif]--><![if !vml]><img width=413 height=426
src="/b2/CH08_03.files/image008.jpg" v:shapes="_x0000_i1028"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc164247025"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>8-6</span>：碎塊收集</span></a><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>系統老鳥：『要做還是有辦法的，只是當應用程式呼叫<span
lang=EN-US>malloc()</span>時不能直接傳回指標，而是傳回一個<span lang=EN-US>handle</span>；記憶體管理系統必須維護每一個已配置區塊的<span
lang=EN-US>handle</span>與位址的對應表，而應用程式每次要使用已配置之記憶體區塊之前，都要先透過<span lang=EN-US>API</span>將<span
lang=EN-US>handle</span>轉為實際的位址。使用這樣的作法，就可以在作完碎塊收集後，即使各個記憶體區塊的位址已經改變，應用程式仍然可以正常運作。請看以下範例：<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>//
</span></b><b style='mso-bidi-font-weight:normal'><span style='font-family:
"微軟正黑體","sans-serif";color:blue'>傳統的記憶體配置方式<span lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>//<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>//
</span></b><b style='mso-bidi-font-weight:normal'><span style='font-family:
"微軟正黑體","sans-serif";color:blue'>配置四個整數的動態記憶體<span lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>//<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>unsigned int *ptr =
(unsigned int *)malloc(sizeof(int) * 4) ;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>ptr[0] = 1111 ;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>ptr[1] = 2222 ;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>ptr[2] = 3333 ;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>ptr[3] = 4444 ;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>//
</span></b><b style='mso-bidi-font-weight:normal'><span style='font-family:
"微軟正黑體","sans-serif";color:blue'>使用<span lang=EN-US>handle</span>的記憶體配置方式<span
lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>unsigned int handle = 0 ;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>unsigned int * ptr = NULL ;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>handle = malloc(sizeof(int)
* 4) ;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>//
</span></b><b style='mso-bidi-font-weight:normal'><span style='font-family:
"微軟正黑體","sans-serif";color:blue'>取得真正的位址<span lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>//<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>ptr =
sys_get_memory_block_real_address(handle) ;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>ptr[0] = 1111 ;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>ptr[1] = 2222 ;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>ptr[2] = 3333 ;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-para-margin-left:2.0gd;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>ptr[3] = 4444 ;<o:p></o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『這樣的作法不但程式寫作麻煩，而且效能恐怕也會受影響吧。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>系統老鳥：『沒錯，更嚴重的是工程師往往容易疏忽甚至陽奉陰違，取得動態記憶體的位址後就一直用，當系統作完一次<span
lang=EN-US>garbage collection</span>後，<span lang=EN-US>memory pool</span>內的記憶體區塊都被移動了，使用到動態記憶體的程式如果沒有重新由<span
lang=EN-US>handle</span>取得正確的位址，當然無法正確運作；原本驗證<span lang=EN-US>OK</span>的程式，加入<span
lang=EN-US>garbage collection</span>的機制後都變得“不穩定”了，當時的情況只能以哀鴻遍野來形容。當然我們可以要求工程師審慎檢視他們的程式，可是有些用之有年函式庫，要將所有的指標操作修改為<span
lang=EN-US>handle</span>操作恐怕是一個大工程，而且只要一個地方沒有改到就會出問題，一定要經過嚴謹的測試才行。如果是沒有<span
lang=EN-US>source code</span>的函式庫，而且其中使用了<span lang=EN-US>malloc/free</span>等函數，那更是不知該從何改起。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>基本上嵌入式系統和<span
lang=EN-US>Windows</span>或<span lang=EN-US>Linux</span>等開放性系統還是有本質上的不同，除了<span
lang=EN-US>PDA</span>或<span lang=EN-US>smart phone</span>這種可以讓使用者額外安裝程式的系統外<span
lang=EN-US>(</span>但通常這種系統會使用具有虛擬記憶體功能的<span lang=EN-US>CPU)</span>，電子產品可能的操作方式是被限制的，也就是說，即便是再複雜的應用，程式可能的執行流程“大部分”應該是可以被掌握的。所以我們可以要求工程師改善使用動態記憶體時的程式寫作習慣，以減少碎片產生的機會；基本的原則就是：“用完即還”、“有借有還，再借不難”。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>往往碎塊都是由工程師的疏忽或不好的程式寫作習慣所造成的，例如：<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:66.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-39.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l1 level1 lfo11;tab-stops:list 66.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";mso-bidi-font-family:微軟正黑體'><span
style='mso-list:Ignore'>a.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>allocate</span><span
style='font-family:"微軟正黑體","sans-serif"'>了一塊記憶體，當不使用後卻沒有歸還，這樣就會產生一個垃圾碎塊，如果這個有問題的模組一再被執行，系統累積的垃圾碎塊就會越來愈多，最後終於導致程式要不到記憶體可以用。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:66.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-39.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l1 level1 lfo11;tab-stops:list 66.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";mso-bidi-font-family:微軟正黑體'><span
style='mso-list:Ignore'>b.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:"微軟正黑體","sans-serif"'>負責<span
lang=EN-US>allocate</span>動態記憶體的程式與負責<span lang=EN-US>free</span>的程式屬於不同的模組，這也是碎塊產生的原因之一。主要是因為不同模組的設計邏輯、設計理念與負責工程師可能都不相同，實務上這種設計方式確實常常造成有些記憶體區塊沒有被<span
lang=EN-US>free</span>，應該盡量避免這樣的設計。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";display:none;mso-hide:all'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:66.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-39.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l1 level1 lfo11;tab-stops:list 66.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";mso-bidi-font-family:微軟正黑體'><span
style='mso-list:Ignore'>c.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:"微軟正黑體","sans-serif"'>連<span
lang=EN-US>size</span>很小的記憶體區塊<span lang=EN-US>(</span>例如一個<span lang=EN-US>short
int)</span>都要向系統<span lang=EN-US>allocate</span>；這樣的程式風格未免有點矯枉過正了，無謂增加<span
lang=EN-US>memory pool</span>中的區塊個數，對動態記憶體管理系統的效能自然會有所影響。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:66.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-39.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l1 level1 lfo11;tab-stops:list 66.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";mso-bidi-font-family:微軟正黑體'><span
style='mso-list:Ignore'>d.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:"微軟正黑體","sans-serif"'>因為動態記憶體管理程式會把鄰接之未使用的記憶體區塊<span
lang=EN-US>merge</span>成一塊，所以工程師在配置與<span lang=EN-US>free</span>記憶體區塊時要稍微考量一下順序，有時候稍微改變一下順序就可以避免碎塊的產生。請看下面的例子：<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";display:none;mso-hide:all'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:27.0pt;text-align:justify;text-justify:
inter-ideograph;line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:63.0pt;mso-para-margin-left:5.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>// </span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:"微軟正黑體","sans-serif";
color:blue'>因為配置時<span lang=EN-US>Ptr_B</span>夾在<span lang=EN-US>Ptr_A</span>與<span
lang=EN-US>Ptr_C</span>的中間<span lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal style='margin-left:63.0pt;mso-para-margin-left:5.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>//
<b style='mso-bidi-font-weight:normal'>Ptr_A</b></span><b style='mso-bidi-font-weight:
normal'><span style='font-family:"微軟正黑體","sans-serif";color:blue'>與<span
lang=EN-US>Ptr_C</span>兩塊記憶體在<span lang=EN-US>memory pool</span>中連續的機率不高</span></b><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:63.0pt;mso-para-margin-left:5.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>//<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:63.0pt;mso-para-margin-left:5.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>Ptr_A
= malloc(10) ;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:63.0pt;mso-para-margin-left:5.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>Ptr_B
= malloc(1000) ;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:63.0pt;mso-para-margin-left:5.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>Ptr_C
= malloc(10) ;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:63.0pt;mso-para-margin-left:5.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>…<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:63.0pt;mso-para-margin-left:5.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>…<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:63.0pt;mso-para-margin-left:5.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>// </span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:"微軟正黑體","sans-serif";
color:blue'>如果<span lang=EN-US>Ptr_A</span>與<span lang=EN-US>Ptr_C</span>在<span
lang=EN-US>memory pool</span>中不是連續的區塊<span lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal style='margin-left:63.0pt;mso-para-margin-left:5.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>// </span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:"微軟正黑體","sans-serif";
color:blue'>則當它們被歸還後，變成碎塊的機率很高</span></b><span lang=EN-US style='font-family:
"微軟正黑體","sans-serif";color:blue'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:63.0pt;mso-para-margin-left:5.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>//<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:63.0pt;mso-para-margin-left:5.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>free(Ptr_C)
;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:63.0pt;mso-para-margin-left:5.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>free(Ptr_A)
;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:27.0pt;text-align:justify;text-justify:
inter-ideograph;line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:63.0pt;text-align:justify;text-justify:
inter-ideograph;line-height:18.0pt;mso-line-height-rule:exactly'><span
style='font-family:"微軟正黑體","sans-serif"'>換成如下的順序會不會比較好呢？雖然不能保證一起配置的記憶體區塊在<span
lang=EN-US>memory pool</span>中一定會是連續的區塊，但機率總是高一點，在這種狀況下，當<span lang=EN-US>Ptr_C</span>與<span
lang=EN-US>Ptr_A</span>歸還後就可以被<span lang=EN-US>merge</span>成一塊。若按照原來程式的順序，<span
lang=EN-US>Ptr_C</span>與<span lang=EN-US>Ptr_A</span>歸還後變成碎塊的可能性很高。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:27.0pt;text-align:justify;text-justify:
inter-ideograph;line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:63.0pt;mso-para-margin-left:5.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>Ptr_B
= malloc(1000) ;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:63.0pt;mso-para-margin-left:5.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:63.0pt;mso-para-margin-left:5.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>// Ptr_A</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:"微軟正黑體","sans-serif";
color:blue'>與<span lang=EN-US>Ptr_C</span>兩塊記憶體在<span lang=EN-US>memory pool</span>中連續的機率很高<span
lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal style='margin-left:63.0pt;mso-para-margin-left:5.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>//<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:63.0pt;mso-para-margin-left:5.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>Ptr_A
= malloc(10) ;<span style='mso-tab-count:2'>               </span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:63.0pt;mso-para-margin-left:5.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>Ptr_C
= malloc(10) ;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:27.0pt;text-align:justify;text-justify:
inter-ideograph;line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:27.0pt;text-align:justify;text-justify:
inter-ideograph;line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:66.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-39.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l1 level1 lfo11;tab-stops:list 66.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";mso-bidi-font-family:微軟正黑體'><span
style='mso-list:Ignore'>e.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:"微軟正黑體","sans-serif"'>通常整個系統包含許多應用程式或獨立功能的小模組，當某個應用程式執行完畢後應該要歸還所有配置的記憶體。在開發期間，當系統在處理應用程式切換的時候，可以檢查<span
lang=EN-US>memory pool</span>中是否還有未歸還的記憶體區塊，如果有的話，可以視為錯誤，要求負責的工程師修正。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:27.0pt;text-align:justify;text-justify:
inter-ideograph;line-height:18.0pt;mso-line-height-rule:exactly'><span
style='font-family:"微軟正黑體","sans-serif";display:none;mso-hide:all'>塊產生的原因之ㄧ組<span
lang=EN-US>\</span>程式避免多模組慣所造成ˊˊ用台　</span><span style='font-family:"微軟正黑體","sans-serif"'>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『所以你的意思是說：我們的系統中通常不會在執行時期去處理碎塊的問題，而是要求工程師改善寫做程式的習慣來控制碎塊的產生？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>系統老鳥：『嵌入式系統的應用範圍通常很固定，所以碎塊問題其實不是那麼難以控制。而且我們也試過許多方法來改善碎塊問題，例如使用兩個<span
lang=EN-US>(</span>或多個<span lang=EN-US>)memory pool</span>，一個專用來配置小塊的記憶體<span
lang=EN-US>(</span>如<span lang=EN-US>64 Bytes</span>以下<span lang=EN-US>)</span>，另一個則配置大塊的記憶體；這些方法雖然都可以某種程度地改善碎塊的問題，但都是治標不治本，效果都不如改善配置記憶體的程式風格。而且這些程式風格的要求在專案一開始就該明確宣達。否則當程式越來越複雜，且程式中的<span
lang=EN-US>alocate/free</span>都未按照規範寫作時，要透過檢查程式的行為來改善碎片的狀況已是緣木求魚，為時晚矣。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<h3 style='line-height:18.0pt;mso-line-height-rule:exactly'><a
name="_Toc304922552"><span style='font-family:"微軟正黑體","sans-serif"'>保護<span
lang=EN-US>Heap</span>？</span></a><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></h3>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『我們討論過<span
lang=EN-US>stack overflow</span>與<span lang=EN-US>underflow</span>的問題，如果程式不謹慎使用從<span
lang=EN-US>heap</span>配置得的記憶體，很容易就會破壞其他用途的記憶體；而且依照<span lang=EN-US>memory pool</span>中記憶體區塊的資料結來構來看，一旦程式超用某個動態記憶體區塊時，第一個被破壞的就是下一個記憶體區塊的<span
lang=EN-US>header(MCB)</span>，此來整個<span lang=EN-US>memory pool</span>中的記憶體區塊串列就會亂掉；我們有方法防止這種狀況的發生嗎？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>系統老鳥：『除了要求工程師改善程式寫作習慣外，幾乎沒有預防<span
lang=EN-US>stack</span>誤操作的方法；<span lang=EN-US>Heap</span>被破壞的問題也是如此，而且更容易發生，再加上破壞者和被破壞的記憶體區塊可能是由完全不相關的程式所配置，當發現某個記憶體區塊被破壞的時候，破壞者的記憶體區塊可能早已歸還，或已經再配置給其他程式，從記憶體串列的現狀根本無從查起。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>當某個程式會破壞<span
lang=EN-US>heap</span>時，會被影響的程式可能在每次執行時都不一樣，這種問題在系統整合階段<span lang=EN-US>(</span>或系統還不穩定的時候<span
lang=EN-US>)</span>出現簡直是要人命，感覺到處都有問題，工程師疲於奔命地檢查曾經出過錯的程式，但真正的元兇反而暫時不會被懷疑。<span
style='display:none;mso-hide:all'>壞者後生慣理演算法就是序就可以避免碎塊的產生。請看下面的例子；ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『如果最後查出許多<span
lang=EN-US>bug</span>都是因為<span lang=EN-US>Heap</span>被破壞所導致，那我們該怎麼找到始作俑者呢？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>系統老鳥：『方法說穿了也不複雜，首先我們系統要先實現一個檢查目前記憶體串列是否正常的函數，例如：<span
lang=EN-US>sys_checkMemoryList()</span>，這個函數也很簡單，只要遍詢整個串列，把所有區塊的<span
lang=EN-US>size</span>累加，看是否等於原先<span lang=EN-US>memory pool</span>的<span
lang=EN-US>size</span>。或者記憶體區塊的<span lang=EN-US>header</span>中可以包含特殊的訊息，例如<span
lang=EN-US>owner ID</span>或<span lang=EN-US>magic number(header</span>某個欄位的值一定是特殊數字，如果不是的話表示已被破壞<span
lang=EN-US>)</span>，若有異狀也表示<span lang=EN-US>heap</span>已被破壞。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>有了這個函數之後，接下來就是要找出到底是哪段程式執行過後，<span
lang=EN-US>heap</span>才出問題的；如果是你，你會怎麼做？<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『我想就是要先找出一個最簡單就會出問題的操作手法，然後利用上述檢查記憶體串列的函數<span
lang=EN-US>(sys_checkMemoryList())</span>，確認在問題發生之前記憶體串列已經不正常了。然後在出問題之前所有執行過的函數都去呼叫<span
lang=EN-US>sys_checkMemoryList()</span>，就可以查出在哪一個函數內記憶體串列的狀態由<span lang=EN-US>OK</span>變成<span
lang=EN-US>NG</span>，仔細檢查一下這個函數就八九不離十了。<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>系統老鳥：『基本上沒錯，雖然感覺上像是暴力法，但反而應該是最有效的辦法。值得注意的是：當記憶體串列狀況較複雜時，<span
lang=EN-US>sys_checkMemoryList()</span>可能要花掉不少時間，所以要小心這些用來除錯的程式千萬不能被編譯進正式版本中。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

</div>

<div style='mso-element:footnote-list'><![if !supportFootnotes]><br clear=all>

<hr align=left size=1 width="33%">

<![endif]>

<div style='mso-element:footnote' id=ftn1>

<p class=MsoFootnoteText><a style='mso-footnote-id:ftn1' href="#_ftnref1"
name="_ftn1" title=""><span class=MsoFootnoteReference><span lang=EN-US><span
style='mso-special-character:footnote'><![if !supportFootnotes]><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:10.0pt;font-family:
"Times New Roman","serif";mso-fareast-font-family:新細明體;mso-font-kerning:1.0pt;
mso-ansi-language:EN-US;mso-fareast-language:ZH-TW;mso-bidi-language:AR-SA'>[1]</span></span><![endif]></span></span></span></a><span
lang=EN-US> </span><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>請參考</span><a
name="_Toc163711625"><span lang=EN-US>”</span></a><span style='mso-bookmark:
_Toc163711625'><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>附錄</span><span
lang=EN-US>E: GNU ANSI C</span></span><span style='mso-bookmark:_Toc163711625'><span
style='font-family:"新細明體","serif";mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>函式庫的動態記憶體管理演算法</span></span><span
lang=EN-US>”</span></p>

</div>

</div>

</body>

</html>
