<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 12">
<meta name=Originator content="Microsoft Word 12">
<link rel=File-List href="/b2/CH07_03.files/filelist.xml">
<link rel=Edit-Time-Data href="/b2/CH07_03.files/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]-->
<title>7.3. 控制CPU</title>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="chmetcnv"/>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>cebm</o:Author>
  <o:LastAuthor>Win7User</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>14242</o:TotalTime>
  <o:LastPrinted>2007-04-13T10:03:00Z</o:LastPrinted>
  <o:Created>2011-09-28T15:22:00Z</o:Created>
  <o:LastSaved>2011-09-28T15:22:00Z</o:LastSaved>
  <o:Pages>27</o:Pages>
  <o:Words>6391</o:Words>
  <o:Characters>36433</o:Characters>
  <o:Company>Home</o:Company>
  <o:Lines>303</o:Lines>
  <o:Paragraphs>85</o:Paragraphs>
  <o:CharactersWithSpaces>42739</o:CharactersWithSpaces>
  <o:Version>12.00</o:Version>
 </o:DocumentProperties>
 <o:OfficeDocumentSettings>
  <o:TargetScreenSize>544x376</o:TargetScreenSize>
 </o:OfficeDocumentSettings>
</xml><![endif]-->
<link rel=themeData href="/b2/CH07_03.files/themedata.thmx">
<link rel=colorSchemeMapping href="/b2/CH07_03.files/colorschememapping.xml">
<!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:HideSpellingErrors/>
  <w:TrackMoves>false</w:TrackMoves>
  <w:TrackFormatting/>
  <w:PunctuationKerning/>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>2</w:DisplayVerticalDrawingGridEvery>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotPromoteQF/>
  <w:LidThemeOther>EN-US</w:LidThemeOther>
  <w:LidThemeAsian>ZH-TW</w:LidThemeAsian>
  <w:LidThemeComplexScript>X-NONE</w:LidThemeComplexScript>
  <w:Compatibility>
   <w:SpaceForUL/>
   <w:BalanceSingleByteDoubleByteWidth/>
   <w:DoNotLeaveBackslashAlone/>
   <w:ULTrailSpace/>
   <w:DoNotExpandShiftReturn/>
   <w:AdjustLineHeightInTable/>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
   <w:DontUseIndentAsNumberingTabStop/>
   <w:FELineBreak11/>
   <w:WW11IndentRules/>
   <w:DontAutofitConstrainedTables/>
   <w:AutofitLikeWW11/>
   <w:HangulWidthLikeWW11/>
   <w:UseNormalStyleForList/>
   <w:UseFELayout/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
  <m:mathPr>
   <m:mathFont m:val="Cambria Math"/>
   <m:brkBin m:val="before"/>
   <m:brkBinSub m:val="&#45;-"/>
   <m:smallFrac m:val="off"/>
   <m:dispDef/>
   <m:lMargin m:val="0"/>
   <m:rMargin m:val="0"/>
   <m:defJc m:val="centerGroup"/>
   <m:wrapIndent m:val="1440"/>
   <m:intLim m:val="subSup"/>
   <m:naryLim m:val="undOvr"/>
  </m:mathPr></w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" DefUnhideWhenUsed="false"
  DefSemiHidden="false" DefQFormat="false" LatentStyleCount="267">
  <w:LsdException Locked="false" QFormat="true" Name="Normal"/>
  <w:LsdException Locked="false" QFormat="true" Name="heading 1"/>
  <w:LsdException Locked="false" QFormat="true" Name="heading 2"/>
  <w:LsdException Locked="false" QFormat="true" Name="heading 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 5"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 6"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 7"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 8"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 9"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 2"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="caption"/>
  <w:LsdException Locked="false" QFormat="true" Name="Title"/>
  <w:LsdException Locked="false" QFormat="true" Name="Subtitle"/>
  <w:LsdException Locked="false" Priority="99" Name="Hyperlink"/>
  <w:LsdException Locked="false" QFormat="true" Name="Strong"/>
  <w:LsdException Locked="false" QFormat="true" Name="Emphasis"/>
  <w:LsdException Locked="false" Priority="99" SemiHidden="true"
   Name="Placeholder Text"/>
  <w:LsdException Locked="false" Priority="1" QFormat="true" Name="No Spacing"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 1"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="99" SemiHidden="true" Name="Revision"/>
  <w:LsdException Locked="false" Priority="34" QFormat="true"
   Name="List Paragraph"/>
  <w:LsdException Locked="false" Priority="29" QFormat="true" Name="Quote"/>
  <w:LsdException Locked="false" Priority="30" QFormat="true"
   Name="Intense Quote"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 1"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 1"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 2"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 2"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 2"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 3"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 3"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 3"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 4"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 4"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 4"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 5"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 5"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 5"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 6"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 6"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 6"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="19" QFormat="true"
   Name="Subtle Emphasis"/>
  <w:LsdException Locked="false" Priority="21" QFormat="true"
   Name="Intense Emphasis"/>
  <w:LsdException Locked="false" Priority="31" QFormat="true"
   Name="Subtle Reference"/>
  <w:LsdException Locked="false" Priority="32" QFormat="true"
   Name="Intense Reference"/>
  <w:LsdException Locked="false" Priority="33" QFormat="true" Name="Book Title"/>
  <w:LsdException Locked="false" Priority="37" SemiHidden="true"
   UnhideWhenUsed="true" Name="Bibliography"/>
  <w:LsdException Locked="false" Priority="39" SemiHidden="true"
   UnhideWhenUsed="true" QFormat="true" Name="TOC Heading"/>
 </w:LatentStyles>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;
	mso-font-charset:2;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:0 268435456 0 0 -2147483648 0;}
@font-face
	{font-family:新細明體;
	panose-1:2 2 5 0 0 0 0 0 0 0;
	mso-font-alt:PMingLiU;
	mso-font-charset:136;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:-1610611969 684719354 22 0 1048577 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:-1610611985 1107304683 0 0 159 0;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-520092929 1073786111 9 0 415 0;}
@font-face
	{font-family:微軟正黑體;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:136;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:135 680476672 22 0 1048585 0;}
@font-face
	{font-family:"\@微軟正黑體";
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:136;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:135 680476672 22 0 1048585 0;}
@font-face
	{font-family:"\@新細明體";
	panose-1:2 2 5 0 0 0 0 0 0 0;
	mso-font-charset:136;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:-1610611969 684719354 22 0 1048577 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:none;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";
	mso-fareast-font-family:新細明體;
	mso-font-kerning:1.0pt;}
h1
	{mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-next:正文;
	margin-top:9.0pt;
	margin-right:0cm;
	margin-bottom:9.0pt;
	margin-left:0cm;
	line-height:300%;
	mso-pagination:none;
	page-break-after:avoid;
	mso-outline-level:1;
	font-size:26.0pt;
	font-family:"Arial","sans-serif";
	mso-bidi-font-family:"Times New Roman";
	mso-font-kerning:26.0pt;}
h2
	{mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-next:正文;
	margin:0cm;
	margin-bottom:.0001pt;
	line-height:300%;
	mso-pagination:none;
	page-break-after:avoid;
	mso-outline-level:2;
	font-size:24.0pt;
	font-family:"Arial","sans-serif";
	mso-bidi-font-family:"Times New Roman";
	mso-font-kerning:1.0pt;}
h3
	{mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-next:正文;
	margin:0cm;
	margin-bottom:.0001pt;
	line-height:300%;
	mso-pagination:none;
	page-break-after:avoid;
	mso-outline-level:3;
	font-size:18.0pt;
	font-family:"Arial","sans-serif";
	mso-bidi-font-family:"Times New Roman";
	mso-font-kerning:1.0pt;}
p.MsoToc1, li.MsoToc1, div.MsoToc1
	{mso-style-update:auto;
	mso-style-noshow:yes;
	mso-style-unhide:no;
	mso-style-next:正文;
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:none;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";
	mso-fareast-font-family:新細明體;
	mso-font-kerning:1.0pt;}
p.MsoToc2, li.MsoToc2, div.MsoToc2
	{mso-style-update:auto;
	mso-style-priority:39;
	mso-style-unhide:no;
	mso-style-next:正文;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:24.0pt;
	margin-bottom:.0001pt;
	mso-para-margin-top:0cm;
	mso-para-margin-right:0cm;
	mso-para-margin-bottom:0cm;
	mso-para-margin-left:2.0gd;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:none;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";
	mso-fareast-font-family:新細明體;
	mso-font-kerning:1.0pt;}
p.MsoToc3, li.MsoToc3, div.MsoToc3
	{mso-style-update:auto;
	mso-style-priority:39;
	mso-style-unhide:no;
	mso-style-next:正文;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:48.0pt;
	margin-bottom:.0001pt;
	mso-para-margin-top:0cm;
	mso-para-margin-right:0cm;
	mso-para-margin-bottom:0cm;
	mso-para-margin-left:4.0gd;
	mso-para-margin-bottom:.0001pt;
	line-height:18.0pt;
	mso-line-height-rule:exactly;
	mso-pagination:none;
	tab-stops:right dotted 509.7pt;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";
	mso-fareast-font-family:新細明體;
	mso-font-kerning:1.0pt;}
p.MsoFootnoteText, li.MsoFootnoteText, div.MsoFootnoteText
	{mso-style-noshow:yes;
	mso-style-unhide:no;
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:none;
	layout-grid-mode:char;
	font-size:10.0pt;
	font-family:"Times New Roman","serif";
	mso-fareast-font-family:新細明體;
	mso-font-kerning:1.0pt;}
p.MsoTof, li.MsoTof, div.MsoTof
	{mso-style-noshow:yes;
	mso-style-unhide:no;
	mso-style-next:正文;
	margin:0cm;
	margin-bottom:.0001pt;
	mso-para-margin-top:0cm;
	mso-para-margin-right:0cm;
	mso-para-margin-bottom:0cm;
	mso-para-margin-left:4.0gd;
	mso-para-margin-bottom:.0001pt;
	text-indent:-10.0pt;
	mso-char-indent-count:-2.0;
	mso-pagination:none;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";
	mso-fareast-font-family:新細明體;
	mso-font-kerning:1.0pt;}
span.MsoFootnoteReference
	{mso-style-noshow:yes;
	mso-style-unhide:no;
	vertical-align:super;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	mso-style-unhide:no;
	color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-unhide:no;
	color:purple;
	mso-themecolor:followedhyperlink;
	text-decoration:underline;
	text-underline:single;}
p.a, li.a, div.a
	{mso-style-name:圖表;
	mso-style-unhide:no;
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:27.0pt;
	mso-char-indent-count:2.25;
	mso-pagination:none;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";
	mso-fareast-font-family:新細明體;
	mso-font-kerning:1.0pt;}
p.Name, li.Name, div.Name
	{mso-style-name:Name;
	mso-style-update:auto;
	mso-style-unhide:no;
	mso-style-next:正文;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:51.0pt;
	margin-bottom:.0001pt;
	text-indent:-24.0pt;
	mso-line-height-alt:0pt;
	mso-pagination:none;
	mso-outline-level:3;
	mso-list:l5 level1 lfo20;
	tab-stops:list 51.0pt;
	font-size:12.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:新細明體;
	text-shadow:auto;
	mso-fareast-language:ZH-CN;
	font-weight:bold;
	mso-bidi-font-weight:normal;}
.MsoChpDefault
	{mso-style-type:export-only;
	mso-default-props:yes;
	mso-fareast-font-family:新細明體;}
 /* Page Definitions */
 @page
	{mso-page-border-surround-header:no;
	mso-page-border-surround-footer:no;
	mso-footnote-separator:url("/b2/CH07_03.files/header.htm") fs;
	mso-footnote-continuation-separator:url("/b2/CH07_03.files/header.htm") fcs;
	mso-endnote-separator:url("/b2/CH07_03.files/header.htm") es;
	mso-endnote-continuation-separator:url("/b2/CH07_03.files/header.htm") ecs;}
@page Section1
	{size:595.3pt 841.9pt;
	margin:42.55pt 42.55pt 42.55pt 42.55pt;
	mso-header-margin:42.55pt;
	mso-footer-margin:49.6pt;
	mso-paper-source:0;
	layout-grid:18.0pt;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:235210468;
	mso-list-type:hybrid;
	mso-list-template-ids:-90003636 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l0:level1
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:51.0pt;
	mso-level-number-position:left;
	margin-left:51.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l1
	{mso-list-id:251547240;
	mso-list-template-ids:67698719;}
@list l1:level1
	{mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;}
@list l1:level2
	{mso-level-text:"%1\.%2\.";
	mso-level-tab-stop:1.0cm;
	mso-level-number-position:left;
	margin-left:1.0cm;
	text-indent:-1.0cm;}
@list l1:level3
	{mso-level-text:"%1\.%2\.%3\.";
	mso-level-tab-stop:35.45pt;
	mso-level-number-position:left;
	margin-left:35.45pt;
	text-indent:-35.45pt;}
@list l1:level4
	{mso-level-text:"%1\.%2\.%3\.%4\.";
	mso-level-tab-stop:42.55pt;
	mso-level-number-position:left;
	margin-left:42.55pt;
	text-indent:-42.55pt;}
@list l1:level5
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.";
	mso-level-tab-stop:49.6pt;
	mso-level-number-position:left;
	margin-left:49.6pt;
	text-indent:-49.6pt;}
@list l1:level6
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.";
	mso-level-tab-stop:2.0cm;
	mso-level-number-position:left;
	margin-left:2.0cm;
	text-indent:-2.0cm;}
@list l1:level7
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.";
	mso-level-tab-stop:63.8pt;
	mso-level-number-position:left;
	margin-left:63.8pt;
	text-indent:-63.8pt;}
@list l1:level8
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.";
	mso-level-tab-stop:70.9pt;
	mso-level-number-position:left;
	margin-left:70.9pt;
	text-indent:-70.9pt;}
@list l1:level9
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.%9\.";
	mso-level-tab-stop:77.95pt;
	mso-level-number-position:left;
	margin-left:77.95pt;
	text-indent:-77.95pt;}
@list l2
	{mso-list-id:477843612;
	mso-list-template-ids:1276924010;}
@list l2:level1
	{mso-level-start-at:7;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:40.5pt;
	text-indent:-40.5pt;}
@list l2:level2
	{mso-level-start-at:3;
	mso-level-text:"%1\.%2\.";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:82.35pt;
	text-indent:-54.0pt;}
@list l2:level3
	{mso-level-text:"%1\.%2\.%3\.";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:128.7pt;
	text-indent:-72.0pt;}
@list l2:level4
	{mso-level-text:"%1\.%2\.%3\.%4\.";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:175.05pt;
	text-indent:-90.0pt;}
@list l2:level5
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:221.4pt;
	text-indent:-108.0pt;}
@list l2:level6
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:285.75pt;
	text-indent:-144.0pt;}
@list l2:level7
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:332.1pt;
	text-indent:-162.0pt;}
@list l2:level8
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:378.45pt;
	text-indent:-180.0pt;}
@list l2:level9
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.%9\.";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:424.8pt;
	text-indent:-198.0pt;}
@list l3
	{mso-list-id:548734902;
	mso-list-type:hybrid;
	mso-list-template-ids:495385402 -1 169142506 -1 -1 -1 -1 -1 -1 -1;}
@list l3:level1
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:51.0pt;
	mso-level-number-position:left;
	margin-left:51.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l4
	{mso-list-id:601499885;
	mso-list-type:hybrid;
	mso-list-template-ids:-1876530220 -1 169142506 -1 -1 -1 -1 -1 -1 -1;}
@list l4:level1
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:51.0pt;
	mso-level-number-position:left;
	margin-left:51.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l5
	{mso-list-id:643316197;
	mso-list-type:hybrid;
	mso-list-template-ids:1826779488 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l5:level1
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:51.0pt;
	mso-level-number-position:left;
	margin-left:51.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l6
	{mso-list-id:837383294;
	mso-list-type:hybrid;
	mso-list-template-ids:-462257420 -1 169142506 -1 -1 -1 -1 -1 -1 -1;}
@list l6:level1
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:45.0pt;
	mso-level-number-position:left;
	margin-left:45.0pt;
	text-indent:-18.0pt;}
@list l7
	{mso-list-id:1008366758;
	mso-list-type:hybrid;
	mso-list-template-ids:-1489231242 -1 169142506 -1 -1 -1 -1 -1 -1 -1;}
@list l7:level1
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:51.0pt;
	mso-level-number-position:left;
	margin-left:51.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l8
	{mso-list-id:1269704467;
	mso-list-type:hybrid;
	mso-list-template-ids:2022839602 -1 169142506 -1 -1 -1 -1 -1 -1 -1;}
@list l8:level1
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:45.0pt;
	mso-level-number-position:left;
	margin-left:45.0pt;
	text-indent:-18.0pt;}
@list l9
	{mso-list-id:1281456551;
	mso-list-template-ids:1081655274;}
@list l9:level1
	{mso-level-start-at:7;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;}
@list l9:level2
	{mso-level-text:"%1\.%2\.";
	mso-level-tab-stop:1.0cm;
	mso-level-number-position:left;
	margin-left:1.0cm;
	text-indent:-1.0cm;}
@list l9:level3
	{mso-level-text:"%1\.%2\.%3\.";
	mso-level-tab-stop:35.45pt;
	mso-level-number-position:left;
	margin-left:35.45pt;
	text-indent:-35.45pt;}
@list l9:level4
	{mso-level-text:"%1\.%2\.%3\.%4\.";
	mso-level-tab-stop:42.55pt;
	mso-level-number-position:left;
	margin-left:42.55pt;
	text-indent:-42.55pt;}
@list l9:level5
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.";
	mso-level-tab-stop:49.6pt;
	mso-level-number-position:left;
	margin-left:49.6pt;
	text-indent:-49.6pt;}
@list l9:level6
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.";
	mso-level-tab-stop:2.0cm;
	mso-level-number-position:left;
	margin-left:2.0cm;
	text-indent:-2.0cm;}
@list l9:level7
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.";
	mso-level-tab-stop:63.8pt;
	mso-level-number-position:left;
	margin-left:63.8pt;
	text-indent:-63.8pt;}
@list l9:level8
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.";
	mso-level-tab-stop:70.9pt;
	mso-level-number-position:left;
	margin-left:70.9pt;
	text-indent:-70.9pt;}
@list l9:level9
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.%9\.";
	mso-level-tab-stop:77.95pt;
	mso-level-number-position:left;
	margin-left:77.95pt;
	text-indent:-77.95pt;}
@list l10
	{mso-list-id:1283879435;
	mso-list-type:hybrid;
	mso-list-template-ids:-1184491218 -1 169142506 -1 -1 -1 -1 -1 -1 -1;}
@list l10:level1
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:51.0pt;
	mso-level-number-position:left;
	margin-left:51.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l10:level2
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:75.0pt;
	mso-level-number-position:left;
	margin-left:75.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l11
	{mso-list-id:1287153250;
	mso-list-type:hybrid;
	mso-list-template-ids:-657672434 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l11:level1
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:45.0pt;
	mso-level-number-position:left;
	margin-left:45.0pt;
	text-indent:-18.0pt;}
@list l12
	{mso-list-id:1365671462;
	mso-list-type:hybrid;
	mso-list-template-ids:-1547904832 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l12:level1
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:51.0pt;
	mso-level-number-position:left;
	margin-left:51.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l12:level2
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:75.0pt;
	mso-level-number-position:left;
	margin-left:75.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l13
	{mso-list-id:1368523856;
	mso-list-template-ids:-716804922;}
@list l13:level1
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:45.0pt;
	mso-level-number-position:left;
	margin-left:45.0pt;
	text-indent:-18.0pt;}
@list l13:level2
	{mso-level-number-format:ideograph-traditional;
	mso-level-text:%2、;
	mso-level-tab-stop:75.0pt;
	mso-level-number-position:left;
	margin-left:75.0pt;
	text-indent:-24.0pt;}
@list l13:level3
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:99.0pt;
	mso-level-number-position:right;
	margin-left:99.0pt;
	text-indent:-24.0pt;}
@list l13:level4
	{mso-level-tab-stop:123.0pt;
	mso-level-number-position:left;
	margin-left:123.0pt;
	text-indent:-24.0pt;}
@list l13:level5
	{mso-level-number-format:ideograph-traditional;
	mso-level-text:%5、;
	mso-level-tab-stop:147.0pt;
	mso-level-number-position:left;
	margin-left:147.0pt;
	text-indent:-24.0pt;}
@list l13:level6
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:171.0pt;
	mso-level-number-position:right;
	margin-left:171.0pt;
	text-indent:-24.0pt;}
@list l13:level7
	{mso-level-tab-stop:195.0pt;
	mso-level-number-position:left;
	margin-left:195.0pt;
	text-indent:-24.0pt;}
@list l13:level8
	{mso-level-number-format:ideograph-traditional;
	mso-level-text:%8、;
	mso-level-tab-stop:219.0pt;
	mso-level-number-position:left;
	margin-left:219.0pt;
	text-indent:-24.0pt;}
@list l13:level9
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:243.0pt;
	mso-level-number-position:right;
	margin-left:243.0pt;
	text-indent:-24.0pt;}
@list l14
	{mso-list-id:1373768410;
	mso-list-type:hybrid;
	mso-list-template-ids:-149665248 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l14:level1
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:51.0pt;
	mso-level-number-position:left;
	margin-left:51.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l15
	{mso-list-id:1456564875;
	mso-list-type:hybrid;
	mso-list-template-ids:-252261734 1060678366 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l15:level1
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:68.25pt;
	mso-level-number-position:left;
	margin-left:68.25pt;
	text-indent:-41.25pt;}
@list l16
	{mso-list-id:1659117565;
	mso-list-type:hybrid;
	mso-list-template-ids:760500210;}
@list l16:level1
	{mso-level-tab-stop:51.0pt;
	mso-level-number-position:left;
	margin-left:51.0pt;
	text-indent:-24.0pt;}
@list l17
	{mso-list-id:1719159766;
	mso-list-type:hybrid;
	mso-list-template-ids:1166296824 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l17:level1
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:51.0pt;
	mso-level-number-position:left;
	margin-left:51.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l18
	{mso-list-id:1903952677;
	mso-list-type:hybrid;
	mso-list-template-ids:-908149608 864731454 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l18:level1
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l19
	{mso-list-id:2008088917;
	mso-list-type:hybrid;
	mso-list-template-ids:-1711622266 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l19:level1
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:51.0pt;
	mso-level-number-position:left;
	margin-left:51.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
@list l20
	{mso-list-id:2083792817;
	mso-list-type:hybrid;
	mso-list-template-ids:-123683830;}
@list l20:level1
	{mso-level-number-format:bullet;
	mso-level-text:;
	mso-level-tab-stop:51.0pt;
	mso-level-number-position:left;
	margin-left:51.0pt;
	text-indent:-24.0pt;
	font-family:Wingdings;}
ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:普通表格;
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-unhide:no;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman","serif";}
table.MsoTableGrid
	{mso-style-name:网格型;
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-unhide:no;
	border:solid windowtext 1.0pt;
	mso-border-alt:solid windowtext .5pt;
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-border-insideh:.5pt solid windowtext;
	mso-border-insidev:.5pt solid windowtext;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:none;
	font-size:10.0pt;
	font-family:"Times New Roman","serif";}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="2050"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=ZH-TW link=blue vlink=purple style='tab-interval:24.0pt;text-justify-trim:
punctuation'>

<div class=Section1 style='layout-grid:18.0pt'>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><a
name="_Toc149018060"><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></a></p>

<p class=MsoToc2 style='line-height:18.0pt;mso-line-height-rule:exactly;
tab-stops:60.0pt right dotted 509.7pt'><span style='mso-bookmark:_Toc149018060'></span><!--[if supportFields]><span
style='mso-bookmark:_Toc149018060'></span><span style='mso-element:field-begin'></span><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><span
style='mso-spacerun:yes'> </span>TOC \o &quot;1-3&quot; \h \z \u <span
style='mso-element:field-separator'></span></span></span><![endif]--><span
style='mso-bookmark:_Toc149018060'></span><a href="#_Toc304922111"><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";
mso-no-proof:yes'>7.3.</span></span><span style='mso-bookmark:_Toc149018060'><span
lang=EN-US style='mso-bidi-font-size:11.0pt;font-family:"Calibri","sans-serif";
mso-bidi-font-family:"Times New Roman";color:windowtext;mso-no-proof:yes;
text-decoration:none;text-underline:none'><span style='mso-tab-count:1'>      </span></span></span><span
style='mso-bookmark:_Toc149018060'><span style='font-family:"微軟正黑體","sans-serif";
mso-no-proof:yes'>控制<span lang=EN-US>CPU</span></span></span><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'><span style='mso-tab-count:1 dotted'>.. </span></span></span><!--[if supportFields]><span
style='mso-bookmark:_Toc149018060'></span><span style='mso-element:field-begin'></span><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'> PAGEREF _Toc304922111 \h <span style='mso-element:field-separator'></span></span></span><![endif]--><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'>1<!--[if gte mso 9]><xml>
 <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300300034003900320032003100310031000000</w:data>
</xml><![endif]--></span></span><!--[if supportFields]><span style='mso-bookmark:
_Toc149018060'></span><span style='mso-element:field-end'></span><![endif]--><span
style='mso-bookmark:_Toc149018060'></span></a><span style='mso-bookmark:_Toc149018060'><span
lang=EN-US style='mso-bidi-font-size:11.0pt;font-family:"Calibri","sans-serif";
mso-bidi-font-family:"Times New Roman";mso-no-proof:yes'><o:p></o:p></span></span></p>

<p class=MsoToc3><span style='mso-bookmark:_Toc149018060'></span><a
href="#_Toc304922112"><span style='mso-bookmark:_Toc149018060'><span
style='font-family:"微軟正黑體","sans-serif";mso-no-proof:yes'>內部暫存器</span></span><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'><span style='mso-tab-count:1 dotted'>... </span></span></span><!--[if supportFields]><span
style='mso-bookmark:_Toc149018060'></span><span style='mso-element:field-begin'></span><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'> PAGEREF _Toc304922112 \h <span style='mso-element:field-separator'></span></span></span><![endif]--><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'>2<!--[if gte mso 9]><xml>
 <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300300034003900320032003100310032000000</w:data>
</xml><![endif]--></span></span><!--[if supportFields]><span style='mso-bookmark:
_Toc149018060'></span><span style='mso-element:field-end'></span><![endif]--><span
style='mso-bookmark:_Toc149018060'></span></a><span style='mso-bookmark:_Toc149018060'><span
lang=EN-US style='mso-bidi-font-size:11.0pt;font-family:"Calibri","sans-serif";
mso-bidi-font-family:"Times New Roman";mso-no-proof:yes'><o:p></o:p></span></span></p>

<p class=MsoToc3><span style='mso-bookmark:_Toc149018060'></span><a
href="#_Toc304922113"><span style='mso-bookmark:_Toc149018060'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";mso-no-proof:yes'>Memory
Mapping</span></span><span style='mso-bookmark:_Toc149018060'><span
style='font-family:"微軟正黑體","sans-serif";mso-no-proof:yes'>暫存器</span></span><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'><span style='mso-tab-count:1 dotted'>... </span></span></span><!--[if supportFields]><span
style='mso-bookmark:_Toc149018060'></span><span style='mso-element:field-begin'></span><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'> PAGEREF _Toc304922113 \h <span style='mso-element:field-separator'></span></span></span><![endif]--><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'>3<!--[if gte mso 9]><xml>
 <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300300034003900320032003100310033000000</w:data>
</xml><![endif]--></span></span><!--[if supportFields]><span style='mso-bookmark:
_Toc149018060'></span><span style='mso-element:field-end'></span><![endif]--><span
style='mso-bookmark:_Toc149018060'></span></a><span style='mso-bookmark:_Toc149018060'><span
lang=EN-US style='mso-bidi-font-size:11.0pt;font-family:"Calibri","sans-serif";
mso-bidi-font-family:"Times New Roman";mso-no-proof:yes'><o:p></o:p></span></span></p>

<p class=MsoToc3><span style='mso-bookmark:_Toc149018060'></span><a
href="#_Toc304922114"><span style='mso-bookmark:_Toc149018060'><span
style='font-family:"微軟正黑體","sans-serif";mso-no-proof:yes'>中斷處理器</span></span><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'><span style='mso-tab-count:1 dotted'>... </span></span></span><!--[if supportFields]><span
style='mso-bookmark:_Toc149018060'></span><span style='mso-element:field-begin'></span><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'> PAGEREF _Toc304922114 \h <span style='mso-element:field-separator'></span></span></span><![endif]--><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'>8<!--[if gte mso 9]><xml>
 <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300300034003900320032003100310034000000</w:data>
</xml><![endif]--></span></span><!--[if supportFields]><span style='mso-bookmark:
_Toc149018060'></span><span style='mso-element:field-end'></span><![endif]--><span
style='mso-bookmark:_Toc149018060'></span></a><span style='mso-bookmark:_Toc149018060'><span
lang=EN-US style='mso-bidi-font-size:11.0pt;font-family:"Calibri","sans-serif";
mso-bidi-font-family:"Times New Roman";mso-no-proof:yes'><o:p></o:p></span></span></p>

<p class=MsoToc3><span style='mso-bookmark:_Toc149018060'></span><a
href="#_Toc304922115"><span style='mso-bookmark:_Toc149018060'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";mso-no-proof:yes'>Clock</span></span><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'><span style='mso-tab-count:1 dotted'>. </span></span></span><!--[if supportFields]><span
style='mso-bookmark:_Toc149018060'></span><span style='mso-element:field-begin'></span><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'> PAGEREF _Toc304922115 \h <span style='mso-element:field-separator'></span></span></span><![endif]--><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'>10<!--[if gte mso 9]><xml>
 <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300300034003900320032003100310035000000</w:data>
</xml><![endif]--></span></span><!--[if supportFields]><span style='mso-bookmark:
_Toc149018060'></span><span style='mso-element:field-end'></span><![endif]--><span
style='mso-bookmark:_Toc149018060'></span></a><span style='mso-bookmark:_Toc149018060'><span
lang=EN-US style='mso-bidi-font-size:11.0pt;font-family:"Calibri","sans-serif";
mso-bidi-font-family:"Times New Roman";mso-no-proof:yes'><o:p></o:p></span></span></p>

<p class=MsoToc3><span style='mso-bookmark:_Toc149018060'></span><a
href="#_Toc304922116"><span style='mso-bookmark:_Toc149018060'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";mso-no-proof:yes'>Bus &amp;
Chip Select</span></span><span style='mso-bookmark:_Toc149018060'><span
lang=EN-US style='color:windowtext;display:none;mso-hide:screen;mso-no-proof:
yes;text-decoration:none;text-underline:none'><span style='mso-tab-count:1 dotted'>. </span></span></span><!--[if supportFields]><span
style='mso-bookmark:_Toc149018060'></span><span style='mso-element:field-begin'></span><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'> PAGEREF _Toc304922116 \h <span style='mso-element:field-separator'></span></span></span><![endif]--><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'>13<!--[if gte mso 9]><xml>
 <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300300034003900320032003100310036000000</w:data>
</xml><![endif]--></span></span><!--[if supportFields]><span style='mso-bookmark:
_Toc149018060'></span><span style='mso-element:field-end'></span><![endif]--><span
style='mso-bookmark:_Toc149018060'></span></a><span style='mso-bookmark:_Toc149018060'><span
lang=EN-US style='mso-bidi-font-size:11.0pt;font-family:"Calibri","sans-serif";
mso-bidi-font-family:"Times New Roman";mso-no-proof:yes'><o:p></o:p></span></span></p>

<p class=MsoToc3><span style='mso-bookmark:_Toc149018060'></span><a
href="#_Toc304922117"><span style='mso-bookmark:_Toc149018060'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";mso-no-proof:yes'>GPIO port</span></span><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'><span style='mso-tab-count:1 dotted'>. </span></span></span><!--[if supportFields]><span
style='mso-bookmark:_Toc149018060'></span><span style='mso-element:field-begin'></span><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'> PAGEREF _Toc304922117 \h <span style='mso-element:field-separator'></span></span></span><![endif]--><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'>15<!--[if gte mso 9]><xml>
 <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300300034003900320032003100310037000000</w:data>
</xml><![endif]--></span></span><!--[if supportFields]><span style='mso-bookmark:
_Toc149018060'></span><span style='mso-element:field-end'></span><![endif]--><span
style='mso-bookmark:_Toc149018060'></span></a><span style='mso-bookmark:_Toc149018060'><span
lang=EN-US style='mso-bidi-font-size:11.0pt;font-family:"Calibri","sans-serif";
mso-bidi-font-family:"Times New Roman";mso-no-proof:yes'><o:p></o:p></span></span></p>

<p class=MsoToc3><span style='mso-bookmark:_Toc149018060'></span><a
href="#_Toc304922118"><span style='mso-bookmark:_Toc149018060'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";mso-no-proof:yes'>NOP</span></span><span
style='mso-bookmark:_Toc149018060'><span style='font-family:"微軟正黑體","sans-serif";
mso-no-proof:yes'>與實作精確的時間區段</span></span><span style='mso-bookmark:_Toc149018060'><span
lang=EN-US style='color:windowtext;display:none;mso-hide:screen;mso-no-proof:
yes;text-decoration:none;text-underline:none'><span style='mso-tab-count:1 dotted'>... </span></span></span><!--[if supportFields]><span
style='mso-bookmark:_Toc149018060'></span><span style='mso-element:field-begin'></span><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'> PAGEREF _Toc304922118 \h <span style='mso-element:field-separator'></span></span></span><![endif]--><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'>18<!--[if gte mso 9]><xml>
 <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300300034003900320032003100310038000000</w:data>
</xml><![endif]--></span></span><!--[if supportFields]><span style='mso-bookmark:
_Toc149018060'></span><span style='mso-element:field-end'></span><![endif]--><span
style='mso-bookmark:_Toc149018060'></span></a><span style='mso-bookmark:_Toc149018060'><span
lang=EN-US style='mso-bidi-font-size:11.0pt;font-family:"Calibri","sans-serif";
mso-bidi-font-family:"Times New Roman";mso-no-proof:yes'><o:p></o:p></span></span></p>

<p class=MsoToc3><span style='mso-bookmark:_Toc149018060'></span><a
href="#_Toc304922119"><span style='mso-bookmark:_Toc149018060'><span
style='font-family:"微軟正黑體","sans-serif";mso-no-proof:yes'>省電功能控制</span></span><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'><span style='mso-tab-count:1 dotted'>... </span></span></span><!--[if supportFields]><span
style='mso-bookmark:_Toc149018060'></span><span style='mso-element:field-begin'></span><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'> PAGEREF _Toc304922119 \h <span style='mso-element:field-separator'></span></span></span><![endif]--><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'>21<!--[if gte mso 9]><xml>
 <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300300034003900320032003100310039000000</w:data>
</xml><![endif]--></span></span><!--[if supportFields]><span style='mso-bookmark:
_Toc149018060'></span><span style='mso-element:field-end'></span><![endif]--><span
style='mso-bookmark:_Toc149018060'></span></a><span style='mso-bookmark:_Toc149018060'><span
lang=EN-US style='mso-bidi-font-size:11.0pt;font-family:"Calibri","sans-serif";
mso-bidi-font-family:"Times New Roman";mso-no-proof:yes'><o:p></o:p></span></span></p>

<p class=MsoToc3><span style='mso-bookmark:_Toc149018060'></span><a
href="#_Toc304922120"><span style='mso-bookmark:_Toc149018060'><span
style='font-family:"微軟正黑體","sans-serif";mso-no-proof:yes'>初始化</span></span><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'><span style='mso-tab-count:1 dotted'>... </span></span></span><!--[if supportFields]><span
style='mso-bookmark:_Toc149018060'></span><span style='mso-element:field-begin'></span><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'> PAGEREF _Toc304922120 \h <span style='mso-element:field-separator'></span></span></span><![endif]--><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'>23<!--[if gte mso 9]><xml>
 <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300300034003900320032003100320030000000</w:data>
</xml><![endif]--></span></span><!--[if supportFields]><span style='mso-bookmark:
_Toc149018060'></span><span style='mso-element:field-end'></span><![endif]--><span
style='mso-bookmark:_Toc149018060'></span></a><span style='mso-bookmark:_Toc149018060'><span
lang=EN-US style='mso-bidi-font-size:11.0pt;font-family:"Calibri","sans-serif";
mso-bidi-font-family:"Times New Roman";mso-no-proof:yes'><o:p></o:p></span></span></p>

<p class=MsoToc3><span style='mso-bookmark:_Toc149018060'></span><a
href="#_Toc304922121"><span style='mso-bookmark:_Toc149018060'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";mso-no-proof:yes'>CPU</span></span><span
style='mso-bookmark:_Toc149018060'><span style='font-family:"微軟正黑體","sans-serif";
mso-no-proof:yes'>內部還有什麼？</span></span><span style='mso-bookmark:_Toc149018060'><span
lang=EN-US style='color:windowtext;display:none;mso-hide:screen;mso-no-proof:
yes;text-decoration:none;text-underline:none'><span style='mso-tab-count:1 dotted'>... </span></span></span><!--[if supportFields]><span
style='mso-bookmark:_Toc149018060'></span><span style='mso-element:field-begin'></span><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'> PAGEREF _Toc304922121 \h <span style='mso-element:field-separator'></span></span></span><![endif]--><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='color:windowtext;
display:none;mso-hide:screen;mso-no-proof:yes;text-decoration:none;text-underline:
none'>24<!--[if gte mso 9]><xml>
 <w:data>08D0C9EA79F9BACE118C8200AA004BA90B02000000080000000E0000005F0054006F0063003300300034003900320032003100320031000000</w:data>
</xml><![endif]--></span></span><!--[if supportFields]><span style='mso-bookmark:
_Toc149018060'></span><span style='mso-element:field-end'></span><![endif]--><span
style='mso-bookmark:_Toc149018060'></span></a><span style='mso-bookmark:_Toc149018060'><span
lang=EN-US style='mso-bidi-font-size:11.0pt;font-family:"Calibri","sans-serif";
mso-bidi-font-family:"Times New Roman";mso-no-proof:yes'><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
style='mso-bookmark:_Toc149018060'></span><!--[if supportFields]><span
style='mso-bookmark:_Toc149018060'></span><span style='mso-element:field-end'></span><![endif]--><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
style='mso-bookmark:_Toc149018060'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></span></p>

<span style='mso-bookmark:_Toc149018060'></span>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<h2 style='margin-left:82.35pt;text-indent:-54.0pt;line-height:18.0pt;
mso-line-height-rule:exactly;mso-list:l2 level2 lfo21'><a name="_Toc304922111"></a><a
name="_Toc149018067"><span style='mso-bookmark:_Toc304922111'><![if !supportLists]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";mso-bidi-font-family:微軟正黑體'><span
style='mso-list:Ignore'>7.3.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>控制<span lang=EN-US>CPU</span></span></span></a><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></h2>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『我已經知道在開始寫驅動程式之前的準備工作了，你可以分個周邊裝置讓我來試看看了吧。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『一般人對驅動程式的印象都是要驅動或控制週邊裝置，卻往往忽略了整個系統中最重要的一顆<span
lang=EN-US>IC – CPU</span>；在<span lang=EN-US>PC</span>上，<span lang=EN-US>BIOS</span>和作業系統已經把<span
lang=EN-US>CPU</span>控制的好好的了，所以寫驅動程式時幾乎不用理會它，如果說<span lang=EN-US>Intel Pentium 4</span>是目前最複雜的<span
lang=EN-US>CPU</span>其實並不為過，但它可不是給電後就自己會動了，我想<span lang=EN-US>BIOS</span>以及<span
lang=EN-US>Windows</span>、<span lang=EN-US>Linux</span>還是做了很多事情才能讓它工作的。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>用於嵌入式系統中的<span
lang=EN-US>CPU</span>通常沒有<span lang=EN-US>Pentium 4</span>那麼複雜，但<span
lang=EN-US>CPU</span>內整合許多周邊設備的設計已蔚為風尚，採用這種<span lang=EN-US>CPU</span>最大的優點是硬體架構相對簡單，甚至有可能系統中只要有<span
lang=EN-US>CPU</span>這顆主要<span lang=EN-US>IC</span>就足以實現產品的所有功能；再深入的探討下去的話，這種<span
lang=EN-US>CPU</span>的價格一定比使用多顆不同<span lang=EN-US>IC</span>便宜，而且可以使產品體積變小，產品外觀設計可以有更高的彈性；此外研發團隊不用面對太多的<span
lang=EN-US>IC</span>廠商，取得支援相對容易。甚至有些<span lang=EN-US>IC</span>設計的廠商提供專用<span
lang=EN-US>CPU</span>訂製的服務<span lang=EN-US>(</span>稱為<span lang=EN-US>ASIC)</span>，可依照產品設計者的需求，整合不同的裝置<span
lang=EN-US>(</span>我們稱為<span lang=EN-US>Hardware IP)</span>到<span lang=EN-US>CPU</span>中。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>下圖是某<span lang=EN-US>CPU</span>內部的架構，你可以看到裡面有很多不同的裝置，像<span
lang=EN-US>LCD</span>、<span lang=EN-US>NAND Flash</span>、<span lang=EN-US>SDRAM</span>、<span
lang=EN-US>USB controller</span>等等；你可以思考一下，使用這顆<span lang=EN-US>CPU</span>，在不加額外的<span
lang=EN-US>IC</span>的前提下，是不是就足以設計諸如隨身碟的產品了？如果再加了一顆<span lang=EN-US>MP3</span>解碼<span
lang=EN-US>IC</span>，是不是就可以設計<span lang=EN-US>MP3</span>隨身聽了？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:red'><!--[if gte vml 1]><v:shapetype
 id="_x0000_t75" coordsize="21600,21600" o:spt="75" o:preferrelative="t"
 path="m@4@5l@4@11@9@11@9@5xe" filled="f" stroked="f">
 <v:stroke joinstyle="miter"/>
 <v:formulas>
  <v:f eqn="if lineDrawn pixelLineWidth 0"/>
  <v:f eqn="sum @0 1 0"/>
  <v:f eqn="sum 0 0 @1"/>
  <v:f eqn="prod @2 1 2"/>
  <v:f eqn="prod @3 21600 pixelWidth"/>
  <v:f eqn="prod @3 21600 pixelHeight"/>
  <v:f eqn="sum @0 0 1"/>
  <v:f eqn="prod @6 1 2"/>
  <v:f eqn="prod @7 21600 pixelWidth"/>
  <v:f eqn="sum @8 21600 0"/>
  <v:f eqn="prod @7 21600 pixelHeight"/>
  <v:f eqn="sum @10 21600 0"/>
 </v:formulas>
 <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
 <o:lock v:ext="edit" aspectratio="t"/>
</v:shapetype><v:shape id="_x0000_i1025" type="#_x0000_t75" style='width:495.75pt;
 height:330.75pt'>
 <v:imagedata src="/b2/CH07_03.files/image001.jpg" o:title="07-02-用於嵌入式系統之CPU的內部架構"/>
</v:shape><![endif]--><![if !vml]><img width=661 height=441
src="/b2/CH07_03.files/image002.jpg" v:shapes="_x0000_i1025"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc165115544"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>7-2</span>：用於嵌入式系統之<span
lang=EN-US>CPU</span>的內部架構</span></a><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『雖然我對硬體設計一竅不通，但我可以想像這樣的<span
lang=EN-US>CPU</span>應該可以大幅度減少硬體設計的複雜度。話說回來，所以在嵌入式系統中最重要的驅動程式就是控制“<span
lang=EN-US>CPU</span>”囉？<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『沒錯！<span
lang=EN-US>CPU</span>就是驅動程式工程師要處理的第一個，也是最重要的裝置。以下我們就一一檢視一般嵌入式系統<span
lang=EN-US>CPU</span>所需要設定的功能。<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<h3 style='line-height:18.0pt;mso-line-height-rule:exactly'><a
name="_Toc304922112"></a><a name="_Toc149018069"><span style='mso-bookmark:
_Toc304922112'><span style='font-family:"微軟正黑體","sans-serif"'>內部暫存器</span></span></a><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></h3>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『首先是內部暫存器，我們之前已經看過很多例子了。雖說<span
lang=EN-US>CPU</span>內整合了很多周邊，但其中還是有一個稱為<span lang=EN-US>CPU core(</span>核心<span
lang=EN-US>)</span>的區塊；舉例來說，同一系列的兩顆<span lang=EN-US>CPU</span>都使用<span
lang=EN-US>8051</span>為核心，雖然整合了不同的周邊，但是他們<span lang=EN-US>CPU</span>的內部暫存器和所接受的機器碼是一樣的。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『這個我了解，像我們目前正在開發的產品所使用的<span
lang=EN-US>CPU</span>，就和前一代產品的<span lang=EN-US>CPU</span>是同樣的核心，只是整合進<span
lang=EN-US>CPU</span>的週邊不同；所以雖然是新的<span lang=EN-US>CPU</span>，但組合語言寫法是一樣的、編譯工具也是一樣的，所以我們團隊中的老鳥很快就能上手，這也是當初我們在評估這個案子能不能接的因素之一。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『是的，所以很多之前專案留下來的程式，包含<span
lang=EN-US>boot-loader</span>、驅動程式都可以重複使用。因為寫組合語言的機會不多，所以實務上我們並不會去弄懂每一個暫存器的用途，而且現在流行的是<span
lang=EN-US>RISC(</span>精簡指令集<span lang=EN-US>CPU)</span>，這種<span lang=EN-US>CPU</span>的特定用途暫存器<span
lang=EN-US>(</span>如<span lang=EN-US>Stack Point</span>、<span lang=EN-US>Processor
Status Register</span>、<span lang=EN-US>Program Counter…)</span>不多，大部分都是一般用途暫存器，通常就直接命名為<span
lang=EN-US>R0</span>、<span lang=EN-US>R1</span>、<span lang=EN-US>R2…</span>等，下圖是某<span
lang=EN-US>CPU</span>的暫存器列表：<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:18.0pt;
mso-line-height-rule:exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";
color:red'><!--[if gte vml 1]><v:shape id="_x0000_i1026" type="#_x0000_t75"
 style='width:509.25pt;height:311.25pt'>
 <v:imagedata src="/b2/CH07_03.files/image003.jpg" o:title="07-03-用於嵌入式系統之CPU的暫存器列表"/>
</v:shape><![endif]--><![if !vml]><img width=679 height=415
src="/b2/CH07_03.files/image004.jpg" v:shapes="_x0000_i1026"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc165115545"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>7-3</span>：用於嵌入式系統之<span
lang=EN-US>CPU</span>的暫存器列表</span></a><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『數一數總共也不超過<span
lang=EN-US>20</span>個吧，我還以為<span lang=EN-US>CPU</span>內會有很多暫存器呢；就只要這些暫存器，<span
lang=EN-US>CPU</span>就能完成如此複雜的功能？<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『我相信你知道現代計算機架構的原型是圖靈機<span
lang=EN-US>((Turing Machine)</span>吧，它的架構很簡單，但已被證明可以完成任何複雜的任務；<span lang=EN-US>CPU</span>只是一直到記憶體中取出下一個指令出來執行的裝置，而暫存器是用來紀錄目前<span
lang=EN-US>CPU</span>的狀態以及操作記憶體時的暫存區。有興趣的話你可以把用<span lang=EN-US>C</span>語言寫的複雜程式轉成組合語言，你會發現裡面就只是用到這些一般暫存器而已。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>剛剛說到，我們寫組合語言的機會不多，通常只有在設定<span
lang=EN-US>CPU</span>的狀態暫存器時才會用到，通常我們又把這種狀態暫存器分為兩類：<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l14 level1 lfo7;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>可以直接設定值的狀態暫存器：例如我們在系統啟動後要馬上設定<span
lang=EN-US>STACK</span>記憶體的位址，否則函式呼叫以及中斷處理程式都會運作不正常，此時我們就會寫如下的組合語言去設定<span
lang=EN-US>CPU</span>的<span lang=EN-US>Stack Point(SP)</span>暫存器。此外我們之前提過的<span
lang=EN-US>CPU</span>狀態暫存器<span lang=EN-US>(PSR)</span>，我們可以從其中知道<span
lang=EN-US>CPU</span>執行了某個指令之後的狀態，也可以設定其中某個<span lang=EN-US>bit</span>的值來控制<span
lang=EN-US>CPU</span>的行為；最常用的就是設定<span lang=EN-US>IE(Interrupt Enable)</span>這個<span
lang=EN-US>bit</span>，可允許或禁止中斷發生。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>/*<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span></span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:"微軟正黑體","sans-serif";color:blue'>藉由一般暫存器<span
lang=EN-US>R4, </span>設定<span lang=EN-US>Stack Point(SP)</span>暫存器的值<span
lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'><span style='mso-tab-count:
1'>       </span>(</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:"微軟正黑體","sans-serif";color:blue'>通常特殊暫存器都不允許直接設值<span
lang=EN-US>, </span>必須透過一般暫存器<span lang=EN-US>)<o:p></o:p></span></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>*/<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'>    </span>asm(&quot;xld.w<span
style='mso-spacerun:yes'>  </span>%r4,0x20000&quot;);<span
style='mso-spacerun:yes'>   </span><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'>    </span>asm(&quot;ld.w<span
style='mso-spacerun:yes'>   </span>%sp,%r4&quot;);<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>/*<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span></span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:"微軟正黑體","sans-serif";color:blue'>假設第<span
lang=EN-US>0</span>個<span lang=EN-US>bit</span>代表<span lang=EN-US>IE
bit(Interrupt Enable), </span>值為<span lang=EN-US>1</span>時表示允許中斷產生<span
lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span></span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:"微軟正黑體","sans-serif";color:blue'>以下的程式會令<span
lang=EN-US>CPU</span>允許中斷發生<span lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>*/<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'>    </span>asm(&quot;ld.w<span
style='mso-spacerun:yes'>   </span>%r8, 0x000001&quot;);<span
style='mso-spacerun:yes'>      </span>// Set PSR to interrupt enable<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'>    </span>asm(&quot;ld.w<span
style='mso-spacerun:yes'>   </span>%psr, %r8&quot;);<span
style='mso-spacerun:yes'>   </span><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l14 level1 lfo7;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>不允許設值的暫存器：例如<span lang=EN-US>PC(Program
Counter)</span>暫存器，裡面永遠儲存<span lang=EN-US>CPU</span>接下來要執行指令的位址，當<span
lang=EN-US>CPU</span>自記憶體抓取了一個指令來執行時，<span lang=EN-US>PC</span>暫存器會自動累加；程式不允許直接設定<span
lang=EN-US>PC</span>暫存器的值，只能透過<span lang=EN-US>jump</span>、<span lang=EN-US>call</span>等指令來改變執行順序時才會使得<span
lang=EN-US>PC</span>值跟著改變。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif";display:none;mso-hide:
all'>ˊˊ用台　</span><span style='font-family:"微軟正黑體","sans-serif"'>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『再加上我們可以從<span
lang=EN-US>CPU</span>廠商取得<span lang=EN-US>sample code</span>，裡面一定會有操作這些狀態暫存器的程式碼，直接<span
lang=EN-US>copy</span>過來改即可；這樣說來，即便換了新的<span lang=EN-US>CPU</span>，我們也不需花太多時間搞懂這些內部暫存器囉？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『是的，基本上只要把<span
lang=EN-US>data sheet</span>的相關部分瀏覽一下，知道這顆<span lang=EN-US>CPU</span>有哪些暫存器，分別是做什麼用的就夠了。』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<h3 style='line-height:18.0pt;mso-line-height-rule:exactly'><a
name="_Toc304922113"><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>Memory
Mapping</span></a><span style='mso-bookmark:_Toc304922113'><span
style='font-family:"微軟正黑體","sans-serif"'>暫存器</span></span><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></h3>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『前面已經提到過，用於嵌入式系統的<span
lang=EN-US>CPU</span>通常會整合許多周邊裝置到<span lang=EN-US>CPU</span>內部，你知不知道內部裝置和外部裝置有什麼不同？』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『有什麼不一樣嗎？外部裝置就是一個獨立的<span
lang=EN-US>IC</span>，和<span lang=EN-US>CPU</span>以特定的方式連接，中間可能還有一些零件與線路什麼的；內部裝置不就是把這些東西一股腦兒“塞到”<span
lang=EN-US>CPU</span>裡嗎？<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『你的用詞還真口語化；我們先不管硬體原理的細節，就寫驅動程式的人來說，要控制接在<span
lang=EN-US>CPU</span>外部的晶片勢必是透過<span lang=EN-US>CPU</span>的<span lang=EN-US>PIN</span>腳，可能只是單純的將<span
lang=EN-US>GPIO</span>腳<span lang=EN-US>(General Purpose I/O)</span>設為<span
lang=EN-US>High</span>或<span lang=EN-US>Low</span>來控制外部的<span lang=EN-US>chip</span>，同理外部的設備也可以透過<span
lang=EN-US>GPIO</span>腳將訊號傳回給<span lang=EN-US>CPU</span>；或者驅動程式可以透過某種通訊協定來控制<span
lang=EN-US>I/C</span>，例如<span lang=EN-US>SPI</span>或<span lang=EN-US>I<st1:chmetcnv
UnitName="C" SourceValue="2" HasSpace="False" Negative="False" NumberType="1"
TCSC="0" w:st="on"><sup>2</sup>C</st1:chmetcnv></span>等<a style='mso-footnote-id:
ftn1' href="#_ftn1" name="_ftnref1" title=""><span class=MsoFootnoteReference><span
lang=EN-US><span style='mso-special-character:footnote'><![if !supportFootnotes]><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:12.0pt;font-family:
"微軟正黑體","sans-serif";mso-bidi-font-family:"Times New Roman";mso-font-kerning:
1.0pt;mso-ansi-language:EN-US;mso-fareast-language:ZH-TW;mso-bidi-language:
AR-SA'>[1]</span></span><![endif]></span></span></span></a>，但無論是什麼樣的通訊協定，<span
lang=EN-US>CPU</span>和外部<span lang=EN-US>chip</span>之間的資料與命令的傳遞還是要透過<span
lang=EN-US>CPU</span>的<span lang=EN-US>PIN</span>腳。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>如果這個<span lang=EN-US>chip</span>是整合到<span
lang=EN-US>CPU</span>內部，姑且不論它與<span lang=EN-US>CPU</span>的<span lang=EN-US>core</span>是怎麼連接的，驅動程式肯定不是透過操作<span
lang=EN-US>CPU</span>的<span lang=EN-US>PIN</span>腳來控制<span lang=EN-US>CPU</span>內部的<span
lang=EN-US>chip</span>；<span lang=EN-US>CPU</span>設計者為了讓整合進來的<span lang=EN-US>chip</span>確實像是<span
lang=EN-US>CPU</span>的一部份，會把該<span lang=EN-US>chip</span>的特性包裝起來，所以驅動程式工程師看到的就是一系列的暫存器；透過設定這些暫存器的值就等於通知<span
lang=EN-US>CPU core</span>去操作整合進來的<span lang=EN-US>chip</span>，而該<span
lang=EN-US>chip</span>要傳遞訊息給驅動程式時也是透過這些暫存器。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>這種用來控制<span lang=EN-US>CPU</span>內部<span
lang=EN-US>chip</span>的暫存器，與剛剛提到的<span lang=EN-US>CPU</span>內部暫存器是完全不同的性質；<span
lang=EN-US>CPU</span>內部暫存器有自己的名字，而內部週邊設備的暫存器則只有一個位址，所以通常我們稱之為<span lang=EN-US>memory
mapping register</span>，而這種控制內置<span lang=EN-US>chip</span>的方式稱為<span
lang=EN-US>memory mapping I/O</span>。』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『這個我知道，要操作<span
lang=EN-US>memory mapping I/O</span>暫存器的程式寫法為：<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:24.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;
mso-line-height-rule:exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;
mso-line-height-rule:exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>*(volatile
unsigned char *)(0x<st1:chmetcnv UnitName="C" SourceValue="402" HasSpace="False"
Negative="False" NumberType="1" TCSC="0" w:st="on">402C</st1:chmetcnv>F) = 0x00
;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;
mso-line-height-rule:exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:24.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;
mso-line-height-rule:exactly'><span style='font-family:"微軟正黑體","sans-serif"'>暫存器編號其實是一個位址，使用指標就可以對其設值或取值，要注意的是一定要用<span
lang=EN-US>volatile </span>關鍵字，否則編譯器的最佳化功能很可能會把某些程式當作是沒意義的。我翻過<span lang=EN-US>CPU</span>的<span
lang=EN-US>data sheet</span>，這樣的暫存器有上百個耶。<span style='display:none;mso-hide:
all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『因為這顆<span
lang=EN-US>CPU</span>整合了許多硬體裝置<span lang=EN-US>(Hardware IP)</span>，其中某些複雜的硬體裝置功能較多，自然需要較多的暫存器來做設定與操作；以下這個表格就是某顆<span
lang=EN-US>CPU</span>內置的<span lang=EN-US>LCD controller</span>的暫存器列表，亦即驅動程式工程師要讓<span
lang=EN-US>LCD</span>亮起來，可能要把相關暫存器都設定過。這個裝置還不是最複雜的，你可以想想，如果某顆<span lang=EN-US>CPU</span>整合了<span
lang=EN-US>Ethernet IC</span>、<span lang=EN-US>MP3</span>解碼器<span lang=EN-US>…</span>等裝置，
用以控制這些裝置的暫存器會有多少？<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:red'><!--[if gte vml 1]><v:shape
 id="_x0000_i1027" type="#_x0000_t75" style='width:513.75pt;height:318.75pt'>
 <v:imagedata src="/b2/CH07_03.files/image005.jpg" o:title="07-04-內置之LCD controller的暫存器列表"/>
</v:shape><![endif]--><![if !vml]><img width=685 height=425
src="/b2/CH07_03.files/image006.jpg" v:shapes="_x0000_i1027"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;line-height:18.0pt;mso-line-height-rule:
exactly'><a name="_Toc165115546"><span style='font-family:"微軟正黑體","sans-serif"'>圖<span
lang=EN-US>7-4(a)</span>：內置之<span lang=EN-US>LCD controller</span>的暫存器列表</span></a><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『<span lang=EN-US>CPU</span>內部的<span
lang=EN-US>memory mapping register</span>除了用來控制內置<span lang=EN-US>chip</span>外，也可用以操作<span
lang=EN-US>CPU core</span>的基本功能與控制<span lang=EN-US>CPU </span>的<span
lang=EN-US>PIN</span>腳；舉例來說，要讓某根<span lang=EN-US>GPIO</span>腳變成<span
lang=EN-US>High</span>或<span lang=EN-US>low</span>電位，工程師必須控制以下的暫存器。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:red'><!--[if gte vml 1]><v:shape
 id="_x0000_i1028" type="#_x0000_t75" style='width:504.75pt;height:207pt'>
 <v:imagedata src="/b2/CH07_03.files/image007.jpg" o:title="07-05-可控制CPU PIN腳的暫存器列表"/>
</v:shape><![endif]--><![if !vml]><img width=673 height=276
src="/b2/CH07_03.files/image008.jpg" v:shapes="_x0000_i1028"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc165115547"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>7-4(b)</span>：可控制<span
lang=EN-US>CPU PIN</span>腳的暫存器列表</span></a><span lang=EN-US style='font-family:
"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『雖然暫存器的數目很多，但你也說過，這些暫存器都只是“規定”，不是“學問”或“知識”，要用時先讀一下<span
lang=EN-US>data sheet</span>，然後拿<span lang=EN-US>sample code</span>來改一下就好了。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『沒錯，有些裝置的初始化動作相當繁複，疏忽了某個暫存器就可能動不起來，而這種“疏忽”是因為不了解<span
lang=EN-US>CPU</span>設計者的規定，你只能一直翻<span lang=EN-US>data sheet</span>，否則想破頭也想不出來。偏偏有些<span
lang=EN-US>data sheet</span>總是語焉不詳，此時工程師就應該立即求援 <span lang=EN-US>– </span>參考確定可以動的<span
lang=EN-US>sample code</span>或要求<span lang=EN-US>CPU</span>廠商的<span lang=EN-US>FAE</span>來幫忙。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『在那本業界奉為圭臬的書“<b
style='mso-bidi-font-weight:normal'><span lang=EN-US>Programming Embedded
System in C and C++</span></b>”中也提到了這種<span lang=EN-US>memory mapping register</span>，書中提到要將所有會用到的暫存器編號<span
lang=EN-US>(</span>位址<span lang=EN-US>)</span>定義為較有意義的名字，寫法如下；但是我們<span
lang=EN-US>CPU</span>的這種暫存器這麼多，難道都要為其一一定義名字嗎？<span style='display:none;
mso-hide:all'>暫存器這麼多起來ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'>//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";color:blue'>// in
port_def.h<o:p></o:p></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'>//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";color:blue'>//<o:p></o:p></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";color:blue'>// </span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"微軟正黑體","sans-serif";color:blue'>假設暫存器<span lang=EN-US>0x402d4, 0x402d5</span>是用以設定<span
lang=EN-US>GPIO port - P02</span>的暫存器<span lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";color:blue'>// (</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"微軟正黑體","sans-serif";color:blue'>讀者在此完全不需理會這些暫存器編號的意義<span lang=EN-US>)<o:p></o:p></span></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";color:blue'>//<o:p></o:p></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'>#define REG_GPIO_P02_SEL <span style='mso-tab-count:1'>      </span>(*(volatile
unsigned char *)(0x402d4))<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'>#define REG_GPIO_P02_SETING <span style='mso-tab-count:1'>         </span>(*(volatile
unsigned char *)(0x402d5))<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'>…<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'>…<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'>//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";color:blue'>// in
driver_fun.c<o:p></o:p></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'>//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";color:blue'>//<o:p></o:p></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";color:blue'>// </span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"微軟正黑體","sans-serif";color:blue'>不直接使用暫存器編號<span lang=EN-US>, </span>使用定義好的名字<span
lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";color:blue'>//<o:p></o:p></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'>#include &lt;port_def.h</span><span style='font-size:10.0pt;
font-family:"微軟正黑體","sans-serif";color:blue'>＞<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'>void fun(void)<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'>{<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>// </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'>將<span lang=EN-US>bit 5</span>設為<span lang=EN-US>0 (0xEF = B1110
1111)<o:p></o:p></span></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'><span style='mso-spacerun:yes'> </span>//<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'><span style='mso-spacerun:yes'> </span>REG_GPIO_P02_SEL &amp;=
0x0EF;<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'><span style='mso-spacerun:yes'> </span><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>// </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'>將<span lang=EN-US>bit 6</span>設為<span lang=EN-US>1 (0x20 = B0010
0000)<o:p></o:p></span></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'><span style='mso-spacerun:yes'> </span>//<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'><span style='mso-spacerun:yes'> </span>REG_GPIO_P02_SETING |= 0x20;<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:22.5pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-size:10.0pt;font-family:"微軟正黑體","sans-serif";
color:blue'>}<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『基本上教科書都是這樣說的，好像在程式中出現“數字”就是沒有彈性的寫法，這在大部分的狀況是對的，舉例來說：假設我們的系統有<span
lang=EN-US>LCD</span>，用於產品<span lang=EN-US>A</span>的解析度是<span lang=EN-US>160x160</span>，用於產品<span
lang=EN-US>B</span>的解析度則是<span lang=EN-US>160x240</span>，如果我們在程式中就直接用<span
lang=EN-US>160</span>、<span lang=EN-US>240</span>這些值來算座標，那麼假設產品<span
lang=EN-US>C</span>的解析度是<span lang=EN-US>80x80</span>，那麼工程師就要到整個系統中找出與<span
lang=EN-US>LCD</span>寬和高有關的程式段，逐一修改測試，這樣不但浪費時間，而且很容易發生疏忽或錯誤。如果把<span
lang=EN-US>LCD</span>的寬與高分別定義在<span lang=EN-US>.h</span>檔中<span lang=EN-US>(</span>請見以下程式<span
lang=EN-US>)</span>，則不管是產品<span lang=EN-US>A</span>、<span lang=EN-US>B</span>或<span
lang=EN-US>C</span>的程式部分都是一樣的。<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>#if
defined PRODUCT_MODEL_A<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:21.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;
mso-line-height-rule:exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";
color:blue'>#define LCD_WIDTH 160<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:21.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;
mso-line-height-rule:exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";
color:blue'>#define LCD_HEIGHT 160<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'><span style='mso-tab-count:
1'>        </span>#elif defined PRODUCT_MODEL_B<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:21.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;
mso-line-height-rule:exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";
color:blue'>#define LCD_WIDTH 160<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:21.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;
mso-line-height-rule:exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";
color:blue'>#define LCD_HEIGHT 240<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'><span style='mso-tab-count:
1'>        </span>#elif defined PRODUCT_MODEL_C<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:21.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;
mso-line-height-rule:exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";
color:blue'>#define LCD_WIDTH 80<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:21.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;
mso-line-height-rule:exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";
color:blue'>#define LCD_HEIGHT 80<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'><span style='mso-tab-count:
1'>        </span>#endif<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『此外在驅動程式的設計中也可以用到，例如操作<span
lang=EN-US>NAND Flash</span>時，程式要按照<span lang=EN-US>NAND Flash chip</span>的需求，依次控制<span
lang=EN-US>CPU</span>某些與<span lang=EN-US>NAND Flash</span>連接的<span lang=EN-US>PIN</span>腳，因為這些動作相當頻繁，那麼程式中一堆“<span
lang=EN-US> *(volatile unsigned char*)0x402d9|=0x20 ;</span>”這樣的東西，即便寫了注解，還是感覺程式有點雜亂；此時在<span
lang=EN-US>.h</span>檔中加入以下的定義，則程式中就可以直接用“<span lang=EN-US>SET_ALE_H ;</span>”這樣的敘述，程式可讀性會比較好<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>// ALE</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:"微軟正黑體","sans-serif";
color:blue'>與<span lang=EN-US>CLE</span>是<span lang=EN-US>CPU</span>與<span
lang=EN-US>NAND Flash chip</span>連接的兩根<span lang=EN-US>PIN</span>腳<span
lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>// </span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:"微軟正黑體","sans-serif";
color:blue'>在控制<span lang=EN-US>NAND Flash</span>時要頻繁地將其拉<span lang=EN-US>High</span>或拉<span
lang=EN-US>Low<o:p></o:p></span></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>//<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>#define<span
style='mso-tab-count:1'> </span>SET_ALE_H<span style='mso-tab-count:2'>            </span>*(volatile
unsigned char*)0x402d9|=0x20<span style='mso-tab-count:1'>    </span><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>#define<span
style='mso-tab-count:1'> </span>SET_ALE_L<span style='mso-tab-count:2'>             </span>*(volatile
unsigned char*)0x402d9&amp;=0xdf<span style='mso-tab-count:1'>   </span><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>#define
SET_CLE_H<span style='mso-tab-count:2'>            </span>*(volatile unsigned
char*)0x402d9|=0x10<span style='mso-tab-count:1'>    </span><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>#define
SET_CLE_L<span style='mso-tab-count:2'>             </span>*(volatile unsigned
char*)0x402d9&amp;=0xef<span style='mso-tab-count:1'>   </span><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『你說了“定義常數”這種方法在應用程式以及驅動程式上的應用，但是就是不提<span
lang=EN-US>CPU memory mapping register</span>的編號的設定，你是不是暗示說暫存器的編號不適合用這種作法命名？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『基本上我是不會公開違背教科書的“教誨”；但你想想看，我們<span
lang=EN-US>CPU</span>的暫存器有<span lang=EN-US>N</span>百個，當我們在調整程式，要查某段程式碼使用到之暫存器的意義時，該怎麼做比較快？應該就是翻<span
lang=EN-US>data sheet</span>吧，<span lang=EN-US>data sheet</span>中一定會有按照暫存器編號順序排列的表格，所以知道編號的話，翻紙本的<span
lang=EN-US>data sheet</span>往往會比搜尋電子檔還快。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>如果你的程式中充滿了諸如“<span
lang=EN-US>REG_LCD_ENABLE</span>”、“<span lang=EN-US> REG_GPIO_P02_SEL</span>”、“<span
lang=EN-US>REG_USB_DMA_SETTING</span>”<span lang=EN-US>…</span>這些東西，我才不相信有人可以記得這些名字所代表的暫存器編號，所以就要先到<span
lang=EN-US>.h</span>檔去搜尋，才能去查<span lang=EN-US>data sheet</span>。如果程式是幾行就算了，有時操作設備的一個動作就要用到好幾個暫存器，工程師好不容易看懂這個程式，結果火氣也上來了。如果有人把上面那個例子定義如下，那簡直是氣死人了，好不容易找到“<span
lang=EN-US>SET_CLE_L</span>”定義的<span lang=EN-US>.h</span>檔，結果居然看不到暫存器的編號，還要去查另一個常數的定義，我個人覺得這是浪費時間。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>#define
SET_CLE_L<span style='mso-tab-count:2'>             </span>REG_CPU_PIN_CLE_SETTING
&amp;=0xef</span><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『我雖然沒有實際經驗，但我也翻過<span
lang=EN-US>CPU data sheet</span>後那一堆暫存器的列表，的確沒有人可以記得哪些編號的暫存器是做什麼的，實作時一定是一本<span
lang=EN-US>data sheet</span>放在旁邊翻。可是我們直接在程式中寫暫存器編號是否會破壞程式的可讀性？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『我覺得把暫存器編號定義成其他名字，乍看下去好像很有意義，殊不知這樣才是破壞的程式的可讀性與可維護性。在程式中將常數定義為有意義的名字，是因為這些常數可能會改變，例如不同的產品<span
lang=EN-US>LCD</span>的解析度可能改變，或者我們可以用<span lang=EN-US>CPU</span>的另一根<span
lang=EN-US>PIN</span>腳當作<span lang=EN-US>CLE</span>來控制<span lang=EN-US>NAND
Flash</span>。但是暫存器的值在我們選定<span lang=EN-US>CPU</span>後就定下來了，基本上不會有改變的可能；所以即便教科書是這麼教我們的，但<b
style='mso-bidi-font-weight:normal'>實務上我嚴格禁止我的韌體工程師把<span lang=EN-US>CPU memory
mapping register</span>重新命名</b>，看到一個我改一個，看到一堆我就會把相關工程師叫來念一下。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『這就是理論與實戰經驗間的鴻溝吧。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>==================================================================<o:p></o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>絕大部分用於嵌入式系統的<span
lang=EN-US>CPU</span>，是採用<span lang=EN-US>memory mapping I/O</span>的設計方式來控制<span
lang=EN-US>CPU</span>的所有功能，包含<span lang=EN-US>CPU</span>內置的<span lang=EN-US>IC</span>；但<span
lang=EN-US>memory mapping I/O</span>並不是唯一的設計方式，另一種稱為<span lang=EN-US>Port I/O</span>，最著名的就是<span
lang=EN-US>X86</span>系列。實際上很少嵌入式系統開發案會選用<span lang=EN-US>Pentinum</span>以上等級的<span
lang=EN-US>X86 CPU</span>，除了價格昂貴外，<span lang=EN-US>CPU</span>的體積、耗電等都是致命傷，而且大部分的產品都用不著這麼強大的計算能力；但<span
lang=EN-US>X86</span>家族中歷史悠久的<span lang=EN-US>80186</span>系列，目前還廣泛的應用在電子產品中。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:18.0pt;
mso-line-height-rule:exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><!--[if gte vml 1]><v:shape
 id="_x0000_i1029" type="#_x0000_t75" style='width:390.75pt;height:295.5pt'>
 <v:imagedata src="/b2/CH07_03.files/image009.jpg" o:title="07-05-著名的CPU廠商所提供的80186 CPU"/>
</v:shape><![endif]--><![if !vml]><img width=521 height=394
src="/b2/CH07_03.files/image010.jpg" v:shapes="_x0000_i1029"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc165115548"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>7-5</span>：著名的<span
lang=EN-US>CPU</span>廠商所提供的<span lang=EN-US>80186 CPU</span></span></a><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>簡單的說，所謂的<span
lang=EN-US>Port I/O</span>也是一段連續的位址空間<span lang=EN-US>(</span>但<span
lang=EN-US>Memory</span>的位址空間和<span lang=EN-US>I/O Port</span>的位址空間是分開、獨立且互不相干的<span
lang=EN-US>)</span>，但<span lang=EN-US>CPU</span>不能以位址或指標的方式對其進行存取，必須透過特殊的<span
lang=EN-US>CPU</span>指令，以<span lang=EN-US>X86</span>系列<span lang=EN-US>CPU</span>為例，提供了<span
lang=EN-US>”in”</span>與<span lang=EN-US>”out”</span>指令，可從某個特定<span lang=EN-US>port</span>進行輸出或讀值的動作；例如<span
lang=EN-US>PC</span>上的<span lang=EN-US>RS232</span>就是利用<span lang=EN-US> Port
0x<st1:chmetcnv UnitName="F" SourceValue="3" HasSpace="False" Negative="False"
NumberType="1" TCSC="0" w:st="on">3F</st1:chmetcnv>8 </span>去讀取資料。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>對韌體工程師而言，<span
lang=EN-US>Port I/O</span>比<span lang=EN-US>Memory mapping I/O</span>麻煩一點，必須用到組合語言指令才可以操作<span
lang=EN-US>CPU</span>內部的<span lang=EN-US>I/O port</span>；但基本原理並不太複雜，只要遵循<span
lang=EN-US>CPU</span>手冊的規定即可。目前<span lang=EN-US>memory mapping I/O</span>的設計方式是嵌入式系統<span
lang=EN-US>CPU</span>的主流，本書會以講述<span lang=EN-US>Memory mapping I/O</span>為主。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<h3 style='line-height:18.0pt;mso-line-height-rule:exactly'><a
name="_Toc304922114"></a><a name="_Toc149018070"><span style='mso-bookmark:
_Toc304922114'><span style='font-family:"微軟正黑體","sans-serif"'>中斷</span></span></a><span
style='mso-bookmark:_Toc304922114'><span style='font-family:"微軟正黑體","sans-serif"'>處理器</span></span><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></h3>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『我們之前已經講過中斷向量的觀念，但你可知道最早的<span
lang=EN-US>CPU</span>可能是沒有中斷控制器的，它必須外加一個<span lang=EN-US>chip<a
style='mso-footnote-id:ftn2' href="#_ftn2" name="_ftnref2" title=""><span
class=MsoFootnoteReference><span style='mso-special-character:footnote'><![if !supportFootnotes]><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:12.0pt;font-family:
"微軟正黑體","sans-serif";mso-bidi-font-family:"Times New Roman";mso-font-kerning:
1.0pt;mso-ansi-language:EN-US;mso-fareast-language:ZH-TW;mso-bidi-language:
AR-SA'>[2]</span></span><![endif]></span></span></a></span>才能接受外部裝置的中斷要求？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『我在學校學組合語言時好像有談到<span
lang=EN-US>PC</span>中有一顆中斷處理器，好像叫<span lang=EN-US>8259</span>，教科書中還花了一個章節講它的運作方式，只是學期結束就忘光了。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『這年頭還知道<span
lang=EN-US>8259</span>這個東東的資訊本科生實在也不多了；所幸目前用於嵌入式系統的<span lang=EN-US>CPU</span>幾乎都把中斷控制器內含在<span
lang=EN-US>CPU</span>內，驅動程式需要做的設定並不多，基本上就是透過<span lang=EN-US>memory mapping
register</span>以及之前提過的<span lang=EN-US>PSR</span>暫存器<span lang=EN-US>(processor
status register)</span>。驅動程式在控制中斷系統時要注意的事項有：<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l14 level1 lfo7;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>Boot</span><span
style='font-family:"微軟正黑體","sans-serif"'>之後馬上禁止中斷產生<span lang=EN-US>(</span>應該都是設定<span
lang=EN-US>PSR)</span>，因為除了中斷系統還沒設定好外，可能產生中斷的硬體設備也還沒初始化完畢。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l14 level1 lfo7;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>內建中斷處理器的<span lang=EN-US>CPU</span>會規定哪些<span
lang=EN-US>PIN</span>腳是可以產生中斷的，而哪些<span lang=EN-US>PIN</span>腳會產生什麼中斷通常也是定義好的，例如內建<span
lang=EN-US>USB controller</span>的<span lang=EN-US>CPU</span>，可能就會規定某根<span
lang=EN-US>PIN</span>腳用來接收<span lang=EN-US>USB</span>設備的中斷訊號。所以在硬體設計時一定要注意<span
lang=EN-US>CPU</span>中與中斷有關的相關規範，舉例來說，如果鍵盤輸入接到<span lang=EN-US>CPU</span>不會產生中斷的<span
lang=EN-US>PIN</span>腳，則程式只能用<span lang=EN-US>polling(</span>輪詢<span
lang=EN-US>)</span>的方式一直去察看有沒有<span lang=EN-US>key</span>被按下<span lang=EN-US>(</span>該<span
lang=EN-US>PIN</span>腳的電位是否改變<span lang=EN-US>)</span>，這是很沒有效率的設計。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l14 level1 lfo7;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>同理，韌體工程師必須知道什麼裝置接到<span lang=EN-US>CPU</span>的哪一根<span
lang=EN-US>PIN</span>腳，是否會引發中斷，如果會的話，又是第幾號中斷。一定要弄清楚相關的硬體設計，否則怎麼有辦法寫該裝置的驅動程式？<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l14 level1 lfo7;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>設定中斷向量表的起始位址<span lang=EN-US>(</span>通常都是透過暫存器來設定<span
lang=EN-US>)</span>，中斷向量表可以寫成一個<span lang=EN-US>C</span>的陣列<span lang=EN-US>(</span>請參考<span
lang=EN-US>3-2</span>節<span lang=EN-US>)</span>，陣列內的元素就是各個<span lang=EN-US>ISR</span>的位址。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l14 level1 lfo7;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>我們的產品不見得會用到所有<span lang=EN-US>CPU</span>支援的中斷來源，也就是說不是每一個中斷向量表的<span
lang=EN-US>entry</span>都有對應的<span lang=EN-US>ISR</span>，但中斷向量表的每一個<span
lang=EN-US>entry</span>都必須有值，此時就必須為這些沒有用到的中斷來源寫一個空的<span lang=EN-US>ISR(</span>請參考<span
lang=EN-US>3-2</span>節的<span lang=EN-US>dummy() )</span>，當這個空的<span lang=EN-US>ISR</span>被執行時，就表示有不該產生的中斷產生了，這可能是硬體設計錯誤或靜電產生的誤動作，必須通知硬體同仁處理。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l14 level1 lfo7;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>驅動程式可以透過設定暫存器為每一個中斷來源設定優先等級<span
lang=EN-US>(</span>一般<span lang=EN-US>CPU</span>都是八個等級<span lang=EN-US>)</span>，<span
lang=EN-US>PSR</span>暫存器中除了可以設定中斷是否可以產生之外，也可以設定哪一個優先等級以下的中斷不會被<span lang=EN-US>CPU</span>處理。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l14 level1 lfo7;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>除非產品有<span lang=EN-US>hard real time</span>的應用，一般狀況我們不允許巢狀中斷<span
lang=EN-US> (ISR</span>在執行時允許發生中斷，於是<span lang=EN-US>ISR</span>可能被中斷，<span
lang=EN-US>CPU</span>去執行另一個<span lang=EN-US>ISR)</span>，亦即<span lang=EN-US>ISR</span>執行時期禁止中斷產生，這是因為巢狀中斷會出現很複雜的狀況。此時可以透過設定<span
lang=EN-US>CPU</span>允許產生中斷的優先等級，例如一般中斷的優先等級都是<span lang=EN-US>6</span>，而不允許任何等待或丟失的中斷事件則設為<span
lang=EN-US>7</span>，平常<span lang=EN-US>ISR</span>執行時設定<span lang=EN-US>CPU</span>僅允許優先等級<span
lang=EN-US>7</span>以上的中斷產生，則所有優先等級<span lang=EN-US>6</span>的中斷不會產生巢狀中斷，但優先等級<span
lang=EN-US>7</span>的中斷在任何時候都保證會被處理。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l14 level1 lfo7;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>此外還有一個比較特殊的中斷叫做<span lang=EN-US>NMI(Nonmaskable
Interrupt)</span>，顧名思義就是無論如何都不會被禁止的中斷，硬體設計時可以把<span lang=EN-US>hard real time</span>的中斷來源接到<span
lang=EN-US>NMI</span>上。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l14 level1 lfo7;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>雖說<span lang=EN-US>ISR</span>也是一個函數，但有很多注意事項要遵守，尤其是<span
lang=EN-US>critical section</span>的保護，稍後我們會再提到。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>此外<span lang=EN-US>ISR</span>不像一般程式是循序執行的，它會在任何程式在執行時被呼叫，可能發生的狀況很多，所以我會要求對<span
lang=EN-US>ISR</span>進行更嚴格的測試。<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『像鍵盤、<span
lang=EN-US>touch panel</span>、<span lang=EN-US>timer</span>等需要中斷通知系統有外部事件發生，這很容易想像，但我還是沒什麼概念，到底什麼樣的裝置才需要產生中斷？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『一言以蔽之，由程式主動控制的就不需要中斷，例如點亮<span
lang=EN-US>LED</span>、設定<span lang=EN-US>LCD</span>、<span lang=EN-US>SDRAM
controller</span>、關閉放大器的電源等等；反之可能任何時間點發生的硬體事件就必須用中斷通知系統，假如系統一直在監視著外部裝置的狀態，不但效率不佳<span
lang=EN-US>(</span>在等待事件發生時無法做其他的事情<span lang=EN-US>)</span>、耗電<span
lang=EN-US>(</span>系統無法進入最省電的模式<span lang=EN-US>)</span>，如果要監視的裝置很多那就更麻煩了；舉幾個你可能沒聽過的例子：<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l3 level1 lfo8;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>DMA</span><span
style='font-family:"微軟正黑體","sans-serif"'>完成<span lang=EN-US> (</span>直接記憶體存取<span
lang=EN-US> (Direct Memory Access, DMA)</span>，允許某些電腦內部的硬體子系統可以獨立地存取系統記憶體的讀取或寫入，而不需牽涉到<span
lang=EN-US>CPU)<o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l3 level1 lfo8;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>LCD controller</span><span
style='font-family:"微軟正黑體","sans-serif"'>完成一次整個屏幕的更新<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l3 level1 lfo8;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>AD convert</span><span
style='font-family:"微軟正黑體","sans-serif"'>轉換完畢<span lang=EN-US> (Analog to
Digital Convert)<o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l3 level1 lfo8;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>MP3</span><span
style='font-family:"微軟正黑體","sans-serif"'>解碼<span lang=EN-US>IC – buffer</span>內的<span
lang=EN-US>MP3</span>內容已經解完了，通知系統儘快把下一段資料送到<span lang=EN-US>buffer</span>中<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l3 level1 lfo8;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>序列傳輸或網路設備傳輸 <span lang=EN-US>– </span>收到的資料錯誤、傳送<span
lang=EN-US>buffer</span>已經空了、接收<span lang=EN-US>buffer</span>已經滿了<span
lang=EN-US>…</span>都可能會產生中斷<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif";display:none;mso-hide:
all'>ˊˊ用台　</span><span style='font-family:"微軟正黑體","sans-serif"'>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<h3 style='line-height:18.0pt;mso-line-height-rule:exactly'><a
name="_Toc304922115"></a><a name="_Toc149018071"><span style='mso-bookmark:
_Toc304922115'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>Clock</span></span></a><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></h3>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『之前你提過，硬體工程師在把板子交給韌體工程師之前，至少必須驗證兩件事情：一個是<span
lang=EN-US>CPU</span>與主要零件的電源是否正確，例如<span lang=EN-US>CPU</span>規定的工作電壓是<span
lang=EN-US>2.8V~3.3V</span>，而另一個<span lang=EN-US>chip</span>的工作電壓可能只要<span
lang=EN-US>1.5V</span>，工作電壓和可接受最大電流是讓電子零件正常運作最基本的條件，硬體工程師自然會搞定它。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>第二個一定要確認的就是輸入<span
lang=EN-US>CPU</span>的<span lang=EN-US>clock</span>是否正確。電源比較容易了解，電子的東西總是要電才能運作嘛，但是<span
lang=EN-US>clock</span>就比較難以想像，所謂的<span lang=EN-US>clock</span>到底是什麼樣的概念啊？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『所謂的<span
lang=EN-US>clock</span>是維持<span lang=EN-US>CPU</span>正常運作所需的基本時間單位；我試著簡化這些電子零件運作時的複雜度，舉例來說，當<span
lang=EN-US>CPU</span>要到<span lang=EN-US>ROM</span>或其他記憶體中讀取一個<span lang=EN-US>byte</span>時，假設這個動作<span
lang=EN-US>CPU</span>要在兩個時間單位內做完，第一個時間單位從<span lang=EN-US>address bus</span>送出位址，第二個時間單位自<span
lang=EN-US>data bus</span>取回資料的值<a style='mso-footnote-id:ftn3' href="#_ftn3"
name="_ftnref3" title=""><span class=MsoFootnoteReference><span lang=EN-US><span
style='mso-special-character:footnote'><![if !supportFootnotes]><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:12.0pt;font-family:
"微軟正黑體","sans-serif";mso-bidi-font-family:"Times New Roman";mso-font-kerning:
1.0pt;mso-ansi-language:EN-US;mso-fareast-language:ZH-TW;mso-bidi-language:
AR-SA'>[3]</span></span><![endif]></span></span></span></a>；問題來了，如果<span
lang=EN-US>CPU</span>和<span lang=EN-US>ROM</span>之間的時間單位長度不同，或者不同步會發生什麼事情？<span
style='display:none;mso-hide:all'>果說明　單位做完　零件正常運作所需之基本的時間單位，ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『就像我和你約好下午五點整二十分見面，逾時不候，但我的手錶和你有一小時的時差，或者我的錶每十分鐘會快兩分鐘，所以我們可順利碰面的機會微乎其微。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『你這個比喻還不錯，大概就是這個概念；系統中的<span
lang=EN-US>CPU</span>和記憶體應該要有一個統一的時間基準，我們稱之為時序，例如我們說某顆<span lang=EN-US>Pentium <st1:chmetcnv
UnitName="C" SourceValue="4" HasSpace="True" Negative="False" NumberType="1"
TCSC="0" w:st="on">4 C</st1:chmetcnv>PU</span>是<st1:chmetcnv UnitName="g"
SourceValue="2" HasSpace="False" Negative="False" NumberType="1" TCSC="0"
w:st="on"><span lang=EN-US>2G</span></st1:chmetcnv><span lang=EN-US>Hz</span>的，則表示這顆<span
lang=EN-US>CPU</span>運作的基本時間單位為<span lang=EN-US>1/(2x1024x1024)</span>秒，這裡所說的基本時間單位可以簡稱為一個<span
lang=EN-US>clock</span>；如果<span lang=EN-US>CPU</span>一個<span lang=EN-US>clock</span>可以執行一個指令<a
style='mso-footnote-id:ftn4' href="#_ftn4" name="_ftnref4" title=""><span
class=MsoFootnoteReference><span lang=EN-US><span style='mso-special-character:
footnote'><![if !supportFootnotes]><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:12.0pt;font-family:"微軟正黑體","sans-serif";mso-bidi-font-family:
"Times New Roman";mso-font-kerning:1.0pt;mso-ansi-language:EN-US;mso-fareast-language:
ZH-TW;mso-bidi-language:AR-SA'>[4]</span></span><![endif]></span></span></span></a>，那麼一個<span
lang=EN-US>clock</span>越短的<span lang=EN-US>CPU</span>在每一秒內就可以執行更多的指令，對使用者而言這顆<span
lang=EN-US>CPU</span>的效能也就越好。』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『這就是所謂<span
lang=EN-US>CPU</span>“超頻”的原理吧，同一顆<span lang=EN-US>CPU</span>使用不同的時序就會有運算速度不同的效果。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『沒錯，用於嵌入式系統之<span
lang=EN-US>CPU</span>的概念也是一樣的，只是它們的時序通常沒那麼快，現在用於<span lang=EN-US>PDA</span>或<span
lang=EN-US>smart phone</span>的<span lang=EN-US>ARM</span>系列<span lang=EN-US>CPU</span>時序已達<span
lang=EN-US>500</span>多<span lang=EN-US>MHz</span>，這在一般電子產品的設計上是不可想像的。<span
lang=EN-US>Clock</span>的觀念應該很容易了解，他就像<span lang=EN-US>CPU</span>的心跳，問題是這個穩定的“心跳”從何而來？<span
lang=EN-US>CPU</span>與記體體之間的“心跳”要如何同步？再繼續往下說明之前，你先看一下這張時序圖，它在說明<span
lang=EN-US>CPU</span>自如何自<span lang=EN-US>SRAM</span>中讀取一個<span lang=EN-US>byte</span>。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><!--[if gte vml 1]><v:shape
 id="_x0000_i1030" type="#_x0000_t75" style='width:505.5pt;height:273pt'>
 <v:imagedata src="/b2/CH07_03.files/image011.jpg" o:title="07-06-CPU與外部SRAM互動的時序圖"/>
</v:shape><![endif]--><![if !vml]><img width=674 height=364
src="/b2/CH07_03.files/image012.jpg" v:shapes="_x0000_i1030"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc165115549"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>7-6</span>：<span
lang=EN-US>CPU</span>與外部<span lang=EN-US>SRAM</span>互動的時序圖</span></a><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『嚇！我從以前到現在最怕的就是看這種圖，實在不知道它要表達什麼？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『這就和硬體工程師看到程式就莫名奇妙的害怕一樣，如果你不覺得寫程式有什麼難的話，那麼你真的沒有理由看不懂這張圖。所謂的時序圖就是在某個時間點<span
lang=EN-US>chip</span>上各個<span lang=EN-US>PIN</span>腳上訊號的關係圖，這種圖一定要有基本的時間參考，這樣工程師才知道哪根<span
lang=EN-US>PIN</span>腳在什麼時間點應該是什麼狀態才是對的。以上圖來說，你先不要管圖裡的細節，只要看每根<span lang=EN-US>PIN</span>腳高高低低的變化關係即可。當<span
lang=EN-US>CPU</span>要到<span lang=EN-US>ROM</span>裡面讀一個<span lang=EN-US>byte</span>出來時，<span
lang=EN-US>CPU</span>各個<span lang=EN-US>PIN</span>腳隨著一個一個<span lang=EN-US>clock</span>的推移<span
lang=EN-US>(</span>即圖中的<span lang=EN-US>BCLK)</span>，必須符合圖中的狀態才可能運作正確。如果程式到<span
lang=EN-US>ROM</span>中始終讀不到正確的資料，那麼我們就可以當程式在運作時，量一下圖中各個<span lang=EN-US>PIN</span>腳的訊號使否和時序圖中的一樣，應該很容易就可以找出問題在哪裡。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>順帶一提，韌體工程師必須要能看懂<span
lang=EN-US>data sheet</span>中的時序圖，不是為了搶硬體工程師的飯碗，而是在對驅動程式除錯時一定會用到，以後我們再來看實例。<span
style='display:none;mso-hide:all'>否訊號運作時下係即可就是看這種圖的機會ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『如果只專注在每一個<span
lang=EN-US>PIN</span>腳的高低變化，這張時序圖確實沒那麼複雜。話說回來，你還沒解答<span lang=EN-US>clock</span>的來源與裝置間的時序如何保持同步這兩個問題。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『上次我們在為<span
lang=EN-US>boot-loader</span>無法執行而傷腦筋時，<span lang=EN-US>CPU</span>廠商的<span
lang=EN-US>FAE</span>一來就現用電錶量了輸入<span lang=EN-US>CPU</span>的電壓與耗電流，接著他量了離<span
lang=EN-US>CPU</span>不遠的震盪器<span lang=EN-US>IC</span>，示波器螢幕出現了頻率為漂亮<st1:chmetcnv
UnitName="m" SourceValue="48" HasSpace="False" Negative="False" NumberType="1"
TCSC="0" w:st="on"><span lang=EN-US>48M</span></st1:chmetcnv><span lang=EN-US>hz</span>的漂亮方波<span
lang=EN-US>(</span>如圖<span lang=EN-US>7-7)</span>。<span style='display:none;
mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><!--[if gte vml 1]><v:shape
 id="_x0000_i1031" type="#_x0000_t75" style='width:426.75pt;height:318.75pt'>
 <v:imagedata src="/b2/CH07_03.files/image013.jpg" o:title="07-07-震盪器所產生之固定頻率的clock-48Mhz"/>
</v:shape><![endif]--><![if !vml]><img width=569 height=425
src="/b2/CH07_03.files/image014.jpg" v:shapes="_x0000_i1031"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc165115550"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>7-7</span>：震盪器所產生之固定頻率的<span
lang=EN-US>clock</span></span></a><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『你還記得嗎？他確認了這兩件事後才開始找程式不能執行的問題，因為電源與<span
lang=EN-US>clock</span>是<span lang=EN-US>CPU</span>要運行的基本條件；如果電源有問題或者沒有穩定的<span
lang=EN-US>clock</span>輸入<span lang=EN-US>CPU</span>，那麼<span lang=EN-US>CPU</span>肯定是不會動的，這些基本的檢驗雖然簡單，但我就常看到有工程師量了半天訊號，卻完全沒想到可能是輸入<span
lang=EN-US>CPU</span>的電壓有問題或者<span lang=EN-US>clock</span>的頻率不對。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>那個離<span lang=EN-US>CPU</span>最近的震盪器<span
lang=EN-US>IC</span>就是<span lang=EN-US>CPU</span>時序的來源<span lang=EN-US>(</span>如圖<span
lang=EN-US>7-8)</span>，這種<span lang=EN-US>chip(Crystal</span>或<span
class=MsoHyperlink><span lang=EN-US style='color:windowtext;text-decoration:
none;text-underline:none'>Oscillators</span></span><span lang=EN-US>)</span>可以穩定的產生固定頻率的方波，而<span
lang=EN-US>CPU</span>會有<span lang=EN-US>PIN</span>腳接受外部的時序輸入。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:18.0pt;
mso-line-height-rule:exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";
color:red'><!--[if gte vml 1]><v:shape id="_x0000_i1032" type="#_x0000_t75"
 style='width:409.5pt;height:320.25pt'>
 <v:imagedata src="/b2/CH07_03.files/image015.jpg" o:title="07-08-(a)-CPU+OSC1+OSC3"/>
</v:shape><![endif]--><![if !vml]><img width=546 height=427
src="/b2/CH07_03.files/image016.jpg" v:shapes="_x0000_i1032"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc165115551"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>7-8(a)</span>：<span
lang=EN-US>CPU</span>與外部震盪器</span></a><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『時序進入<span
lang=EN-US>CPU</span>內部後，<span lang=EN-US>CPU</span>可將其升頻或降頻，並分出幾個頻率不同的分支，分別供給<span
lang=EN-US>CPU core</span>與其他的內置設備。例如，輸入<span lang=EN-US>CPU</span>的頻率是<st1:chmetcnv
UnitName="m" SourceValue="48" HasSpace="False" Negative="False" NumberType="1"
TCSC="0" w:st="on"><span lang=EN-US>48M</span></st1:chmetcnv><span lang=EN-US>hz</span>，<span
lang=EN-US>CPU</span>可將其放大成兩倍，也就是<st1:chmetcnv UnitName="m" SourceValue="96"
HasSpace="False" Negative="False" NumberType="1" TCSC="0" w:st="on"><span
 lang=EN-US>96M</span></st1:chmetcnv><span lang=EN-US>hz</span>，供給<span
lang=EN-US>CPU</span>核心的執行時序；或降頻為<st1:chmetcnv UnitName="m" SourceValue="12"
HasSpace="False" Negative="False" NumberType="1" TCSC="0" w:st="on"><span
 lang=EN-US>12M</span></st1:chmetcnv><span lang=EN-US>hz</span>供給時序需求比較慢的<span
lang=EN-US>LCD</span>控制器<span lang=EN-US>…</span>等。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>接下來說到外部設備的時序同步：為了保持震盪器的精準度，在<span
lang=EN-US>PCB layout</span>時不會把震盪器與需要時序輸入的晶片離太遠；而且由同一個震盪器供應一個以上晶片所需的時序也不是好主意，因為每個晶片需要的工作頻率可能大不相同。如果把所有需要<span
lang=EN-US>clock</span>的晶片都配置一個震盪器更不可行，因為震盪器和各個零件的距離不一樣，一定會有時序不同步的問題。所以最好的方法就是由<span
lang=EN-US>CPU</span>統一供給，震盪器輸入<span lang=EN-US>CPU</span>的時序頻率可以升頻或降頻為各個晶片工作所需要的頻率，再透過<span
lang=EN-US>CPU</span>既定的輸出<span lang=EN-US>PIN</span>腳連接到需要時序輸入的晶片；此來不但不需要額外不同頻率的震盪器，而且由<span
lang=EN-US>CPU</span>產生的<span lang=EN-US>clock</span>肯定不會有不同步的問題。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>然而有些外部晶片的時序是不需要與<span
lang=EN-US>CPU</span>同步的，例如系統可能同時存在兩個<span lang=EN-US>CPU</span>，或擁有另一個功能獨立的<span
lang=EN-US>DSC</span>，這種狀況下沒有一定的硬體設計，端視其規格而定。一種作法是將另一個<span lang=EN-US>CPU</span>或<span
lang=EN-US>DSC</span>與其周邊迴路當作另一台機器，主副<span lang=EN-US>CPU</span>間透過諸如序列、並列傳輸或<span
lang=EN-US>I<st1:chmetcnv UnitName="C" SourceValue="2" HasSpace="False"
Negative="False" NumberType="1" TCSC="0" w:st="on">2C</st1:chmetcnv></span>、<span
lang=EN-US>I2S</span>等通訊協定溝通，此時副<span lang=EN-US>CPU</span>就會需要自己的時序並搭配另一個震盪器。<span
style='display:none;mso-hide:all'>產生的器響ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:18.0pt;
mso-line-height-rule:exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";
color:red'><!--[if gte vml 1]><v:shape id="_x0000_i1033" type="#_x0000_t75"
 style='width:427.5pt;height:282.75pt'>
 <v:imagedata src="/b2/CH07_03.files/image017.jpg" o:title="07-08-(b)-CPU與外部晶片都有自己的OSC"/>
</v:shape><![endif]--><![if !vml]><img width=570 height=377
src="/b2/CH07_03.files/image018.jpg" v:shapes="_x0000_i1033"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc165115552"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>7-8(b)</span>：<span
lang=EN-US>CPU</span>與外部晶片各有自己的震盪器</span></a><span lang=EN-US style='font-family:
"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『要幫<span lang=EN-US>CPU</span>以及其他週邊提供時序的方法很容易，就是使用一個震盪器<span
lang=EN-US>IC</span>產生固定頻率的方波給<span lang=EN-US>CPU</span>即可，但系統中所有裝置協同運作的原理似乎還蠻複雜與多樣的，我需要回去再看一下剛剛的筆記，好好思考一下。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>此外我們的系統中似乎有兩個速度差很多的震盪器，一個是<st1:chmetcnv
UnitName="m" SourceValue="48" HasSpace="False" Negative="False" NumberType="1"
TCSC="0" w:st="on"><span lang=EN-US>48M</span></st1:chmetcnv><span lang=EN-US>hz</span>，另一個是<span
lang=EN-US>32768Hz</span>，分別輸入<span lang=EN-US>CPU</span>不同的<span lang=EN-US>PIN</span>腳，為什麼<span
lang=EN-US>CPU</span>會需要兩個時序輸入？而且這樣的設計似乎還是<span lang=EN-US>CPU</span>的<span
lang=EN-US>data sheet</span>中建議的。<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『<span lang=EN-US>Data
sheet</span>中有提到另一個慢速的震盪器是什麼情況要用的啊，你去把相關章節看一下就懂了。』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『我有很認真地“翻過”<span
lang=EN-US>CPU</span>的<span lang=EN-US>data sheet</span>，我想一般工程師都有和我一樣的困擾，那麼厚一本書，又全是英文的，總不可能全部<span
lang=EN-US>K</span>完吧！<span lang=EN-US>CPU</span>內有許多<span lang=EN-US>memory
mapping register</span>是用來設定<span lang=EN-US>CPU clock</span>的，例如：工程師可以設定<span
lang=EN-US>CPU</span>內部各個裝置，包含<span lang=EN-US>CPU core</span>，真正的工作時序，基本上就是由外部輸入的時序作升頻或降頻；此外工程師也可以設定<span
lang=EN-US>CPU</span>要用哪一個震盪器的輸入，當作真正運行時的時序來源<span lang=EN-US>…</span>等。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『所以你已了解需要兩個頻率輸入的原因是什麼了嗎？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『<span lang=EN-US>CPU</span>若使用較慢的震盪器當作運行時的時序來源，基本上它就是處於一個很慢速的狀態；而且這個<span
lang=EN-US>clock</span>輸入的頻率<span lang=EN-US>(32769Hz)</span>慢的有點離譜，估計系統不會希望用這樣的速度執行什麼重要的任務。所以當系統程式切換<span
lang=EN-US>CPU</span>的時序輸入為慢速震盪器時，其目的應該是當系統沒什麼事情做的時候，可以讓<span lang=EN-US>CPU</span>進入較省電的狀態嗎？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『答對了，賓果！<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<h3 style='line-height:18.0pt;mso-line-height-rule:exactly'><a
name="_Toc304922116"><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>Bus
&amp; Chip Select</span></a><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></h3>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『<span lang=EN-US>Clock</span>與<span
lang=EN-US>Bus</span>是一般人比較不清楚的東西，但卻是<span lang=EN-US>CPU</span>運作裡相當重要的觀念；前面我們講了<span
lang=EN-US>Clock</span>，你知道所謂的<span lang=EN-US>Bus<a style='mso-footnote-id:
ftn5' href="#_ftn5" name="_ftnref5" title=""><span class=MsoFootnoteReference><span
style='mso-special-character:footnote'><![if !supportFootnotes]><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:12.0pt;font-family:
"微軟正黑體","sans-serif";mso-bidi-font-family:"Times New Roman";mso-font-kerning:
1.0pt;mso-ansi-language:EN-US;mso-fareast-language:ZH-TW;mso-bidi-language:
AR-SA'>[5]</span></span><![endif]></span></span></a></span>是什麼嗎？，<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『我參加過一次硬體迴路<span
lang=EN-US>review</span>會議，所以我大概知道<span lang=EN-US>bus</span>的用途；所謂的<span
lang=EN-US>bus</span>應該包含<span lang=EN-US>address bus</span>與<span lang=EN-US>data
bus</span>兩種，<span lang=EN-US>CPU</span>以及可用位址操作的晶片<span lang=EN-US>(</span>以記憶體居多<span
lang=EN-US>)</span>都會有類似稱為<span lang=EN-US>A0</span>、<span lang=EN-US>A1….A15…</span>或<span
lang=EN-US>D0</span>、<span lang=EN-US>D1…D15…</span>的<span lang=EN-US>PIN</span>腳，前者就是<span
lang=EN-US>address bus</span>，後者則是<span lang=EN-US>data bus</span>，<span
lang=EN-US>CPU</span>與所有的外部記憶體主要就是用這些<span lang=EN-US>PIN</span>腳串接起來，看實際的線路圖可能比較清楚。』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:red'><!--[if gte vml 1]><v:shape
 id="_x0000_i1034" type="#_x0000_t75" style='width:510pt;height:379.5pt'>
 <v:imagedata src="/b2/CH07_03.files/image019.jpg" o:title="07-09-CPU與外部記憶體的串接方式"/>
</v:shape><![endif]--><![if !vml]><img width=680 height=506
src="/b2/CH07_03.files/image020.jpg" v:shapes="_x0000_i1034"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc165115553"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>7-9(a)</span>：<span
lang=EN-US>CPU</span>與外部記憶體的串接方式</span></a><span lang=EN-US style='font-family:
"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『剛剛我們看的那張時序圖裡就包含有<span
lang=EN-US>data bus</span>與<span lang=EN-US>address bus</span>的狀態變化，首先<span
lang=EN-US>CPU</span>透過<span lang=EN-US>address bus</span>送出要操作的位址，如果是寫入記憶體的動作，<span
lang=EN-US>CPU</span>接著會送出要寫入的資料到<span lang=EN-US>data bus</span>上，記憶體從可<span
lang=EN-US>bus</span>上分別取得位址與要寫入的值，並執行<span lang=EN-US>CPU</span>要求的動作；反之，記憶體從<span
lang=EN-US>address bus</span>上取得位址後，會把位址上的值放到<span lang=EN-US>data bus</span>上，<span
lang=EN-US>CPU</span>則會自<span lang=EN-US>data bus</span>上把值讀入，從而完成從記憶體上取值的操作。簡單的說，<span
lang=EN-US>CPU</span>必須透過<span lang=EN-US>data bus</span>與<span lang=EN-US>address
bus</span>與記憶體連接，才能用指定位址的方式來存取記憶體。<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『基本上沒錯；我問你個問題，假設系統中有好幾顆外部記憶體，都串在<span
lang=EN-US>data</span>與<span lang=EN-US>address bus</span>上，當<span lang=EN-US>CPU</span>要到某個位址取值時，它會先把<span
lang=EN-US>address bus</span>的所有<span lang=EN-US>PIN</span>腳設為該位址，此時這些外部的記憶體怎麼知道是誰該把資料放上<span
lang=EN-US>data bus</span>，如果<span lang=EN-US>bus</span>上的所有記憶體都把資料放上<span
lang=EN-US>data bus</span>，那豈不是天下大亂？<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『記憶體晶片根據<span
lang=EN-US>address bus</span>上的位址判斷<span lang=EN-US>CPU</span>要操作的是不是自己嗎？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『你想想，記憶體晶片在設計時怎麼會知道要和哪種<span
lang=EN-US>CPU</span>配合？即便<span lang=EN-US>CPU</span>已選定，不同應用的硬體設計也可能將這個記憶體晶片定義在不同的位址上，所以記憶體晶片本身怎麼可能事先知道自己的位址範圍為何呢？<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>所以<span lang=EN-US>CPU</span>要使用某個晶片之前通常要明確的指定或“告知”，所謂“告知”的方法就是改變記憶體晶片上<span
lang=EN-US>CS PIN(Chip Select)</span>的狀態，一般都是由<span lang=EN-US>High</span>拉到<span
lang=EN-US>Low</span>，當晶片的<span lang=EN-US>CS PIN</span>狀態被改變時即表示通知其準備開始工作；當<span
lang=EN-US>CPU</span>不再使用該晶片時，就該把該記憶體晶片的<span lang=EN-US>CS PIN</span>狀態設為<span
lang=EN-US>High</span>。這就是為什麼即使<span lang=EN-US>bus</span>上串了許多記憶體晶片，但同時只有一個晶片會動作的原因。<span
style='display:none;mso-hide:all'>會知道設計十圖裡面懂了ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『所以<span lang=EN-US>CPU</span>和記憶體晶片除了用<span
lang=EN-US>address bus</span>與<span lang=EN-US>data bus</span>連接外，還需要額外一根<span
lang=EN-US>CS PIN</span>囉？每次操作記憶體的前後都要控制<span lang=EN-US>CS PIN</span>，這應該不是程式要做的吧，程式中使用指標時並不需要額外的處理啊？<span
style='display:none;mso-hide:all'>以片時是是指定麼會知道ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『是啊，在系統有多個記憶體晶片的狀況下：<span
lang=EN-US>CPU</span>與所有記憶體晶片當然是透過同一組<span lang=EN-US>address</span>與<span
lang=EN-US>data bus</span>串接，但是<span lang=EN-US>CPU</span>會用不同的<span
lang=EN-US>PIN</span>腳去控制不同記憶體晶片的<span lang=EN-US>CS PIN</span>，例如用名為<span
lang=EN-US>CS #1</span>的<span lang=EN-US>PIN</span>腳控制<span lang=EN-US>SRAM</span>，用<span
lang=EN-US>CS #2</span>控制<span lang=EN-US>ROM</span>。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>此外，當然是由<span
lang=EN-US>CPU</span>負責控制記憶體晶片的<span lang=EN-US>CS PIN</span>，否則編譯器怎麼可能預先知道產品的硬體設計會選用用哪一根<span
lang=EN-US>PIN</span>腳來控制某個記憶體，怎麼有辦法為諸如“操作變數”的<span lang=EN-US>C</span>語言程式碼產生組合語言碼？你可以想像<span
lang=EN-US>CPU</span>內有一個對應關係的表格<span lang=EN-US>(</span>以下表格是某<span
lang=EN-US>CPU</span>的實例<span lang=EN-US>)</span>，<span lang=EN-US>CPU</span>會根據要操作的位址，換算接在這個範圍內之記憶體晶片是用哪個<span
lang=EN-US>PIN</span>腳控制其<span lang=EN-US>CS PIN</span>的，在送出位址之前或同時，<span
lang=EN-US>CPU</span>就會把該<span lang=EN-US>PIN</span>腳拉<span lang=EN-US>Low(</span>設為低電位<span
lang=EN-US>)</span>。在看下面這張圖時，一個<span lang=EN-US>area</span>對應一段位址空間，你可以想像每個<span
lang=EN-US>area</span>對應一個<span lang=EN-US>CPU</span>的<span lang=EN-US>chip
select PIN</span>，一個<span lang=EN-US>chip select PIN</span>可以接一顆記憶體<span
lang=EN-US>IC</span>；所以當你的程式要存取某個位址時，<span lang=EN-US>CPU</span>會依據位址判斷式哪個<span
lang=EN-US>area</span>，再把相應的<span lang=EN-US>chip select PIN</span>拉<span
lang=EN-US>Low</span>，就可以存取到正確的記憶體<span lang=EN-US>IC</span>了。』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:red'><!--[if gte vml 1]><v:shape
 id="_x0000_i1035" type="#_x0000_t75" style='width:510pt;height:427.5pt'>
 <v:imagedata src="/b2/CH07_03.files/image021.jpg" o:title="07-10-位址範圍與Chip Select PIN的對應關係"/>
</v:shape><![endif]--><![if !vml]><img width=680 height=570
src="/b2/CH07_03.files/image022.jpg" v:shapes="_x0000_i1035"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc165115554"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>7-9(b)</span>：位址範圍與<span
lang=EN-US>Chip Select PIN</span>的對應關係</span></a><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『換句話說，因為<span
lang=EN-US>CPU</span>內部有這樣的對應規則，所以只要參考硬體設計，就可以由<span lang=EN-US>CPU</span>使用哪根<span
lang=EN-US>PIN</span>腳連接某顆記憶體晶片的<span lang=EN-US>CS PIN</span>，得知該記憶體晶片在系統中的位址範圍。有了這個位址範圍，韌體工程師就知道在程式或<span
lang=EN-US>link script</span>中該用什麼位址來操作這個記憶體晶片。也就是說，系統中某個記憶體晶片會對應到哪個位址範圍，端視<span
lang=EN-US>CPU</span>是用哪根<span lang=EN-US>PIN</span>腳連接其<span lang=EN-US>Chip-Select
PIN</span>；這些資訊都會定義在<span lang=EN-US>CPU</span>的<span lang=EN-US>data sheet</span>裡面。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>通常我們把這個位址範圍稱為一個<span
lang=EN-US>Area</span>，每一個<span lang=EN-US>Area</span>除了對應一個位址範圍以及一根<span
lang=EN-US>CPU PIN</span>腳<span lang=EN-US>(</span>一般也稱其為<span lang=EN-US>CS
PIN)</span>外。因為系統中的每一個記憶體晶片會有不同的特性，例如存取速度、基本的資料寬度<span lang=EN-US>(8bit</span>、<span
lang=EN-US>16bit or 32bit)…</span>等等，所以<span lang=EN-US>CPU</span>在操作不同記憶體晶片時應該會有不同的行為模式。例如：<span
lang=EN-US>ROM</span>和<span lang=EN-US>CPU</span>比起來算是較為慢速的設備，假設<span
lang=EN-US>CPU</span>要到<span lang=EN-US>ROM</span>讀一筆資料，當<span lang=EN-US>CPU</span>將位址透過<span
lang=EN-US>data bus</span>送出後，可能要多等待幾個<span lang=EN-US>clock</span>，該記憶體才來得及將資料放上<span
lang=EN-US>data bus</span>；其中等待的<span lang=EN-US>clock</span>數就稱為<span
lang=EN-US>waiting cycle</span>，也這就是上面所說的行為模式之一。<span lang=EN-US>CPU</span>會提供許多暫存器讓程式先設定各個<span
lang=EN-US>Area</span>的特性，通常可以設定的特性如下表，而這些特性當然要在實際操作記憶體前設定完畢。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>理論上<span lang=EN-US>CPU</span>操作某記憶體要插入幾個<span
lang=EN-US>waiting cycle</span>是可以計算的，<span lang=EN-US>CPU</span>的<span
lang=EN-US>data sheet</span>內都會有此資訊，通常是一個公式，輸入是<span lang=EN-US>CPU</span>的時序<span
lang=EN-US>(</span>例如<st1:chmetcnv UnitName="m" SourceValue="24"
HasSpace="False" Negative="False" NumberType="1" TCSC="0" w:st="on"><span
 lang=EN-US>24M</span></st1:chmetcnv><span lang=EN-US>Hz)</span>以及記憶體晶片的執行速度<span
lang=EN-US>(</span>例如<span lang=EN-US>90ns)</span>，就可以得出理論的<span lang=EN-US>waiting
cycle</span>數；實務上我們開始會把這個值設大一點，亦即<span lang=EN-US>CPU</span>存取該記憶體的速度會慢一點，等系統可以穩定的執行後，再來慢慢的調整系統各部門的<span
lang=EN-US>timing</span>。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>最後，值得注意的是，並非串在<span
lang=EN-US>bus</span>上的記憶體晶片才有<span lang=EN-US>Chip-Select PIN</span>，許多非記憶體的晶片在控制之前都必須改變其<span
lang=EN-US>Chip-Select PIN</span>的狀態。<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:red'><!--[if gte vml 1]><v:shape
 id="_x0000_i1036" type="#_x0000_t75" style='width:509.25pt;height:246pt'>
 <v:imagedata src="/b2/CH07_03.files/image023.jpg" o:title="07-09-(c)-用以設定”CPU操作外部記憶體的行為模式”的暫存器實例"/>
</v:shape><![endif]--><![if !vml]><img width=679 height=328
src="/b2/CH07_03.files/image024.jpg" v:shapes="_x0000_i1036"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc165115555"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>7-9(c)</span>：用以設定“<span
lang=EN-US>CPU</span>操作外部記憶體的行為模式”的暫存器實例</span></a><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『第一次接觸這個<span
lang=EN-US>CPU</span>是透過<span lang=EN-US>CPU</span>廠商提供的評估板，它的使用手冊上就明確指定了各個記憶體的位址範圍；現在才知道，原來系統中各個記憶體的位址範圍是這樣推演來的。這個東西不太容易了解，我得回去再複習一下剛剛的內容；但話說回來，一般工程師應該可以不知道這些原理吧？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『是的，一般軟體工程師甚至系統中哪一個記憶體是哪個位址範圍都不需要知道，因為<span
lang=EN-US>link script</span>會描述所有在連結時期所需要的資訊；但是負責驅動<span lang=EN-US>CPU</span>的韌體工程師就不能不清楚這個系統架構，每一個記憶體晶片有不同的特性，必須對<span
lang=EN-US>CPU</span>做不同的設定，記憶體操作不穩定，系統絕對也不會穩定。<span style='display:none;
mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<h3 style='line-height:18.0pt;mso-line-height-rule:exactly'><a
name="_Toc304922117"></a><a name="_Toc149018073"><span style='mso-bookmark:
_Toc304922117'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>GPIO
port</span></span></a><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></h3>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『<span lang=EN-US>CPU</span>中比較難懂的原理已經講完了，其他就是很單純的內部設備控制了。<span
lang=EN-US>CPU</span>是整個計算機系統的大腦，但它總是要控制外部設備，最簡單的像是點亮<span lang=EN-US>LED</span>、發出一段<span
lang=EN-US>beep(</span>嗶<span lang=EN-US>~~)</span>的聲音，或是將計算結果輸出到<span
lang=EN-US>LCD</span>上<span lang=EN-US>…</span>。除了輸出，<span lang=EN-US>CPU</span>也可能要接受並處理各種形式的輸入，例如按鍵、溫度變化、網路來的封包<span
lang=EN-US>…</span>等等。當然有的<span lang=EN-US>CPU</span>就是為了處理特殊的輸出或輸入而設計，但基本上大部分的<span
lang=EN-US>CPU</span>在設計時不可能知道客戶會拿它來設計怎麼樣的產品，所以一定會設計許多用來做一般用途輸出<span
lang=EN-US>/</span>輸入的<span lang=EN-US>PIN</span>腳，我們稱為<span lang=EN-US>GPIO
port (General Purpose I/O)</span>。<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『這個我知道，我之前就是透過控制某根<span
lang=EN-US>output PIN</span>的<span lang=EN-US>High</span>或<span lang=EN-US>Low</span>電位去控制<span
lang=EN-US>CPU</span>外部的<span lang=EN-US>LED</span>。我想輸入也是一樣的道理，外部裝置與<span
lang=EN-US>CPU</span>某根<span lang=EN-US>input PIN</span>連接，外部裝置透過控制該腳位的<span
lang=EN-US>High/Low</span>狀態，<span lang=EN-US>CPU</span>內的程式就可以自這根<span
lang=EN-US>input PIN</span>中得知外部裝置的狀態變化。<span style='display:none;mso-hide:
all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『如果<span
lang=EN-US>CPU</span>是大腦，那這些一般用途的<span lang=EN-US>GPIO port</span>就像是神經線，用以與外部的裝置溝通。如你所說，溝通的方式都數位的，就是把連接<span
lang=EN-US>CPU</span>與裝置的<span lang=EN-US>PIN</span>腳電位設為<span lang=EN-US>High</span>或<span
lang=EN-US>Low</span>。由<span lang=EN-US>CPU</span>輸出到裝置比較簡單，只要在合適的時間設定<span
lang=EN-US>output PIN</span>的電位即可，例如有些非記憶體的<span lang=EN-US>IC</span>操作前也需要先控制其<span
lang=EN-US>CS(chip select) PIN</span>，硬體設計時就要用到一根<span lang=EN-US>CPU</span>的<span
lang=EN-US>output PIN</span>連接<span lang=EN-US>CPU</span>與該<span lang=EN-US>IC</span>的<span
lang=EN-US>CS PIN</span>。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>CPU</span><span
style='font-family:"微軟正黑體","sans-serif"'>的<span lang=EN-US>input PIN</span>可分為會引發中斷與不會引發中斷兩種，硬體中斷的基本原理之前已陸陸續續提到，端視外部設備的特性來選擇要使用哪種<span
lang=EN-US>input PIN</span>；因為中斷會打斷目前正在執行的程式，也可以說<span lang=EN-US>ISR</span>是優先等級最高的程式，這樣的輸入很適合不定時發生的事件，例如使用者壓下按鍵、網路送來一個封包、<span
lang=EN-US>DMA</span>完成、負責傳輸資料的<span lang=EN-US>buffer</span>空了<span
lang=EN-US>(</span>通知<span lang=EN-US>CPU</span>儘快送資料來<span lang=EN-US>)</span>或者滿了<span
lang=EN-US>(</span>通知<span lang=EN-US>CPU</span>儘快把資料取走<span lang=EN-US>)…</span>等。當外部設備透過<span
lang=EN-US>CPU</span>的<span lang=EN-US>input PIN</span>產生中斷，<span lang=EN-US>CPU</span>得知有“緊急”事件發生後，就可以透過其他的<span
lang=EN-US>I/O PIN</span>與該設備溝通，例如自外部設備中接收資料，此時使用的<span lang=EN-US>input pin</span>就無須有中斷的功能。』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『不會產生中斷的<span
lang=EN-US>input PIN</span>比較簡單，程式只要透過<span lang=EN-US>CPU</span>的暫存器讀出該<span
lang=EN-US>PIN</span>腳目前的狀態是高電位還是低電位即可。如果是可以產生中斷的<span lang=EN-US>input PIN</span>，就要查出該<span
lang=EN-US>PIN</span>腳對應的中斷向量表裡的第幾個中斷，然後要為其寫一個<span lang=EN-US>ISR</span>。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『除此之外，<span
lang=EN-US>CPU</span>也會提供暫存器讓韌體工程師可以設定每一個中斷的屬性，中斷的屬性分為兩大類：<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l0 level1 lfo10;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>高電位變為低電位時產生中斷，或者低電位變成高電位時產生中斷<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l0 level1 lfo10;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>Edge trigger</span><span
style='font-family:"微軟正黑體","sans-serif"'>或<span lang=EN-US>Level trigger<o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>這些屬性精確地決定中斷會產生的時間點，只要看下圖就可以理解。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><!--[if gte vml 1]><v:shape
 id="_x0000_i1037" type="#_x0000_t75" style='width:510pt;height:210pt'>
 <v:imagedata src="/b2/CH07_03.files/image025.jpg" o:title="07-10-觸發中斷的時間點"/>
</v:shape><![endif]--><![if !vml]><img width=680 height=280
src="/b2/CH07_03.files/image026.jpg" v:shapes="_x0000_i1037"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc165115556"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>7-10</span>：觸發中斷的時間點</span></a><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『一根<span
lang=EN-US>PIN</span>就只有<span lang=EN-US>High/Low</span>兩種狀態，只能作開關式的控制；多根<span
lang=EN-US>PIN</span>腳再搭配時間，就可以組合出各種複雜的通訊協定，例如之前我們提過的<span lang=EN-US>NAND
Flash</span>控制，我們的驅動程式就是透過控制<span lang=EN-US>CPU</span>的多根一般<span lang=EN-US>output
PIN(</span>下圖中名為<span lang=EN-US>CE<a style='mso-footnote-id:ftn6' href="#_ftn6"
name="_ftnref6" title=""><span class=MsoFootnoteReference><span
style='mso-special-character:footnote'><![if !supportFootnotes]><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:12.0pt;font-family:
"微軟正黑體","sans-serif";mso-bidi-font-family:"Times New Roman";mso-font-kerning:
1.0pt;mso-ansi-language:EN-US;mso-fareast-language:ZH-TW;mso-bidi-language:
AR-SA'>[6]</span></span><![endif]></span></span></a></span>、<span lang=EN-US>ALE</span>、<span
lang=EN-US>CLE</span>、<span lang=EN-US>I/Ox…)</span>來對<span lang=EN-US>NAND
Flash</span>下命令，請注意這個命令是由一段時間內多根<span lang=EN-US>PIN</span>腳的電位變化所組成的；當<span
lang=EN-US>NAND Flash</span>收到命令後，它可以把資料透過改變多根<span lang=EN-US>CPU input PIN</span>的電位來傳回給<span
lang=EN-US>CPU</span>。如果知道這個原理，你知道<span lang=EN-US>NAND Flash</span>的驅動程式要怎麼寫了嗎？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『簡單來說，就是按照<span
lang=EN-US>NAND Flash data sheet</span>裡的時序圖<span lang=EN-US>(</span>如下<span
lang=EN-US>)</span>，先依序的改變各個<span lang=EN-US>output PIN</span>的電位來對<span
lang=EN-US>NAND Flash</span>下指令，然後在時序圖規定的時間內逐一讀取<span lang=EN-US>input PIN</span>的電位，就可以取得<span
lang=EN-US>NAND Flash</span>的傳回值。<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><!--[if gte vml 1]><v:shape
 id="_x0000_i1038" type="#_x0000_t75" style='width:509.25pt;height:321pt'>
 <v:imagedata src="/b2/CH07_03.files/image027.jpg" o:title="07-11-多根PIN腳就可以組合出複雜的控制方式(NAND)"/>
</v:shape><![endif]--><![if !vml]><img width=679 height=428
src="/b2/CH07_03.files/image028.jpg" v:shapes="_x0000_i1038"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc165115557"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>7-11</span>：多根<span
lang=EN-US>PIN</span>腳就可以組合出複雜的控制方式</span></a><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『是的，如果驅動程式只是要讓裝置正常的動作，其實沒你想像的複雜吧。我們再舉一個例子，如果<span
lang=EN-US>CPU</span>的<span lang=EN-US>GPIO PIN</span>不夠的話，可以選用像是<span
lang=EN-US>I<st1:chmetcnv UnitName="C" SourceValue="2" HasSpace="False"
Negative="False" NumberType="1" TCSC="0" w:st="on"><sup>2</sup>C</st1:chmetcnv></span>這種序列式通訊協定介面<a
style='mso-footnote-id:ftn7' href="#_ftn7" name="_ftnref7" title=""><span
class=MsoFootnoteReference><span lang=EN-US><span style='mso-special-character:
footnote'><![if !supportFootnotes]><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:12.0pt;font-family:"微軟正黑體","sans-serif";mso-bidi-font-family:
"Times New Roman";mso-font-kerning:1.0pt;mso-ansi-language:EN-US;mso-fareast-language:
ZH-TW;mso-bidi-language:AR-SA'>[7]</span></span><![endif]></span></span></span></a>的晶片，只要兩根<span
lang=EN-US>I/O</span>腳<span lang=EN-US>(</span>如下圖的<span lang=EN-US>SDA</span>與<span
lang=EN-US>SDL)</span>，一根產生固定頻率的方波當作<span lang=EN-US>clock</span>，另一根負責序列式資料交換，你可以參考以下的時序圖。系統中每一個<span
lang=EN-US>I<st1:chmetcnv UnitName="C" SourceValue="2" HasSpace="False"
Negative="False" NumberType="1" TCSC="0" w:st="on"><sup>2</sup>C</st1:chmetcnv></span>介面的裝置都有自己獨有的<span
lang=EN-US>ID</span>編號，透過這個機制，系統中所有<span lang=EN-US>I<st1:chmetcnv UnitName="C"
SourceValue="2" HasSpace="False" Negative="False" NumberType="1" TCSC="0"
w:st="on"><sup>2</sup>C</st1:chmetcnv></span>介面的裝置可以串在一起，<span lang=EN-US>CPU</span>送出包含<span
lang=EN-US>ID</span>的封包才可以控制到正確的裝置。表面上這種方式看起來很複雜，但說到底也不過就是<span lang=EN-US>I/O
PIN</span>的控制罷了。<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><!--[if gte vml 1]><v:shape
 id="_x0000_i1039" type="#_x0000_t75" style='width:509.25pt;height:207pt'>
 <v:imagedata src="/b2/CH07_03.files/image029.jpg" o:title="07-12-(a)-序列式通訊協定 - I2C 架構圖"/>
</v:shape><![endif]--><![if !vml]><img width=679 height=276
src="/b2/CH07_03.files/image030.jpg" v:shapes="_x0000_i1039"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc165115558"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>7-12(a)</span>：序列式通訊協定<span
lang=EN-US> - I</span></span></a><st1:chmetcnv UnitName="C" SourceValue="2"
HasSpace="False" Negative="False" NumberType="1" TCSC="0" w:st="on"><span
 style='mso-bookmark:_Toc165115558'><sup><span lang=EN-US style='font-family:
 "微軟正黑體","sans-serif"'>2</span></sup></span><span style='mso-bookmark:_Toc165115558'><span
 lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>C</span></span></st1:chmetcnv><span
style='mso-bookmark:_Toc165115558'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>
</span></span><span style='mso-bookmark:_Toc165115558'><span style='font-family:
"微軟正黑體","sans-serif"'>架構圖</span></span><span lang=EN-US style='font-family:
"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><!--[if gte vml 1]><v:shape
 id="_x0000_i1040" type="#_x0000_t75" style='width:510pt;height:226.5pt'>
 <v:imagedata src="/b2/CH07_03.files/image031.jpg" o:title="07-12-(b)-序列式通訊協定 - I2C 時序圖"/>
</v:shape><![endif]--><![if !vml]><img width=680 height=302
src="/b2/CH07_03.files/image032.jpg" v:shapes="_x0000_i1040"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc165115559"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>7-12(b)</span>：序列式通訊協定<span
lang=EN-US> - I</span></span></a><st1:chmetcnv UnitName="C" SourceValue="2"
HasSpace="False" Negative="False" NumberType="1" TCSC="0" w:st="on"><span
 style='mso-bookmark:_Toc165115559'><sup><span lang=EN-US style='font-family:
 "微軟正黑體","sans-serif"'>2</span></sup></span><span style='mso-bookmark:_Toc165115559'><span
 lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>C</span></span></st1:chmetcnv><span
style='mso-bookmark:_Toc165115559'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>
</span></span><span style='mso-bookmark:_Toc165115559'><span style='font-family:
"微軟正黑體","sans-serif"'>時序圖</span></span><span lang=EN-US style='font-family:
"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『你說的很簡單，但實際上沒那麼容易吧！否則你們就不用每天都忙得焦頭爛額了。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『總是得先知道原理嘛，如果原理都不知道要怎麼開始實作？其實最麻煩的地方應該是要先弄清楚要控制的裝置有何規定，如果是特殊通訊協定介面，就必須先搞清楚這個通訊協定的細節；這些都是人家的規定，你不照著作，它就不動如山給你看。另一個麻煩事就是<span
lang=EN-US>timing</span>的控制，剛剛說過，<span lang=EN-US>CPU</span>與裝置間的命令或資料的傳遞是透過<span
lang=EN-US>I/O PIN</span>電位變化與時間的組合，如果<span lang=EN-US>timing</span>不對裝置肯定也紋風不動。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『所以寫驅動程式的人肯定離不開示波器囉？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『沒錯！一般我們不會用到太複雜的功能，示波器可以量得某些<span
lang=EN-US>PIN</span>腳在某段時間內的狀態變化，下圖是一個例子，和我們剛剛看的時序圖是不是很像？如果<span lang=EN-US>data
sheet</span>內說某<span lang=EN-US>PIN</span>腳的控制，要按照某個時序圖，該裝置才能正常運作，但我的驅動程式就是不<span
lang=EN-US>work</span>怎麼辦？沒有示波器的話，我只能對著<span lang=EN-US>data sheet</span>和程式發愁；反之，我只要量一下訊號，大概就可以知道哪裡出問題了。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:18.0pt;
mso-line-height-rule:exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><!--[if gte vml 1]><v:shape
 id="_x0000_i1041" type="#_x0000_t75" style='width:240pt;height:180pt'>
 <v:imagedata src="/b2/CH07_03.files/image033.jpg" o:title="07-13-系統中多個PIN腳間的電位關係"/>
</v:shape><![endif]--><![if !vml]><img width=320 height=240
src="/b2/CH07_03.files/image033.jpg" v:shapes="_x0000_i1041"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc165115560"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>7-13</span>：示波器可以量出在某個時間點，系統中多個<span
lang=EN-US>PIN</span>腳間的電位關係</span></a><span lang=EN-US style='font-family:
"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『最後還有一個使用<span
lang=EN-US>GPIO</span>該注意的事項，以前應該有稍微提到過了，用於嵌入式系統的<span lang=EN-US>CPU</span>為了節省<span
lang=EN-US>PIN</span>腳，通常某些<span lang=EN-US>PIN</span>腳會具有一個以上的功能<span
lang=EN-US>(</span>當然同時只能有一個功能<span lang=EN-US>)</span>，例如某根<span lang=EN-US>PIN</span>腳可以有<span
lang=EN-US>GPIO</span>與<span lang=EN-US>AD port(Analog to Digital)</span>的功能，假設系統電壓是<span
lang=EN-US>3.3v</span>，當它被設定為<span lang=EN-US>AD port</span>時，輸入的訊號可以是<span
lang=EN-US>0~3.3V</span>中間任一個等級的電壓；當它被當成<span lang=EN-US>GPIO</span>時，輸入的訊號必須是數位的，不是<span
lang=EN-US>High(3.3V)</span>，就是<span lang=EN-US>Low(0)</span>。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>所以在使用這種<span
lang=EN-US>PIN</span>腳之前，一定要記得把它設定成正確的用途<span lang=EN-US>(</span>透過<span
lang=EN-US>CPU</span>的<span lang=EN-US>memory mapping register)</span>，否則結果一定不會正確。例如某根<span
lang=EN-US>GPIO PIN</span>，硬體設計的原意是要從裝置輸入訊號，如果驅動程式把它設定為<span lang=EN-US>output
PIN</span>，那麼<span lang=EN-US>CPU</span>就不保證可以讀到正確的值。<span style='display:none;
mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『我懂了，這就是你為什麼<b
style='mso-bidi-font-weight:normal'>要求硬體設計同仁一定要做出“<span lang=EN-US>CPU</span>所有<span
lang=EN-US>PIN</span>腳之配置與用途”表格</b>的原因了。<span style='display:none;mso-hide:
all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『從線路圖可以看出<span
lang=EN-US>PIN</span>腳間的連接，但不容易看出用途；軟硬體工程人員思維模式還是有點不同，如果韌體工程師誤解了硬體設計的原意，就算把程式看到爛掉也不會知道問題所在。所以話說回來，韌體工程師和硬體工程師協同作戰真的很重要！<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<h3 style='line-height:18.0pt;mso-line-height-rule:exactly'><a
name="_Toc304922118"><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>NOP</span></a><span
style='mso-bookmark:_Toc304922118'><span style='font-family:"微軟正黑體","sans-serif"'>與實作精確的時間區段</span></span><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></h3>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『我有個問題，剛剛我們看了一些時序圖，控制訊號之間都有時間的關係，我想知道我們的程式如何精準地控制時間？我知道有些操作要求的<span
lang=EN-US>timing</span>很嚴格，舉例來說，假設<span lang=EN-US>CPU</span>透過兩根<span
lang=EN-US>PIN</span>腳與某個<span lang=EN-US>IC</span>連接，一根是<span lang=EN-US>CS(chip
select)</span>，另一根是輸入<span lang=EN-US>PIN – P#1</span>，<span lang=EN-US>data
sheet</span>裡說明如何從<span lang=EN-US>IC</span>取得資料的時序圖如下。其中規定當<span lang=EN-US>CPU</span>把<span
lang=EN-US>CS</span>由<span lang=EN-US>High</span>被拉到<span lang=EN-US>Low</span>時，該<span
lang=EN-US>IC</span>會開始動作，經過<span lang=EN-US>T1</span>的時間後，<span lang=EN-US>IC</span>會把資料放在<span
lang=EN-US>P#1</span>上<span lang=EN-US>(</span>這裡所謂的“資料”不是<span lang=EN-US>High</span>就是<span
lang=EN-US>Low</span>，或者說不是<span lang=EN-US>0</span>就是<span lang=EN-US>1)</span>，維持的時間為<span
lang=EN-US>T2</span>。這種狀況下，我們程式如何在正確的時間裡到<span lang=EN-US>P#1</span>上抓取正確的資料？』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:18.0pt;
mso-line-height-rule:exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><!--[if gte vml 1]><v:shape
 id="_x0000_i1042" type="#_x0000_t75" style='width:349.5pt;height:233.25pt'>
 <v:imagedata src="/b2/CH07_03.files/image034.jpg" o:title="07-14-時序圖範例"/>
</v:shape><![endif]--><![if !vml]><img width=466 height=311
src="/b2/CH07_03.files/image035.jpg" v:shapes="_x0000_i1042"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc165115561"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>7-14(a)</span>：時序圖範例</span></a><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『剛剛已經講解過，要把某根輸出<span
lang=EN-US>PIN</span>做<span lang=EN-US>High/Low</span>變化，以及要從某根輸入<span
lang=EN-US>PIN</span>讀出狀態都可以透過<span lang=EN-US>CPU</span>的暫存器，這個基本的控制應該沒問題吧。這個例子還算簡單的，從時序圖中我們可以看出程式該做的事情是：<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:45.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-18.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l6 level1 lfo19;tab-stops:list 45.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";mso-bidi-font-family:微軟正黑體'><span
style='mso-list:Ignore'>a.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:"微軟正黑體","sans-serif"'>把<span
lang=EN-US>CS PIN</span>設定為<span lang=EN-US>Low<o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:45.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-18.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l6 level1 lfo19;tab-stops:list 45.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";mso-bidi-font-family:微軟正黑體'><span
style='mso-list:Ignore'>b.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:"微軟正黑體","sans-serif"'>等待<span
lang=EN-US>T1</span>的時間<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:45.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-18.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l6 level1 lfo19;tab-stops:list 45.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";mso-bidi-font-family:微軟正黑體'><span
style='mso-list:Ignore'>c.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:"微軟正黑體","sans-serif"'>立即從<span
lang=EN-US>P#1</span>讀出狀態<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>通常執行步驟<span lang=EN-US>c</span>的時間不會長於<span
lang=EN-US>T2</span>，所以上述的步驟中省略了<span lang=EN-US>T2</span>；假設<span lang=EN-US>T1
= <st1:chmetcnv UnitName="m" SourceValue="10" HasSpace="False" Negative="False"
NumberType="1" TCSC="0" w:st="on">10m</st1:chmetcnv>s</span>，先不要管操作<span
lang=EN-US>CPU PIN</span>腳的細節，我們可以將上面的步驟寫成下面這個簡單的程式：<span style='display:none;
mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>/**********************************************************<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'><span style='mso-tab-count:
1'>       </span>Function: drv_read_XXXIC_status<o:p></o:p></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'>  </span>return 0 if P#1 is Low, return 1 if P#1 is
High<o:p></o:p></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>**********************************************************/<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>int
drv_read_XXXIC_status(void)<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>{<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>int i ;<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>int P1_status ;<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>// </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:"微軟正黑體","sans-serif";color:blue'>將<span
lang=EN-US>CS PIN</span>設為<span lang=EN-US>Low<o:p></o:p></span></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>//<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>drv_set_XXXIC_CS_Low() ;<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>//</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:"微軟正黑體","sans-serif";color:blue'>等待<span
lang=EN-US>10ms<o:p></o:p></span></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>//<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>for(i=0;i&lt;10;i++)<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span><span style='mso-tab-count:1'>     </span>drv_wait_1ms()
;<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>// </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:"微軟正黑體","sans-serif";color:blue'>讀出<span
lang=EN-US>P#1 PIN</span>的狀態<span lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>//<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>P1_status = drv_get_P1_status() ;<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>// </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:"微軟正黑體","sans-serif";color:blue'>依照時序圖<span
lang=EN-US>, </span>將<span lang=EN-US>CS PIN</span>恢復為<span lang=EN-US>High<o:p></o:p></span></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>//<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>drv_set_XXXIC_CS_High() ;<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>return P1_status ;<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>}<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『這個程式很簡單，但我的問題就是<span
lang=EN-US>drv_wait_<st1:chmetcnv UnitName="m" SourceValue="1" HasSpace="False"
Negative="False" NumberType="1" TCSC="0" w:st="on">1m</st1:chmetcnv>s()</span>要怎麼<span
lang=EN-US>implement</span>？難道是用<span lang=EN-US>timer</span>嗎？』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『用<span
lang=EN-US>timer</span>也是一個方法，但設定<span lang=EN-US>timer</span>、執行<span
lang=EN-US>timer ISR</span>都需要時間執行吧，假設我們要等待的這個<span lang=EN-US>T1</span>很短，使用<span
lang=EN-US>timer</span>會造成一定的誤差。而且要驅動<span lang=EN-US>timer</span>也需要一個<span
lang=EN-US>driver</span>，在開發時期盡量不需要把一件工作加入太多的變數。我們在開發驅動程式時，最常用，也是最簡單的方法就是寫一個什麼事情都不做的迴圈，例如：<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>#define
COUNTER_PER_1MS<span style='mso-spacerun:yes'>  </span>25000<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>void
drv_wait_1ms(void)<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>{<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>int counter ;<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>// </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:"微軟正黑體","sans-serif";color:blue'>執行這個<span
lang=EN-US>function</span>的期間<span lang=EN-US>, </span>最好確認中斷不會產生<span
lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>// </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:"微軟正黑體","sans-serif";color:blue'>否則執行<span
lang=EN-US>ISR</span>的時間會影響這個函數的準確度<span lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>for(counter = 0 ; counter &lt; COUNTER_PER_1MS
; counter++)<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>{<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'><span style='mso-tab-count:
1'>       </span>// busy waiting - no nothing<o:p></o:p></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-tab-count:1'>       </span>//<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-tab-count:1'>       </span>asm(&quot;nop&quot;) ;<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-spacerun:yes'> </span>}<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>}<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『這個程式就是讓<span
lang=EN-US>CPU</span>執行指定次數之無意義的指令，而執行這些指令所需的時間剛好就是我們想要等待的時間。這個程式很簡單，但我有兩個問題，第一個，我們怎麼得到“<span
lang=EN-US>COUNTER_PER_<st1:chmetcnv UnitName="m" SourceValue="1"
HasSpace="False" Negative="False" NumberType="1" TCSC="0" w:st="on">1M</st1:chmetcnv>S</span>”的值？第二個，“<span
lang=EN-US>nop</span>”這個<span lang=EN-US>CPU</span>的指令代表什麼意思？』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『先回答你第二個問題，“<span
lang=EN-US>nop</span>”是<span lang=EN-US>no operation</span>的意思，<span
lang=EN-US>CPU</span>執行這行指令時什麼都不作，就是很單純的耗掉一個或多個<span lang=EN-US>clock</span>的時間；應該是所有的<span
lang=EN-US>CPU</span>都會提供這樣的指令，程式可以用這樣的指令讓<span lang=EN-US>CPU</span>空轉一段時間，而且不會影響任何記憶體或一般暫存器的值<a
style='mso-footnote-id:ftn8' href="#_ftn8" name="_ftnref8" title=""><span
class=MsoFootnoteReference><span lang=EN-US><span style='mso-special-character:
footnote'><![if !supportFootnotes]><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:12.0pt;font-family:"微軟正黑體","sans-serif";mso-bidi-font-family:
"Times New Roman";mso-font-kerning:1.0pt;mso-ansi-language:EN-US;mso-fareast-language:
ZH-TW;mso-bidi-language:AR-SA'>[8]</span></span><![endif]></span></span></span></a>。在回答你第一個問題之前，你先看一下這張表，每一個<span
lang=EN-US>CPU</span>都會提供這樣的表格，它說明了<span lang=EN-US>CPU</span>執行不同的指令需要多少個<span
lang=EN-US>clock</span>，你會算每一個<span lang=EN-US>clock</span>的時間是多長嗎？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><!--[if gte vml 1]><v:shape id="_x0000_i1043"
 type="#_x0000_t75" style='width:509.25pt;height:414pt'>
 <v:imagedata src="/b2/CH07_03.files/image036.jpg" o:title="07-14-(b)-CPU各種指令需要不同clock的執行時間"/>
</v:shape><![endif]--><![if !vml]><img width=679 height=552
src="/b2/CH07_03.files/image037.jpg" v:shapes="_x0000_i1043"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc165115562"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>7-14(b)</span>：<span
lang=EN-US>CPU</span>各種指令需要不同<span lang=EN-US>clock</span>的執行時間</span></a><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『你之前教過我啊，如果<span
lang=EN-US>CPU</span>運作的頻率是<st1:chmetcnv UnitName="m" SourceValue="8"
HasSpace="False" Negative="False" NumberType="1" TCSC="0" w:st="on"><span
 lang=EN-US>8M</span></st1:chmetcnv><span lang=EN-US>hz(</span>這個頻率和震盪器輸入的頻率不一定相同，<span
lang=EN-US>CPU</span>內部可以升頻或降頻<span lang=EN-US>)</span>，也就是說一秒鐘有<st1:chmetcnv
UnitName="m" SourceValue="8" HasSpace="False" Negative="False" NumberType="1"
TCSC="0" w:st="on"><span lang=EN-US>8M</span></st1:chmetcnv>個<span lang=EN-US>clock</span>，所以一個<span
lang=EN-US>clock</span>的時間就是<span lang=EN-US>1</span>秒除以<span lang=EN-US>(8 x
1024 x 1024)</span>，等於<span lang=EN-US>7.6 micro-second (7.6 x 10<sup>-6</sup></span>秒<span
lang=EN-US>)</span>。』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『理論上<span
lang=EN-US>CPU</span>執行指令的時間是很精確的，如果你把上面那個迴圈的程式轉為組合語言，你可以知道這個迴圈執行了哪些指令，每一個指令需要多少個<span
lang=EN-US>clock</span>，你就可以算出這個迴圈要轉幾次才會用掉你想要的時間。<span style='display:none;
mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『大概知道原理了，你可不可以舉個實例？』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『<span lang=EN-US>OK</span>，假設那個迴圈對應的<span
lang=EN-US>CPU</span>指令為：<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>;<o:p></o:p></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>; </span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:"微軟正黑體","sans-serif";
color:blue'>不同的<span lang=EN-US>CPU</span>有不同的組合語言指令<span lang=EN-US>, <o:p></o:p></span></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>; </span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:"微軟正黑體","sans-serif";
color:blue'>以下程式旨在表達流程<span lang=EN-US>, </span>並非任何<span lang=EN-US>CPU</span>的組合語言語法<span
lang=EN-US>, <o:p></o:p></span></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif";color:blue'>;<o:p></o:p></span></b></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-tab-count:1'>       </span>R0 = COUNTER_PER_1MS<span
style='mso-tab-count:2'>                </span><span style='mso-tab-count:1'>        </span><b
style='mso-bidi-font-weight:normal'>; 2 clock cycles<o:p></o:p></b></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'>loop_start:<o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-tab-count:1'>       </span>nop<span style='mso-tab-count:4'>                         </span><span
style='mso-tab-count:4'>                                </span><b
style='mso-bidi-font-weight:normal'>; 1 clock cycles<o:p></o:p></b></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-tab-count:1'>       </span>R0 = R0 -1<span style='mso-tab-count:
3'>                     </span><span style='mso-tab-count:3'>                        </span><b
style='mso-bidi-font-weight:normal'>; 1 clock cycles<o:p></o:p></b></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:blue'><span
style='mso-tab-count:1'>       </span>jump to &quot;loop_start&quot; if R0 </span><span
style='font-family:"微軟正黑體","sans-serif";color:blue'>≠<span lang=EN-US>0 <span
style='mso-tab-count:1'>        </span><b style='mso-bidi-font-weight:normal'><span
style='mso-tab-count:1'>        </span>; 4 clock cycles<o:p></o:p></b></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『所以一次<span
lang=EN-US>loop</span>會用掉<span lang=EN-US>6</span>個<span lang=EN-US>clock</span>的時間，所以我們可以很容易算出<span
lang=EN-US>R0</span>的初值等於多少時，執行這個迴圈的時間剛好是<st1:chmetcnv UnitName="m"
SourceValue="1" HasSpace="False" Negative="False" NumberType="1" TCSC="0"
w:st="on"><span lang=EN-US>1m</span></st1:chmetcnv><span lang=EN-US>s</span>。』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『沒錯，就是這麼簡單。這個<span
lang=EN-US>function</span>的誤差很小，此後在開發其他驅動程式，甚至系統程式與應用程式時都可以使用。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<h3 style='line-height:18.0pt;mso-line-height-rule:exactly'><a
name="_Toc304922119"></a><a name="_Toc149018072"><span style='mso-bookmark:
_Toc304922119'><span style='font-family:"微軟正黑體","sans-serif"'>省電功能控制</span></span></a><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></h3>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『在驅動程式的工作列表中，除了<span
lang=EN-US>Power Manager</span>，其他的項目名稱都很明確，就是某個裝置的驅動程式，例如<span lang=EN-US>boot-loader</span>、<span
lang=EN-US>SDRAM driver</span>、<span lang=EN-US>LCD driver</span>、<span
lang=EN-US>USB driver…</span>等。所謂<span lang=EN-US>Power Manager</span>應該就是電源管理吧，系統中有這麼多大大小小的電子零件，每一個電子零件都要用電，這電源管理該從何管起？我感覺這應該是硬體設計人員應該負責的事情不是嗎？為什麼你要在電源管理這個項目上預先配置了這麼長的開發時間？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『有些電子產品的確是不需要太嚴謹的電源管理功能，例如家電或車用電子，你會真的去量測你的<span
lang=EN-US>PC</span>、微波爐或洗衣機每個月吃掉你多少的電嗎？電源管理程式能省下的電和整體耗電來說簡直微不足道。但如果產品吃的是電池的電源，例如手機、電子字典、<span
lang=EN-US>PDA</span>、玩具<span lang=EN-US>…</span>等，要使用者忍受每天充電、沒幾天就要換電池、或者在外面用到一半突然沒電等狀況，這樣的產品就算功能再強大也不會是成功或熱銷的產品吧。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>當然硬體設計和系統耗電有絕對的關係，但當系統閒置時是否需要關閉外部裝置的電源、調整<span
lang=EN-US>PIN</span>腳的狀態、讓<span lang=EN-US>CPU</span>降頻或切換<span lang=EN-US>CPU</span>的模式等則是軟體的工作。我們在此不討論硬體如何設計會比較省電，這不是我們的工作，我們的重點是：系統在不同的執行狀態應該要對應不同的耗電狀態，簡單的說，在不同狀態下，系統要關掉用不到的設備，不能關掉的設備就要讓其盡量處於最省電的狀態。如果以手機為例，大部分的時間處於開機但沒被使用的狀態，如果不做電源管理，你想想你手機的電池在持續通話的狀況下能撐多久，你能忍受待機時間就是這麼久嗎？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『所以在設計電源管理程式時，應該要先區分出系統有哪些執行狀態。還是以手機為例，我覺得應該有幾種用電量的等級，由最耗電往下排應該是：<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l7 level1 lfo11;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>通話或上網<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l7 level1 lfo11;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>拍照、玩遊戲、播放<span lang=EN-US>MP3</span>或動畫<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l7 level1 lfo11;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>使用手機其他的功能，<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l7 level1 lfo11;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>待機<span lang=EN-US>(</span>背光關閉，螢幕亮著<span
lang=EN-US>)<o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l7 level1 lfo11;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>待機<span lang=EN-US>(</span>螢幕關閉<span
lang=EN-US>)<o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l7 level1 lfo11;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>關機<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>最耗電的狀況時，幾乎系統中所有的裝置都在動作，而在關機的狀況下應該是把整個系統的電源都切掉了吧。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『根據產品特性不同可以區分出不同的耗電等級，一般來說電源管理程式會把執行狀態分為以下三種等級：<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l17 level1 lfo12;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>Full Run Mode – </span><span
style='font-family:"微軟正黑體","sans-serif"'>系統中所有裝置全速執行。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l17 level1 lfo12;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>Idle Mode – </span><span
style='font-family:"微軟正黑體","sans-serif"'>待機狀態，系統在等待下一個命令，目前沒事可做；以手機的例子來說，就是螢幕還亮著的待機狀態。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l17 level1 lfo12;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>Sleep Mode – </span><span
style='font-family:"微軟正黑體","sans-serif"'>睡眠狀態，使用者看起來會覺得機器像是關機，但仍可透過某種輸入裝置立刻將其喚醒。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>要做到省電，可以從以下幾個方向著手：<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l10 level1 lfo13;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>CPU</span><span
style='font-family:"微軟正黑體","sans-serif"'>：<span lang=EN-US>CPU</span>是整個系統的心臟，不能輕易停掉，但“跳慢一點”當然會比較省電。一般用於嵌入是系統的<span
lang=EN-US>CPU</span>都會提供以下兩種方式來控制<span lang=EN-US>CPU</span>的用電：<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:75.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l10 level2 lfo13;tab-stops:list 75.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>n<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>Clock</span><span
style='font-family:"微軟正黑體","sans-serif"'>調整 <span lang=EN-US>– </span>例如輸入<span
lang=EN-US>CPU</span>的<span lang=EN-US>clock</span>是<span lang=EN-US>48Mhz</span>，<span
lang=EN-US>CPU</span>內部可以設定將其升頻<span lang=EN-US>(</span>如<span lang=EN-US>x2</span>，變成<span
lang=EN-US>96MHz)</span>，或降頻<span lang=EN-US>(</span>如除以<span lang=EN-US>2</span>、除以<span
lang=EN-US>4</span>、除以<span lang=EN-US>8</span>等等<span lang=EN-US>)</span>後的頻率當作<span
lang=EN-US>CPU</span>的工作頻率。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:75.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l10 level2 lfo13;tab-stops:list 75.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>n<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>執行狀態調整 <span lang=EN-US>– CPU</span>通常會提供諸如“<span
lang=EN-US>halt</span>”或“<span lang=EN-US>sleep</span>”的指令，執行後可以讓<span
lang=EN-US>CPU</span>停止一些<span lang=EN-US>CPU</span>內部的功能，並暫時停止抓指令來執行。顧名思義，<span
lang=EN-US>halt</span>是暫停的意思，<span lang=EN-US>sleep</span>則是睡眠的意思，兩者同樣會讓<span
lang=EN-US>CPU</span>暫停執行指令，但後者顯然會關掉比較多的<span lang=EN-US>CPU</span>功能，當然比較省電。當產生特定的中斷時就可以把<span
lang=EN-US>CPU</span>從<span lang=EN-US>halt</span>或<span lang=EN-US>sleep mode</span>中喚醒，繼續抓取指令執行<span
lang=EN-US>(CPU</span>醒來後執行的第一行指令一定是中斷處理程式<span lang=EN-US>)</span>。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif";color:red'><!--[if gte vml 1]><v:shape
 id="_x0000_i1044" type="#_x0000_t75" style='width:510pt;height:167.25pt'>
 <v:imagedata src="/b2/CH07_03.files/image038.jpg" o:title="07-15-某CPU提供的幾種省電模式"/>
</v:shape><![endif]--><![if !vml]><img width=680 height=223
src="/b2/CH07_03.files/image039.jpg" v:shapes="_x0000_i1044"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:0cm;mso-char-indent-count:
0;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc165115563"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>7-15</span>：某<span
lang=EN-US>CPU</span>提供的幾種省電模式</span></a><span lang=EN-US style='font-family:
"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l10 level1 lfo13;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>關閉暫時不使用之外部裝置的電源：這個當然必須硬體設計配合，首先該裝置及相關零件的電源供給必須獨立，接著硬體設計必須提供可以控制該裝置電源切換的開關，此來驅動程式才可以透過<span
lang=EN-US>I/O port</span>控制這個開關，達到真正切斷該裝置電源的目的。基本上裝置的電源切斷後就不應該再秏電，<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l10 level1 lfo13;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>切換裝置的執行模式：和<span lang=EN-US>CPU</span>一樣，有些裝置不能任意切斷電源，所以就會提供不同的執行模式，基本上不會像<span
lang=EN-US>CPU</span>那麼複雜，通常就是<span lang=EN-US>full run mode</span>與<span
lang=EN-US>standby mode</span>兩種模式。驅動程式必須依據<span lang=EN-US>data sheet</span>內的規定，在暫時用不到該裝置的時候，讓其進入較省電的<span
lang=EN-US>standby mode</span>。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l10 level1 lfo13;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>將<span lang=EN-US>CPU</span>的各個<span
lang=EN-US>PIN</span>腳逐一切換為較省電的模式：用於嵌入式系統的<span lang=EN-US>CPU</span>為了節省<span
lang=EN-US>PIN</span>腳、降低成本等因素，它的某些<span lang=EN-US>PIN</span>腳可能是多用途的；當這些<span
lang=EN-US>PIN</span>腳被設定成不同的用途，就可能有不同的耗電狀態，所以當某根<span lang=EN-US>PIN</span>腳暫時不使用時，必須將其設定為最省電的用途。這是個挺麻煩的工作，每個<span
lang=EN-US>CPU</span>的設計邏輯都不一樣，有時候甚至要用<span lang=EN-US>trial-and-error</span>，實際測量在不同設定下的耗電流。雖然如此，我們還是有幾個簡單的基本原則：<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:18.0pt;mso-line-height-rule:exactly'><span lang=EN-US
style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:75.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l10 level2 lfo13;tab-stops:list 75.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>n<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>通常<span lang=EN-US>GPIO</span>會比其他的設定<span
lang=EN-US>(</span>如<span lang=EN-US>AD port</span>、<span lang=EN-US>data bus…)</span>省電<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:75.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l10 level2 lfo13;tab-stops:list 75.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>n<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>通常<span lang=EN-US>output PIN</span>會比<span
lang=EN-US>input PIN</span>省電<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:75.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l10 level2 lfo13;tab-stops:list 75.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>n<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>通常將<span lang=EN-US>output PIN</span>保持在低電位，會比保持在高電位省電<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:75.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l10 level2 lfo13;tab-stops:list 75.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>n<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>如果<span lang=EN-US>GPIO</span>有被電路拉高<span
lang=EN-US>(pull high)</span>或拉低<span lang=EN-US>(pull low)</span>，逆勢而為通常會比較耗電<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『我們的硬體設計都有考慮到這些嗎？如果硬體設計沒對應，韌體人原有的也很難做吧。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『這就是為什麼韌體及系統人員必須參與硬體設計的原因了，就算再沒空，至少都要參加迴路圖的<span
lang=EN-US>review</span>會議，並對硬體設計同仁講解電源管理程式的基本架構，例如系統有幾種耗電狀態、<span lang=EN-US>idle
mode</span>以及<span lang=EN-US>sleep mode</span>有哪些裝置必須關掉、而哪些不用等等。韌體人員必須確認電源管理的相關硬體設計為何，包含：哪些裝置具有獨立電源、該裝置的耗電流是否可以單獨量測、用那根<span
lang=EN-US>PIN</span>腳切換裝置的電源開關、<span lang=EN-US>CPU</span>各個<span lang=EN-US>PIN</span>腳在各個執行狀態下應該如何設定較省電<span
lang=EN-US>…</span>等。如果事前不做這些溝通，等板子回來後你就會發現有些裝置的電源無法控制，或者使用了不合適的<span
lang=EN-US>PIN</span>腳導致耗電流高。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>舉個常會犯錯的例子，硬體工程師常常會忽略有些<span
lang=EN-US>CPU PIN</span>腳的狀態<span lang=EN-US>(High</span>或<span lang=EN-US>Low)</span>會影響耗電流；假設硬體工程師選了一根<span
lang=EN-US>CPU</span>的<span lang=EN-US>GPIO port</span>當做切換某個裝置的電源開關，並定義低電位是切掉電源，高電位是開啟電源，這樣的設計乍看之下沒有問題。如果用來控制電源開關的這根<span
lang=EN-US>PIN</span>腳的特性是維持低電位時較耗電<span lang=EN-US>(</span>例如這根<span
lang=EN-US>PIN</span>在<span lang=EN-US>CPU</span>內部有<span lang=EN-US>pull-high</span>電阻，要把被拉高的電位維持在低電位，當然需要更多的電<span
lang=EN-US>)</span>，那麼為了關掉這個外部裝置的電源，結果卻使<span lang=EN-US>CPU</span>用了較多的電。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『遇到這種狀況，硬體工程師就只能試著<span
lang=EN-US>rework</span>板子，這就是為什麼我們現在的板子拉了好幾條紅色藍色的電線的原因嗎？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『不盡然是電源管理的原因啦，新的硬體設計要做到第一次就完全<span
lang=EN-US>OK</span>幾乎是不可能的，很多<span lang=EN-US>CPU</span>或裝置晶片的規範一不小心就會被忽略了；像剛剛的例子，<span
lang=EN-US>CPU data sheet</span>那麼厚，誰會注意到這根<span lang=EN-US>PIN</span>腳在<span
lang=EN-US>CPU</span>內部會被拉成高電位？同樣一本<span lang=EN-US>data sheet</span>，硬體工程師和韌體工程師看的重點一定不一樣，所以硬體設計絕對不能讓硬體工程師閉門造車，否則一定會浪費很多很多時間。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<h3 style='line-height:18.0pt;mso-line-height-rule:exactly'><a
name="_Toc304922120"></a><a name="_Toc149018068"><span style='mso-bookmark:
_Toc304922120'><span style='font-family:"微軟正黑體","sans-serif"'>初始化</span></span></a><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></h3>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『我們陸陸續續說明了<span
lang=EN-US>CPU</span>內部的運作原理，你現在知道“<b style='mso-bidi-font-weight:normal'><span
lang=EN-US>CPU</span>的驅動程式</b>”該怎麼寫了嗎？<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『綜合以上的討論，<span
lang=EN-US>CPU</span>也是系統中的裝置之一，所以當然也需要驅動程式，它必須在其他程式開始執行前就做好<span lang=EN-US>CPU</span>的初始化工作，包含：<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l20 level1 lfo9;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>設定<span lang=EN-US>CPU</span>內部暫存器，包含<span
lang=EN-US>PSR</span>與<span lang=EN-US>SP</span>等<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l20 level1 lfo9;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>設定中斷向量表<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l20 level1 lfo9;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>設定<span lang=EN-US>CPU</span>內部各單元<span
lang=EN-US>(CPU core</span>以及內置設備<span lang=EN-US>)</span>的<span lang=EN-US>clock<o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l20 level1 lfo9;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>BUS</span><span
style='font-family:"微軟正黑體","sans-serif"'>設定<span lang=EN-US> - </span>設定各個外部記憶體的特性，包含要插入幾個<span
lang=EN-US>waiting cycle</span>、操作該記憶體的基本單位寬度<span lang=EN-US>(</span>是<span
lang=EN-US>8bit</span>、<span lang=EN-US>16bit</span>或<span lang=EN-US>32bit)…</span>等<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l20 level1 lfo9;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>設定<span lang=EN-US>CPU</span>各個<span
lang=EN-US>PIN</span>腳的用途使其符合系統或應用程式的需求<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l20 level1 lfo9;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>設定<span lang=EN-US>CPU</span>的執行模式，剛開始應該是在<span
lang=EN-US>full run mode<o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l20 level1 lfo9;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>其他內部裝置的初始化<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif";display:none;mso-hide:
all'>ˊˊ用台　</span><span style='font-family:"微軟正黑體","sans-serif"'>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『差不多就是這些了，這些動作要儘早做，有些甚至在<span
lang=EN-US>boot-loader</span>階段的前期就必須搞定。此外雖然<span lang=EN-US>CPU</span>就是一顆<span
lang=EN-US>IC</span>，但是它內含了許多裝置與功能，驅動程式還是必須將其區分為一個個獨立的模組，例如<span lang=EN-US>initialization(</span>初始化<span
lang=EN-US>)</span>、<span lang=EN-US>clock(</span>時序設定<span lang=EN-US>)</span>、<span
lang=EN-US>power manager(</span>電源管理<span lang=EN-US>)</span>、<span lang=EN-US>memory
and bus(</span>記憶體設定<span lang=EN-US>)</span>、<span lang=EN-US>timer(</span>計時器<span
lang=EN-US>)</span>、<span lang=EN-US>SDRAM controller</span>、<span lang=EN-US>LCD
controller…</span>等等，對上層工程師而言，它們應該是一個個獨立的模組，只要呼叫這些模組提供的<span lang=EN-US>API</span>即可。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『看來單單一顆<span
lang=EN-US>CPU</span>的驅動程式就有得寫了，幸好<span lang=EN-US>CPU</span>廠商有提供<span
lang=EN-US>sample code</span>。<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<h3 style='line-height:18.0pt;mso-line-height-rule:exactly'><a
name="_Toc304922121"><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>CPU</span></a><span
style='mso-bookmark:_Toc304922121'><span style='font-family:"微軟正黑體","sans-serif"'>內部還有什麼？</span></span><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></h3>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『隨著半導體技術的進步與<span
lang=EN-US>IC</span>設計產業的蓬勃發展，越來越多的<span lang=EN-US>CPU</span>整合了各式各樣的功能，有些<span
lang=EN-US>CPU</span>就是一個具體而為的系統，<span lang=EN-US>CPU</span>裡面甚至有<span
lang=EN-US>ROM</span>以及<span lang=EN-US>RAM</span>，幾乎只要供給電源就可以獨立運作。這種高度整合的<span
lang=EN-US>CPU</span>簡化了硬體設計的複雜度，同樣的讓韌體工程師較少有機會碰到在完全不穩定的硬體平台上開發的困境。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『以前的時代是怎樣我不知道，雖然現在的<span
lang=EN-US>CPU</span>整合了這麼多功能，但我們的板子上還不是密密麻麻的零件；<span lang=EN-US>CPU</span>功能增加了，成本降低了，但同時也開啟了產品設計者的視野，就像<span
lang=EN-US>PM</span>老大說的，簡單的事情就不會交給我們做了。<span style='display:none;mso-hide:
all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『你說的也有道理，但是別忘了每年用量最大的<span
lang=EN-US>CPU</span>是像<span lang=EN-US>8051</span>這種<span lang=EN-US>8 bit</span>的<span
lang=EN-US>CPU</span>，對應的產品也是以簡單廉價的居多；當然<span lang=EN-US>8 bit CPU</span>也常常變型成那種整合了一堆裝置的無敵鐵金剛，對成本越敏感的產品，越適合這種整合性<span
lang=EN-US>CPU</span>。講了這麼多，你對我們的<span lang=EN-US>CPU</span>還有什麼疑問嗎？<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『可不可以再稍微說明一下<span
lang=EN-US>CPU</span>內部裝置的功能？<span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『不同的<span
lang=EN-US>CPU</span>有不同的內部裝置，要從何說起呢？有些裝置因為太常用了，如<span lang=EN-US>ADC(Analog to
Digital Converter)</span>、<span lang=EN-US>Timer</span>或<span lang=EN-US>DMA</span>控制器<span
lang=EN-US>…</span>等等，從前都需要外接控制<span lang=EN-US>IC</span>才有的功能現在幾乎變成各家<span
lang=EN-US>CPU</span>的基本功能了，我們就從這些功能說起吧：<span style='display:none;mso-hide:
all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l4 level1 lfo14;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>AD
port</span></b><span style='font-family:"微軟正黑體","sans-serif"'>：基本上<span
lang=EN-US>CPU</span>是數位的系統，所有的資料都必須由不是<span lang=EN-US>0</span>就是<span
lang=EN-US>1</span>的<span lang=EN-US>bit</span>所組成；但真實世界的狀態通常是連續<span
lang=EN-US>(</span>或說類比<span lang=EN-US>)</span>的，例如溫度、使用者施加的壓力、電壓<span
lang=EN-US>…</span>等，要把這些真實世界的狀態輸入到<span lang=EN-US>CPU</span>中勢必要經過轉換，這樣的過程我們稱之為<span
lang=EN-US>Analog to Digital</span>，<span lang=EN-US>CPU</span>中負責接收類比訊號的<span
lang=EN-US>PIN</span>腳稱為<span lang=EN-US>AD port</span>。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>運作原理相當簡單，就以量測電池電壓為例，輸入<span
lang=EN-US>AD port</span>的電壓範圍是<span lang=EN-US>0~3V</span>，如果該<span
lang=EN-US>AD port</span>的精度是<span lang=EN-US>10 bit</span>，即類比轉為數位後的值為<span
lang=EN-US>0~1023</span>之間<span lang=EN-US>(2<sup>10</sup> = 1024)</span>。舉例來說，當電壓值為<span
lang=EN-US>0</span>時，轉換後的<span lang=EN-US>AD</span>值為<span lang=EN-US>0</span>，當電壓值為最大值
<span lang=EN-US>– 3V</span>時，則轉換後的<span lang=EN-US>AD</span>值是<span
lang=EN-US>1023</span>；至於在<span lang=EN-US>0~3V</span>之間的輸入，則會以線性的方式作轉換，例如輸入電壓為<span
lang=EN-US>2.2V</span>，則取得的<span lang=EN-US>AD</span>值為：<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>(2.2/3.0) X
1024 = 751<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>對驅動程式而言，自<span
lang=EN-US>AD port</span>取得的值<span lang=EN-US>(</span>通常是透過<span lang=EN-US>memory
mapping register</span>取得<span lang=EN-US>)</span>，反算可得真正的電壓值；同上例的狀況<span
lang=EN-US>(</span>電壓值範圍<span lang=EN-US>0~3V</span>、<span lang=EN-US>AD port</span>精度<span
lang=EN-US>10bit)</span>，假設得到的<span lang=EN-US>AD</span>值是<span lang=EN-US>620</span>，則反算可得輸入的電壓值為：<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>(620/1024) X
3V = 1.82V<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>外部晶片只要能將類比的輸入<span
lang=EN-US>(</span>如溫度、音量等級、震動程度<span lang=EN-US>…)</span>轉換為不同的電壓輸出，再連接到<span
lang=EN-US>CPU</span>的<span lang=EN-US>AD port</span>，則程式就可以在控制的精度之下算得外界類比的輸入。這種類比轉換數位的輸入方式可以應用在許多領域，因此<span
lang=EN-US>CPU</span>內的程式可以收集到各式各樣外部資訊，並依此作出不同的控制與處理。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l4 level1 lfo14;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>Timer</span></b><span
style='font-family:"微軟正黑體","sans-serif"'>：前面說過，<span lang=EN-US>CPU</span>必須有穩定的<span
lang=EN-US>clock</span>輸入才可運作，<span lang=EN-US>CPU</span>將輸入的<span lang=EN-US>clock</span>升頻或降頻後提供給<span
lang=EN-US>CPU</span>內部的各單元，或者輸出到其他的外部設備，使其時序可以與<span lang=EN-US>CPU</span>同步。應用這個<span
lang=EN-US>clock</span>，<span lang=EN-US>CPU</span>可以輕易的提供計時或鬧鈴的功能，我們稱之為<span
lang=EN-US>timer</span>。<span lang=EN-US>CPU</span>內可以提供多個可獨立運作的<span
lang=EN-US>timer</span>，每一個<span lang=EN-US>timer</span>都會有其相應的中斷號碼，透過許多<span
lang=EN-US>memory mapping register</span>來控制<span lang=EN-US>timer</span>。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>驅動程式要先設定<span
lang=EN-US>timer</span>的屬性，例如該<span lang=EN-US>timer</span>啟動後多久到時；<span
lang=EN-US>timer</span>的基本時間單位為<span lang=EN-US>clock</span>，假如<span
lang=EN-US>timer</span>的<span lang=EN-US>clock</span>來源是<st1:chmetcnv
UnitName="m" SourceValue="24" HasSpace="False" Negative="False" NumberType="1"
TCSC="0" w:st="on"><span lang=EN-US>24M</span></st1:chmetcnv><span lang=EN-US>hz</span>，表示<span
lang=EN-US>(24 x 1024 x 1024)</span>個<span lang=EN-US>clock</span>就是一秒鐘，或者可換算得基本的時間單位為：<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>1</span><span
style='font-family:"微軟正黑體","sans-serif"'>秒<span lang=EN-US> / (24 x 1024 x 1024
) = 40 x 10<sup>-9</sup></span>秒<span lang=EN-US> = 40 ns (</span>奈秒<span
lang=EN-US>)<o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>接著寫作相應的<span
lang=EN-US>timeout</span>中斷處理程式，則該<span lang=EN-US>ISR</span>會從<span
lang=EN-US>timer</span>啟動起的指定時間後被執行。電子產品的應用或多或少都有計時的需求，以驅動程式來說，要驅動某些裝置或實現某些<span
lang=EN-US>protocol</span>要有很精準的<span lang=EN-US>timing</span>；以系統程式來說，<span
lang=EN-US>timer</span>幾乎是必備的功能，並且基於驅動程式提供之基本的計時功能，擴展出更複雜、以手錶時間<span
lang=EN-US>(</span>秒、分、時<span lang=EN-US>)</span>為主的<span lang=EN-US>timer</span>功能，例如每<span
lang=EN-US>N</span>個<span lang=EN-US>mini-second(</span>千分之一秒<span lang=EN-US>)</span>產生一次<span
lang=EN-US>timeout</span>，連續產生<span lang=EN-US>M</span>次等。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>應用程式使用系統提供的<span
lang=EN-US>timer</span>功能時只要指定<span lang=EN-US>callback function</span>即可，當然不用自己寫<span
lang=EN-US>ISR</span>。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l4 level1 lfo14;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>RTC(Real-Time-Clock)</span></b><span
style='font-family:"微軟正黑體","sans-serif"'>：上述的<span lang=EN-US>timer</span>是用來作較精準的計時，如<span
lang=EN-US>mini-second(10<sup>-3</sup></span>秒<span lang=EN-US>)</span>或<span
lang=EN-US>micro-second(10<sup>-6</sup></span>秒<span lang=EN-US>)</span>等級，如果是應用在計算以秒或分為單位的計時反而不適用，以<span
lang=EN-US>16 bit<span style='mso-spacerun:yes'>  </span>timer</span>為例，它最多僅能計時到<span
lang=EN-US>2<sup>16</sup> (65536)</span>個時間單位，通常還遠短於一秒鐘，要累積很多次<span lang=EN-US>timeout</span>才能計時到一秒鐘，則為了達成簡單的時鐘功能，系統將一直處於中斷產生的狀態。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:45.0pt;text-align:justify;text-justify:
inter-ideograph;line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>RTC</span><span
style='font-family:"微軟正黑體","sans-serif"'>也是一種<span lang=EN-US>timer</span>，但是它的精度比較粗，通常是百分之一秒的等級，程式可以將其調整到每隔一秒甚至一分鐘才產生中斷，此來可以輕易達成時鐘或日曆的功能。因為這種每分鐘才產生一次的中斷並不會耗掉太多的電，系統被中斷喚醒後只需要做簡單的累加計算即可，所以即便系統處於<span
lang=EN-US>sleeping mode</span>仍然可以維持長時間計時。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l4 level1 lfo14;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'>DMA(Direct
Memory Access)</span></b><span style='font-family:"微軟正黑體","sans-serif"'>：<span
lang=EN-US>DMA(</span>直接記憶體存取<span lang=EN-US>)</span>允許某些外部裝置可以獨立地對系統記憶體進行讀取或寫入，而不需牽涉到<span
lang=EN-US> CPU</span>。在<span lang=EN-US>PC</span>中，許多硬體的系統會使用<span lang=EN-US>
DMA</span>，包含硬碟控制器、繪圖顯示卡、網路卡、以及音效卡等等。當<span lang=EN-US>CPU</span>要從外部裝置<span
lang=EN-US>(</span>如硬碟、<span lang=EN-US>NAND Flash</span>或網路封包<span lang=EN-US>)</span>讀取大量的資料到主記憶體時，如果不使用<span
lang=EN-US>DMA</span>的話，<span lang=EN-US>CPU</span>必須自裝置逐一讀出資料，通常是將資料先讀到一般暫存器，然後才寫入主記憶體。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>在作這種外部裝置到主記憶體的資料傳輸時，<span
lang=EN-US>CPU</span>除了<span lang=EN-US>I/O</span>之外什麼事也不能做；如果傳輸的資料量很大，或者傳輸的一方是像硬碟般的慢速設備<span
lang=EN-US>(</span>不管硬碟技術再怎麼進步，效能還是不會比記憶體快<span lang=EN-US>)</span>，系統在一段長時間內只能執行資料搬移的動作，無法做計算的工作，這對嵌入式系統中最寶貴的資源
<span lang=EN-US>– </span>“<span lang=EN-US>computing power</span>”是一種嚴重的浪費，簡單的說就是殺雞用牛刀。所以應該要把簡單的<span
lang=EN-US>I/O</span>工作交給<span lang=EN-US>DMA</span>控制器去做即可，同時間<span
lang=EN-US>CPU</span>可以執行更重要的程式。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>用於嵌入式系統的<span
lang=EN-US>CPU</span>一般都會內建<span lang=EN-US>DMA</span>控制器，所以都可以透過暫存器去控制它；在作資料搬移之前，驅動程式要先設定好來源位址、目標位址以及要搬移的資料量，上述的來源與目標位址可能是記憶體的位址，也可能是<span
lang=EN-US>memory mapping register</span>，例如寫入某暫存器即代表輸出到某裝置，或者某裝置會將資料逐一存入某暫存器之中。當驅動程式設定好搬移資料的資訊後，就可以下指令啟動<span
lang=EN-US>(trigger)DMA</span>控制器；接著系統可以去做其他的事情或切換到其他的<span lang=EN-US>task</span>，當資料搬移完畢後，<span
lang=EN-US>DMA</span>控制器會產生中斷通知<span lang=EN-US>CPU</span>。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;text-align:justify;text-justify:
inter-ideograph;text-indent:-24.0pt;line-height:18.0pt;mso-line-height-rule:
exactly;mso-list:l4 level1 lfo14;tab-stops:list 51.0pt'><![if !supportLists]><span
lang=EN-US style='font-family:Wingdings;mso-fareast-font-family:Wingdings;
mso-bidi-font-family:Wingdings'><span style='mso-list:Ignore'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:"微軟正黑體","sans-serif"'>其他內建<span lang=EN-US>chip</span>：目前業界<span
lang=EN-US>CPU</span>內部功能整合度之高已超乎想像，有些幾乎是為特定產品量身訂作，例如手持式裝置、手機、<span lang=EN-US>MP3</span>隨身聽<span
lang=EN-US>…</span>等都有整合型的<span lang=EN-US>CPU</span>可選用，下圖是一個用於<span
lang=EN-US>mp3 player</span>整合型<span lang=EN-US>CPU</span>的實例，圖中大方框內的方塊就是整合在<span
lang=EN-US>CPU</span>內部的晶片，你能想到<span lang=EN-US>MP3 player</span>該有的功能都包含在裡面了，包含<span
lang=EN-US>MP3</span>解碼器、<span lang=EN-US>LCD controller</span>、<span
lang=EN-US>NAND Flash controller</span>、<span lang=EN-US>USB controller…</span>等等。產品開發商用了這種<span
lang=EN-US>CPU</span>，軟、硬體都不需要太大的<span lang=EN-US>effort</span>，就能整合出完整的產品來；此來不但縮短研發時間與經費，還可以加速產品上市的時程。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:51.0pt;mso-para-margin-left:4.25gd;
text-align:justify;text-justify:inter-ideograph;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>既然這些功能已經被整合到<span
lang=EN-US>CPU</span>內，當然就不能用<span lang=EN-US>CPU</span>的<span lang=EN-US>I/O
port</span>控制；<span lang=EN-US>CPU</span>的<span lang=EN-US>data sheet</span>內會定義許多<span
lang=EN-US>memory mapping register</span>，按照該<span lang=EN-US>CPU</span>的規定就可以控制這些整合在<span
lang=EN-US>CPU</span>內部的<span lang=EN-US>IC</span>。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><!--[if gte vml 1]><v:shape
 id="_x0000_i1045" type="#_x0000_t75" style='width:509.25pt;height:280.5pt'>
 <v:imagedata src="/b2/CH07_03.files/image040.jpg" o:title="07-16-整合型CPU架構圖"/>
</v:shape><![endif]--><![if !vml]><img width=679 height=374
src="/b2/CH07_03.files/image041.jpg" v:shapes="_x0000_i1045"><![endif]><o:p></o:p></span></p>

<p class=a align=center style='text-align:center;text-indent:9.0pt;mso-char-indent-count:
.75;line-height:18.0pt;mso-line-height-rule:exactly'><a name="_Toc165115564"><span
style='font-family:"微軟正黑體","sans-serif"'>圖<span lang=EN-US>7-16</span>：整合型<span
lang=EN-US>CPU</span>架構圖</span></a><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『<span lang=EN-US>CPU</span>驅動程式的基礎架構說的差不多了，當然應用於不同領域的<span
lang=EN-US>CPU</span>各有其特色，整合在<span lang=EN-US>CPU</span>內部的功能也大不相同，但是基本原理就是這些了。有的<span
lang=EN-US>CPU</span>還提供<span lang=EN-US>MMU(memory management unit)</span>的功能，系統可用此來實現虛擬記憶體、虛擬位址空間、<span
lang=EN-US>page on demand</span>等大型作業系統的記憶體管理功能，我相信你在學校修作業系統時，應該也被這個東西搞的迷迷糊糊吧；幸好一般電子產品實在用不到這麼“高級”的功能，而且這樣的<span
lang=EN-US>CPU</span>通常也是設計給<span lang=EN-US>WinCE</span>或<span lang=EN-US>Embedded
Linux</span>專用的，<span lang=EN-US>MMU</span>的功能實現不難，但要調到穩定就要花時間了。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『我漸漸能抓到那種感覺了，像我們這樣的研發單位，有著產品上市的時程壓力，實在不可能什麼技術都重頭做起；如果可以的話，盡量找到現成且穩定的技術來源，單單做技術整合以及產品化的工作量就很大了。<span
style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>韌體老鳥：『有些人認為拿廠商的<span
lang=EN-US>sample code</span>來改好像沒什麼技術，事實上這才是最聰明的作法，我們不可能花太多的時間在一顆<span
lang=EN-US>CPU</span>或<span lang=EN-US>IC</span>上，誰知道以後還會不會用到它？重要的是觀念，觀念不對，就算有<span
lang=EN-US>sample code</span>你也無法將其移植到自己的板子；觀念對的話，管他什麼<span lang=EN-US>CPU</span>或<span
lang=EN-US>IC</span>都難不倒你。這就是所謂的：一法通，萬法通，阿彌陀佛。<span style='display:none;
mso-hide:all'>ˊˊ用台　</span>』<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
text-indent:27.0pt;mso-char-indent-count:2.25;line-height:18.0pt;mso-line-height-rule:
exactly'><span style='font-family:"微軟正黑體","sans-serif"'>菜鳥：『善哉，原來驅動程式的觀念和佛法是有關聯的<span
lang=EN-US>…</span><span style='display:none;mso-hide:all'>ˊˊ用台　</span>』<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:18.0pt;mso-line-height-rule:exactly'><span
lang=EN-US style='font-family:"微軟正黑體","sans-serif"'><o:p>&nbsp;</o:p></span></p>

</div>

<div style='mso-element:footnote-list'><![if !supportFootnotes]><br clear=all>

<hr align=left size=1 width="33%">

<![endif]>

<div style='mso-element:footnote' id=ftn1>

<p class=MsoFootnoteText><a style='mso-footnote-id:ftn1' href="#_ftnref1"
name="_ftn1" title=""><span class=MsoFootnoteReference><span lang=EN-US><span
style='mso-special-character:footnote'><![if !supportFootnotes]><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:10.0pt;font-family:
"Times New Roman","serif";mso-fareast-font-family:新細明體;mso-font-kerning:1.0pt;
mso-ansi-language:EN-US;mso-fareast-language:ZH-TW;mso-bidi-language:AR-SA'>[1]</span></span><![endif]></span></span></span></a><span
lang=EN-US> SPI</span><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>是一種速度較快的序列傳輸通訊協定。而</span><span
lang=EN-US>I<st1:chmetcnv UnitName="C" SourceValue="2" HasSpace="False"
Negative="False" NumberType="1" TCSC="0" w:st="on"><sup>2</sup>C</st1:chmetcnv></span><span
style='font-family:"新細明體","serif";mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>通訊協定可以將多個</span><span lang=EN-US>chip</span><span
style='font-family:"新細明體","serif";mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>串在一起，</span><span lang=EN-US>CPU</span><span
style='font-family:"新細明體","serif";mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>不需要和每個</span><span lang=EN-US>chip</span><span
style='font-family:"新細明體","serif";mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>直接連接，當要控制某個</span><span lang=EN-US>chip</span><span
style='font-family:"新細明體","serif";mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>時只要在</span><span lang=EN-US>I<st1:chmetcnv
UnitName="C" SourceValue="2" HasSpace="False" Negative="False" NumberType="1"
TCSC="0" w:st="on"><sup>2</sup>C</st1:chmetcnv> bus</span><span
style='font-family:"新細明體","serif";mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>上將裝置編號以及命令傳出去即可；這對</span><span
lang=EN-US>CPU PIN</span><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>腳不夠，但要控制多個</span><span
lang=EN-US>chip</span><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>的系統相當有用。</span></p>

</div>

<div style='mso-element:footnote' id=ftn2>

<p class=MsoFootnoteText><a style='mso-footnote-id:ftn2' href="#_ftnref2"
name="_ftn2" title=""><span class=MsoFootnoteReference><span lang=EN-US><span
style='mso-special-character:footnote'><![if !supportFootnotes]><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:10.0pt;font-family:
"Times New Roman","serif";mso-fareast-font-family:新細明體;mso-font-kerning:1.0pt;
mso-ansi-language:EN-US;mso-fareast-language:ZH-TW;mso-bidi-language:AR-SA'>[2]</span></span><![endif]></span></span></span></a><span
lang=EN-US> </span><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>最有名的中斷控制器就是</span><span
lang=EN-US>Intel</span><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>的</span><span
lang=EN-US>8259 PIC(Programmable Interrupt Controllers)</span><span
style='font-family:"新細明體","serif";mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>系列晶片，從最早期</span><span lang=EN-US>XT/AT</span><span
style='font-family:"新細明體","serif";mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>一直到現在的</span><span lang=EN-US>PC</span><span
style='font-family:"新細明體","serif";mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>都看得到這顆中斷控制器的蹤影。</span></p>

</div>

<div style='mso-element:footnote' id=ftn3>

<p class=MsoFootnoteText><a style='mso-footnote-id:ftn3' href="#_ftnref3"
name="_ftn3" title=""><span class=MsoFootnoteReference><span lang=EN-US><span
style='mso-special-character:footnote'><![if !supportFootnotes]><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:10.0pt;font-family:
"Times New Roman","serif";mso-fareast-font-family:新細明體;mso-font-kerning:1.0pt;
mso-ansi-language:EN-US;mso-fareast-language:ZH-TW;mso-bidi-language:AR-SA'>[3]</span></span><![endif]></span></span></span></a><span
lang=EN-US> </span><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>存取記憶體實際運作牽涉到</span><span
lang=EN-US>data bus</span><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>、</span><span
lang=EN-US>address bus</span><span style='font-family:"新細明體","serif";
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>以及一般人比較不清楚的</span><span
lang=EN-US>chip select</span><span style='font-family:"新細明體","serif";
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，我們將在本節的後面陸續說明。</span></p>

</div>

<div style='mso-element:footnote' id=ftn4>

<p class=MsoFootnoteText><a style='mso-footnote-id:ftn4' href="#_ftnref4"
name="_ftn4" title=""><span class=MsoFootnoteReference><span lang=EN-US><span
style='mso-special-character:footnote'><![if !supportFootnotes]><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:10.0pt;font-family:
"Times New Roman","serif";mso-fareast-font-family:新細明體;mso-font-kerning:1.0pt;
mso-ansi-language:EN-US;mso-fareast-language:ZH-TW;mso-bidi-language:AR-SA'>[4]</span></span><![endif]></span></span></span></a><span
lang=EN-US> </span><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>實際的情形當然不是那麼單純，不同的指令需要不同的執行時間，而這些時間都是</span><span
lang=EN-US>clock</span><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>的整數倍，亦即</span><span
lang=EN-US>clock</span><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>是</span><span
lang=EN-US>CPU</span><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>最小的時間單位。</span></p>

</div>

<div style='mso-element:footnote' id=ftn5>

<p class=MsoFootnoteText><a style='mso-footnote-id:ftn5' href="#_ftnref5"
name="_ftn5" title=""><span class=MsoFootnoteReference><span lang=EN-US><span
style='mso-special-character:footnote'><![if !supportFootnotes]><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:10.0pt;font-family:
"Times New Roman","serif";mso-fareast-font-family:新細明體;mso-font-kerning:1.0pt;
mso-ansi-language:EN-US;mso-fareast-language:ZH-TW;mso-bidi-language:AR-SA'>[5]</span></span><![endif]></span></span></span></a><span
lang=EN-US> BUS - </span><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>台灣翻譯成</span><span
lang=EN-US>”</span><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>匯流排</span><span
lang=EN-US>”</span><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，大陸則翻譯為</span><span
lang=EN-US>”</span><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>總線</span><span
lang=EN-US>”</span><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，筆者認為都不好，以下還是直接用其英文名稱。</span></p>

</div>

<div style='mso-element:footnote' id=ftn6>

<p class=MsoFootnoteText><a style='mso-footnote-id:ftn6' href="#_ftnref6"
name="_ftn6" title=""><span class=MsoFootnoteReference><span lang=EN-US><span
style='mso-special-character:footnote'><![if !supportFootnotes]><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:10.0pt;font-family:
"Times New Roman","serif";mso-fareast-font-family:新細明體;mso-font-kerning:1.0pt;
mso-ansi-language:EN-US;mso-fareast-language:ZH-TW;mso-bidi-language:AR-SA'>[6]</span></span><![endif]></span></span></span></a><span
lang=EN-US> CE(Chip Enable)</span><span style='font-family:"新細明體","serif";
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，和我們說的</span><span
lang=EN-US>CS(Chip Select)</span><span style='font-family:"新細明體","serif";
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>是一樣的東西。</span></p>

</div>

<div style='mso-element:footnote' id=ftn7>

<p class=MsoFootnoteText><a style='mso-footnote-id:ftn7' href="#_ftnref7"
name="_ftn7" title=""><span class=MsoFootnoteReference><span lang=EN-US><span
style='mso-special-character:footnote'><![if !supportFootnotes]><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:10.0pt;font-family:
"Times New Roman","serif";mso-fareast-font-family:新細明體;mso-font-kerning:1.0pt;
mso-ansi-language:EN-US;mso-fareast-language:ZH-TW;mso-bidi-language:AR-SA'>[7]</span></span><![endif]></span></span></span></a><span
lang=EN-US> I<st1:chmetcnv UnitName="C" SourceValue="2" HasSpace="False"
Negative="False" NumberType="1" TCSC="0" w:st="on"><sup>2</sup>C</st1:chmetcnv></span><span
style='font-family:"新細明體","serif";mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>介面是由</span><span lang=EN-US>Philps</span><span
style='font-family:"新細明體","serif";mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>所定義，</span><span lang=EN-US>CPU</span><span
style='font-family:"新細明體","serif";mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>只要透過兩根</span><span lang=EN-US>I/O port</span><span
style='font-family:"新細明體","serif";mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>模擬的序列</span><span lang=EN-US>bus</span><span
style='font-family:"新細明體","serif";mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>，就可以操作</span><span lang=EN-US>bus</span><span
style='font-family:"新細明體","serif";mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>上的</span><span lang=EN-US>IC</span><span
style='font-family:"新細明體","serif";mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>；</span><span style='font-family:"新細明體","serif";
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-bidi-font-family:新細明體;mso-font-kerning:0pt'>最高速率</span><span lang=EN-US
style='mso-font-kerning:0pt'>100Kbps</span><span style='font-family:"新細明體","serif";
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-bidi-font-family:新細明體;mso-font-kerning:0pt'>，</span><span lang=EN-US
style='mso-font-kerning:0pt'>25</span><span style='font-family:"新細明體","serif";
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-bidi-font-family:新細明體;mso-font-kerning:0pt'>英尺，最多可支持</span><span
lang=EN-US style='mso-font-kerning:0pt'>40</span><span style='font-family:"新細明體","serif";
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-bidi-font-family:新細明體;mso-font-kerning:0pt'>個設備。</span></p>

</div>

<div style='mso-element:footnote' id=ftn8>

<p class=MsoFootnoteText><a style='mso-footnote-id:ftn8' href="#_ftnref8"
name="_ftn8" title=""><span class=MsoFootnoteReference><span lang=EN-US><span
style='mso-special-character:footnote'><![if !supportFootnotes]><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:10.0pt;font-family:
"Times New Roman","serif";mso-fareast-font-family:新細明體;mso-font-kerning:1.0pt;
mso-ansi-language:EN-US;mso-fareast-language:ZH-TW;mso-bidi-language:AR-SA'>[8]</span></span><![endif]></span></span></span></a><span
lang=EN-US> “nop”</span><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>也是</span><span
lang=EN-US>CPU</span><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>的指令，</span><span
lang=EN-US>CPU</span><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>執行指令時，</span><span
lang=EN-US>PC(program, counter)</span><span style='font-family:"新細明體","serif";
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>暫存器一定會跟著改變，</span><span
lang=EN-US>CPU</span><span style='font-family:"新細明體","serif";mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>才知道要到哪裡抓取下一個命令來執行。</span></p>

</div>

</div>

</body>

</html>
