
<script>

  function report_the_spam(spam_new_id, spam_news_title)
  {

      if(<%= session[:logged_in]%> == false)
      {
          alert('<%= t(:please_log_in)  %>') ;
          return ;
      }

      message = '<%= t(:I_want_to_report_spam) %>' + ': [ ' + spam_news_title  + ' ]';
      result_msg = prompt(message, '<%= t(:spam_reason)%>') ;

      if(!(result_msg))
        return ;


      data = "news_id=" + spam_new_id + '&' + 'content=' + result_msg

      // send to server
       $.ajax(
       {
           type: "GET",
           url:"/review/report_spam",
           data: data,
           success: function(html)
           {
               // redirect to main page in order to redraw the news by new filter!
               // window.location.replace("/review/spam");

               alert(html) ;
           }
       });



  }




</script>



<% if news != nil %>
  <% news.each_with_index do |news, index| %>
    <div class="news">
      <div class="news_title">
        <a title="<%= news.title %>" href="<%= news_index_path+'/'+news.id.to_s %>" onclick="window.open('<%= news_index_path+'/'+news.id.to_s %>'); return false;"><%= news.title %></a>
      </div>

      <div class="info">
        由 <%= news.user.first_name %> 於 <%= news.created_at.in_time_zone("Taipei").strftime("%Y/%m/%d") %> 發佈, Tags:
        <% news.tags.each do |tag| %>
            <%= t(tag.name.to_sym) + " " %>
        <% end %>
      </div>

      <div class="image">
         <% if news.images != [] && news.images[0].url != "" %>
            <img src="<%=news.images[0].url.to_s%>" alt="image" width="150">
         <% end %>
      </div>

      <div class="news_content">
        <%= news.content.html_safe %>
      </div>

      <div style="clear: both;"></div>
    </div> <!-- news -->

    <div class="comments">
      <% graph = Koala::Facebook::GraphAPI.new() %>
      <% comment_obj = graph.get_object("http://heygotimes.heroku.com/news/"+news.id.to_s) %>
      <% comments = (comment_obj['comments'] == nil)? 0: comment_obj['comments'] %>
      <% shared = (comment_obj['shares'] == nil)? 0: comment_obj['shares'] %>
      <div class="comment_title" onclick="expand_comment(<%= news.id %>);"><a href="javascript:void(null)"><%= t(:comments)%></a><span id='expand_comment<%= news.id %>'><a href="javascript:void(null)"><%= '(' + comments.to_s + ')' %><img class="button-icon-expand" src="/images/expand.png" alt=""/></a></span></div>

      <% if type != "feedback" %>
          <div class="button_group">
            <a href="javascript:void(null)" onclick="like(<%= session[:id] %>, <%= news.id %>, 1);"><img class="button-icon-like" src="/images/like_button.png" alt="" /></a><span class='like_count' id='like_count<%= news.id %>'><%= news.likes.count %></span>
            <a href="javascript:void(null)" onclick="like(<%= session[:id] %>, <%= news.id %>, 0);"><img class="button-icon-unlike" src="/images/unlike_button.png" alt="" /></a><span class='unlike_count' id='unlike_count<%= news.id %>'><%= news.unlikes.count %></span>
            <a href="javascript:void(null)" onclick="location.href='http://www.facebook.com/sharer.php?u=http://heygotimes.heroku.com/news/<%= news.id.to_s %>&t=<%= news.title %>'" title="<%= t(:share_hint) %>"><img class="button-icon-share" src="/images/facebook_icon.png" alt="" /></a><span class='share_count' id='share_count<%= news.id %>'><%= shared %></span>

            <%# 檢舉 - 視同 report a spam news %>
            <!--
            <a name='btn1' class='osx btn1' onclick="to_report_dialog( <%= news.id %>,'<%= news.title %>')">
              <img class="button-icon-like" src="/images/stop_button.png" width="30px" height="30px"
                   alt="" title="<%= t(:report_spam)%>" />
            </a>
            -->
            <a href="javascript:void(null)" onclick="report_the_spam( <%= news.id %>,'<%= news.title %>')">
              <img class="button-icon-like" src="/images/stop_button.png" width="30px" height="30px"
                   alt="" title="<%= t(:report_spam)%>" />
            </a>

          </div>
      <% end %>

      <div class="fb_comment" id="fb_comment<%= news.id %>">
        <div id="fb-root"></div>
        <script>
          window.fbAsyncInit = function() {
            FB.init({appId: <%= Facebooker2.app_id %>, status: true, cookie: true,
                     xfbml: true});
          };
          (function() {
            var e = document.createElement('script'); e.async = true;

            // Todo: we need to check the locale!!!!!!!!!!!!
            //
            e.src = document.location.protocol + '//connect.facebook.net/zh_TW/all.js';

            document.getElementById('fb-root').appendChild(e);
          }());
        </script>
      </div> <!-- fb_comment -->
      <div style="clear: both;"></div>
    </div> <!-- comments -->

    <%# if (index != 0) %>
      <hr>
    <%# end %>
  <% end %>
<% end %>


