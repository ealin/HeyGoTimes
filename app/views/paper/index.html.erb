
  <meta property="og:title" content="HeyGoTimes"/>
  <meta property="og:type" content="news"/>
  <meta property="og:url" content="<%= root_url %>"/>
  <meta property="og:image" content="<%= root_url + "images/HeyGoTimes_logo.png" %> "/>

  <script type="text/javascript">
    function like(user, news, like)
    {
      // ask session data from server
      $.getJSON("/news/like.json", {user: user, news: news, like: like}, function(json)
      {
        $('#like_count'+news).html(json.like_count);
        $('#unlike_count'+news).html(json.unlike_count);
      });
    }

    function comment(resp)
    {
      var id_pos = resp.href.indexOf('/news/');
      var id = resp.href.substring(id_pos+6);
      $.ajax({
        type: "POST",
        url: "/news/comment",
        data: "news_id="+id
      });
    }

    function share(id, title)
    {
      var url = 'http://www.facebook.com/sharer.php?u=http://heygotimes.heroku.com/news/'+id+'&t='+title;
      $.ajax({
        type: "POST",
        url: "/news/share",
        data: "news_id="+id
      });
      location.href=url;
    }

    function expand_comment(news_id)
    {
      var comment_str = "<fb:comments href='http://heygotimes.heroku.com/news/"+news_id+"'"+"num_posts='2' width='650'></fb:comments>";

      $('#comment_title_'+news_id).attr('onclick', '').unbind('click');
      $('#expand_comment'+news_id).html("");
      $('#fb_comment'+news_id).append(comment_str);
      FB.XFBML.parse(document.getElementById('comments'));
    }

    function loading_animate(on){
      if (on)
        $('#loading_animate').html("<img src='/images/fb_loading_large.gif'/>");
      else
        $('#loading_animate').html('');
    }

    function loadMore(type, subType, pageNo)
    {
      var t = $("#paperContent");
      var url = '/paper/_show_paper_content?type='+type+'&sub_type='+subType+'&page='+pageNo;
      var preview = $('#loading_more_news').html('<img src="images/fb_loading_large.gif" height="20" width="20" />');

      $.get(url, function(response) {
          if (jQuery.trim(response) == '')
            $("#more_news").html('<a><%= t(:m_no_more) %></a>');
          else
            $("#paperContent").append(response);
        });

      t.timeout = setTimeout(function () {
        preview.html('');
      }, 3000);
    }

    function changePaperType(type, subType)
    {
      var url = '/paper/_show_paper_content?type='+type+'&sub_type='+subType+'&page=1';
      loading_animate(true);
      $("#paperContent").load(url, function(response, status, xhr) {
        loading_animate(false);
        $("#more_news").html('<a><%= t(:m_more) %></a><span id="loading_more_news"></span>');
      });
    }

    $(document).ready(function()
    {
      var currPage = 1;
      var currType = 'rank';
      var subType = '';

      $('#more_news').unbind('click').click(function() {
        loadMore(currType, subType, ++currPage);
      });

      $('#menu-item-rank').unbind('click').click(function(){
        $('#menu-item-latest').removeClass("current-menu-item");
        $(this).addClass("current-menu-item");
        currPage = 1;
        currType = 'rank';
        changePaperType(currType, '');
      });

      $('#menu-item-latest').unbind('click').click(function(){
        $('#menu-item-rank').removeClass("current-menu-item");
        $(this).addClass("current-menu-item");
        currPage = 1;
        currType = 'latest';
        changePaperType(currType, '');
      });

      $('#show_faq').unbind('click').click(function() {
        currPage = 1;
        currType = 'special';
        subType = 'faq';
        changePaperType(currType, subType);
      });

      $('#show_feedback').unbind('click').click(function() {
        if(<%= session[:logged_in]%> == false)
        {
            alert("<%= t(:login_for_set_friend_filter) %>") ;
            return ;
        }

        currPage = 1;
        currType = 'special';
        subType = 'feedback';
        changePaperType(currType, subType);
      });

      $('#show_notice').unbind('click').click(function() {
        currPage = 1;
        currType = 'special';
        subType = 'notice';
        changePaperType(currType, subType);
      });

      loading_animate(false);

      FB.Event.subscribe('comment.create',function(resp){
        comment(resp);
      });
    });

    function set_default_locale(new_locale)
    {
        // ask server to set session[:default_locale] then reload the main-page
        data = "locale=" + new_locale

        // send to server
         $.ajax(
         {
             type: "GET",
             url:"/paper/set_default_locale",
             data: data,
             success: function(html)
             {
                 // redirect to main page in order to redraw the news by new filter!
                  window.location.replace("/");
             }
         });
    }

    function report_the_spam(spam_new_id, spam_news_title)
    {

        if(<%= session[:logged_in]%> == false)
        {
            alert('<%= t(:please_log_in)  %>') ;
            return ;
        }

        message = '<%= t(:I_want_to_report_spam) %>' + ': [ ' + spam_news_title  + ' ]';
        result_msg = prompt(message, '<%= t(:spam_reason)%>') ;

        if(!(result_msg))
          return ;

        data = "news_id=" + spam_new_id + '&' + 'content=' + encodeURIComponent(result_msg)

        // send to server
         $.ajax(
         {
             type: "GET",
             url:"/review/report_spam",
             data: data,
             success: function(html)
             {
                 // redirect to main page in order to redraw the news by new filter!
                 // window.location.replace("/review/spam");
                 alert(html) ;
             }
         });
    }

  </script>

</head> <%# end tag for <head> in application.html.erb %>

<body>


<% if detect_Mobile_browser(:list) == true %>
    <%= redirect_to  :controller => 'mobile', :action => 'index' %>
<% end %>

<div id="page">
  <div id="header">
    <div id="logo">
      <%= link_to( image_tag("/images/HeyGoTimes_logo.png"), {:controller =>'paper'}, {:title => 'to home page'} ) %>
    </div>
    <span id="filter_hint" title ="<%= t(:tip_for_filter)%>">
        <%= @newspaper_title.to_s %>
    </span>

    <div id="page_head" >
      <%= show_page_head(:login_flag => true)  %>
      <div id="page_head2" >
         <a href="#" onclick="set_default_locale('zh_tw')">繁體中文</a>
         <a href="#" onclick="set_default_locale('zh')">简体中文</a>
         <a href="#" onclick="set_default_locale('en')">English</a>
      </div><!-- #page_head -->
    </div><!-- #page_head -->

  </div><!-- #header -->

  <div id="access">
    <div class="menu-header">
      <ul id="menu-area" class="menu">
        <div id="menu-type-btn">
        <li id="menu-item-rank" class="menu-item <%= 'current-menu-item' if (session[:news_type] == 'rank') %>"><a title="Rank" href="javascript:void(null)"><%=t(:popular_news)%></a></li>
        <li id="menu-item-latest" class="menu-item <%= 'current-menu-item' if (session[:news_type] == 'latest') %>"><a title="Latest" href="javascript:void(null)"><%=t(:latest_news)%></a></li>
         <li id="menu-item-notice" class="menu-item <%= 'current-menu-item' %>"><a id='show_notice' href='#'><%= t(:notice) %></a></li>

        <li id="loading_animate"><img src="/images/fb_loading_large.gif" alt=""/></li>
        </div>
        <div id="menu-fun-btn">
        <% if session[:logged_in] == true %>
           <li id="menu-item-report" class="menu-item fun-btn"><a name='btn1' class='osx btn1' title="<%= t(:m_report_news) %>" href="javascript:void(null)" ><%=t(:m_report)%></a></li>
        <% else %>
            <li id="menu-item-report" class="menu-item fun-btn"><a name='btn1' class='osx btn1' title="<%= t(:m_report_news) %>" href="javascript:void(null)"><%=t(:m_report)%></a></li>
        <% end %>

        <li id="menu-item-filter" class="menu-item fun-btn"><a name='btn2' class='osx btn2' title="<%= t(:m_filter_setting) %>" href="javascript:void(null)" ><%=t(:m_filter)%></a></li>
        </div>
      </ul>
    </div>
  </div><!-- #access -->

  <div id="main">
    <div id="content">
      <div id="paperContent">
        <% # TODO: use @paper_width %>
        <%= render :partial => 'paper/show_paper_content', :locals => {:news => @news, :news_sub_type => ""} %>
      </div>

      <div id="more_news"><a><%= t(:m_more) %></a><span id="loading_more_news"></span></div>

    </div>

    <div id="sub">

      <!-- Show functional buttons : 1.Report_a_news/2.Edit_realtimes_news/3.my_AD  -->
      <div id="functionalButton">
        <%= render :partial => 'paper/show_fun_buttons' %>
      </div>

      <!-- show AD list-->
      <div id="ad">
        <% # TODO: use @ad_width, @ad_height, @ad_no %>
        <%= render :partial => 'paper/show_ad_list' %>
      </div>
    </div>
  </div><!-- #main -->


  <!-- method 'show_page_tail' would be used by all controller, so it's implemented in application_helper.rb -->
    <div id="footer">
      <%= show_page_tail %>
    </div>
</div> <!-- /page -->
  <!-- news/_show_page_tail.html.erb  -->



<div id="toolbar-box">
    <!-- 浮動視窗內的程式碼…  -->


  <a href='https://www.facebook.com/pages/HeyGo-Times-%E5%8F%B0%E7%81%A3/131802886903681'
       onclick="alert('<%= t(:feedback_message) %>') ;"><img src="/images/feedback.png"/></a>
</div>


</body>
